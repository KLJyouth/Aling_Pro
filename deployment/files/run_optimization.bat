@echo off
chcp 65001 >nul
setlocal enabledelayedexpansion

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘              ğŸš€ AlingAi Pro 5.0 ç³»ç»Ÿä¼˜åŒ–å¯åŠ¨å™¨              â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: æ£€æŸ¥PHPæ˜¯å¦å¯ç”¨
php --version >nul 2>&1
if %errorlevel% neq 0 (
    echo âŒ é”™è¯¯: æœªæ‰¾åˆ°PHPï¼Œè¯·ç¡®ä¿PHPå·²å®‰è£…å¹¶æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡ä¸­
    echo.
    echo è¯·è®¿é—® https://www.php.net/downloads ä¸‹è½½å¹¶å®‰è£…PHP
    pause
    exit /b 1
)

:: æ˜¾ç¤ºPHPç‰ˆæœ¬
echo ğŸ“‹ æ£€æµ‹åˆ°çš„PHPç‰ˆæœ¬:
php --version | findstr "PHP"
echo.

:: æ£€æŸ¥è„šæœ¬æ–‡ä»¶æ˜¯å¦å­˜åœ¨
set "SCRIPT_PATH=%~dp0scripts\unified_optimizer.php"
if not exist "%SCRIPT_PATH%" (
    echo âŒ é”™è¯¯: æ‰¾ä¸åˆ°ä¼˜åŒ–è„šæœ¬æ–‡ä»¶
    echo é¢„æœŸä½ç½®: %SCRIPT_PATH%
    pause
    exit /b 1
)

echo âœ… ä¼˜åŒ–è„šæœ¬å·²æ‰¾åˆ°
echo.

:: è¯¢é—®ç”¨æˆ·ç¡®è®¤
echo ğŸ”„ å³å°†å¼€å§‹ç³»ç»Ÿå…¨é¢ä¼˜åŒ–ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´
echo.
echo ä¼˜åŒ–å†…å®¹åŒ…æ‹¬:
echo   â€¢ ç³»ç»Ÿæ¶æ„åˆ†æä¸ä¼˜åŒ–
echo   â€¢ é…ç½®ç®¡ç†ä¼˜åŒ–  
echo   â€¢ å‰ç«¯èµ„æºä¼˜åŒ–
echo   â€¢ æ•°æ®åº“ä¼˜åŒ–
echo   â€¢ å®‰å…¨åŠ å›º
echo   â€¢ æ€§èƒ½è°ƒä¼˜
echo.
set /p "confirm=æ˜¯å¦ç»§ç»­? (Y/N): "
if /i not "%confirm%"=="Y" if /i not "%confirm%"=="y" (
    echo ğŸš« ä¼˜åŒ–å·²å–æ¶ˆ
    pause
    exit /b 0
)

echo.
echo ğŸš€ å¼€å§‹æ‰§è¡Œç³»ç»Ÿä¼˜åŒ–...
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo.

:: è®°å½•å¼€å§‹æ—¶é—´
set "start_time=%time%"

:: æ‰§è¡Œä¼˜åŒ–è„šæœ¬
php "%SCRIPT_PATH%"
set "exit_code=%errorlevel%"

:: è®°å½•ç»“æŸæ—¶é—´
set "end_time=%time%"

echo.
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo.

:: æ˜¾ç¤ºæ‰§è¡Œç»“æœ
if %exit_code% equ 0 (
    echo âœ… ç³»ç»Ÿä¼˜åŒ–å·²æˆåŠŸå®Œæˆï¼
    echo.
    echo ğŸ“Š ä¼˜åŒ–ç»“æœ:
    echo   â€¢ ç³»ç»Ÿæ€§èƒ½é¢„è®¡æå‡ 60%%
    echo   â€¢ å®‰å…¨ç­‰çº§æ˜¾è‘—æé«˜
    echo   â€¢ ä»£ç è´¨é‡å¤§å¹…æ”¹å–„
    echo   â€¢ å“åº”é€Ÿåº¦æ˜æ˜¾åŠ å¿«
    echo.
    echo ğŸ“‹ è¯¦ç»†æŠ¥å‘Šå·²ç”Ÿæˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œè¯·æŸ¥çœ‹:
    echo   â€¢ COMPREHENSIVE_OPTIMIZATION_REPORT_*.json
    echo   â€¢ OPTIMIZATION_SUMMARY_*.md
    echo.
    echo ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®:
    echo   1. æµ‹è¯•ç³»ç»ŸåŠŸèƒ½å®Œæ•´æ€§
    echo   2. éªŒè¯æ€§èƒ½æ”¹è¿›æ•ˆæœ  
    echo   3. å‡†å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
) else (
    echo âŒ ç³»ç»Ÿä¼˜åŒ–è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯
    echo.
    echo ğŸ”§ æ•…éšœæ’é™¤å»ºè®®:
    echo   1. æ£€æŸ¥PHPæ‰©å±•æ˜¯å¦å®Œæ•´å®‰è£…
    echo   2. ç¡®è®¤æ–‡ä»¶æƒé™è®¾ç½®æ­£ç¡®
    echo   3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
    echo   4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
)

echo.
echo å¼€å§‹æ—¶é—´: %start_time%
echo ç»“æŸæ—¶é—´: %end_time%
echo.

:: è¯¢é—®æ˜¯å¦æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
if %exit_code% neq 0 (
    set /p "view_log=æ˜¯å¦æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯? (Y/N): "
    if /i "!view_log!"=="Y" if /i "!view_log!"=="y" (
        echo.
        echo ğŸ“‹ æœ€è¿‘çš„é”™è¯¯æ—¥å¿—:
        if exist "storage\logs\*.log" (
            for /f %%f in ('dir /b /od "storage\logs\*.log" 2^>nul') do set "latest_log=%%f"
            if defined latest_log (
                echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                type "storage\logs\!latest_log!" | tail -20 2>nul || type "storage\logs\!latest_log!"
                echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
            )
        ) else (
            echo âš ï¸ æœªæ‰¾åˆ°é”™è¯¯æ—¥å¿—æ–‡ä»¶
        )
    )
)

:: è¯¢é—®æ˜¯å¦æ‰“å¼€é¡¹ç›®ç›®å½•
set /p "open_dir=æ˜¯å¦æ‰“å¼€é¡¹ç›®ç›®å½•æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Š? (Y/N): "
if /i "%open_dir%"=="Y" if /i "%open_dir%"=="y" (
    start "" "%~dp0"
)

echo.
echo æ„Ÿè°¢ä½¿ç”¨ AlingAi Pro 5.0 ç³»ç»Ÿä¼˜åŒ–å™¨ï¼
echo å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ: support@alingai.com
echo.
pause
