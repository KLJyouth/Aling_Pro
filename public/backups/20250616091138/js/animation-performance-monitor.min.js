class AnimationPerformanceMonitor{constructor(){this.frameCount=0;this.lastTime=performance.now();this.fps=60;this.performanceHistory=[];this.adaptiveSettings={particleCount: 20,effectQuality: 'high',animationSpeed: 1.0,shadowQuality: 'high'};this.thresholds={excellent: 55,good: 40,fair: 25,poor: 15};this.monitoring=false;this.optimizationCallbacks=[];this.init();}init(){this.detectDeviceCapabilities();this.setupPerformanceObserver();console.log('ğŸ”¬ åŠ¨ç”»æ€§èƒ½ç›‘æ§å™¨åˆå§‹åŒ–å®Œæˆ');}detectDeviceCapabilities(){const canvas=document.createElement('canvas');const gl=canvas.getContext('webgl')|| canvas.getContext('experimental-webgl');if(gl){const debugInfo=gl.getExtension('WEBGL_debug_renderer_info');this.deviceInfo={renderer: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL): 'Unknown',vendor: debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL): 'Unknown',maxTextureSize: gl.getParameter(gl.MAX_TEXTURE_SIZE),supportedExtensions: gl.getSupportedExtensions()};}this.deviceInfo.memory=navigator.deviceMemory || 'Unknown';this.deviceInfo.cores=navigator.hardwareConcurrency || 'Unknown';this.performanceLevel=this.calculateInitialPerformanceLevel();console.log('ğŸ“Š è®¾å¤‡æ€§èƒ½è¯„ä¼°:',{level: this.performanceLevel,info: this.deviceInfo});}calculateInitialPerformanceLevel(){let score=0;if(this.deviceInfo.memory >=8)score+=30;else if(this.deviceInfo.memory >=4)score+=20;else if(this.deviceInfo.memory >=2)score+=10;if(this.deviceInfo.cores >=8)score+=20;else if(this.deviceInfo.cores >=4)score+=15;else if(this.deviceInfo.cores >=2)score+=10;const renderer=this.deviceInfo.renderer.toLowerCase();if(renderer.includes('nvidia')|| renderer.includes('radeon')){score+=25;}else if(renderer.includes('intel')){score+=15;}if(/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)){score-=20;}if(score >=70)return 'excellent';if(score >=50)return 'good';if(score >=30)return 'fair';return 'poor';}setupPerformanceObserver(){if('PerformanceObserver' in window){const observer=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach(entry=>{if(entry.entryType==='measure'){this.recordPerformanceMetric(entry);}});});observer.observe({entryTypes: ['measure']});}}startMonitoring(){if(this.monitoring)return;this.monitoring=true;this.frameCount=0;this.lastTime=performance.now();this.monitorFrame();console.log('ğŸ” å¼€å§‹æ€§èƒ½ç›‘æ§');}stopMonitoring(){this.monitoring=false;console.log('â¹ï¸ åœæ­¢æ€§èƒ½ç›‘æ§');}monitorFrame(){if(!this.monitoring)return;const currentTime=performance.now();this.frameCount++;if(currentTime-this.lastTime >=1000){this.fps=Math.round((this.frameCount*1000)/(currentTime-this.lastTime));this.frameCount=0;this.lastTime=currentTime;this.recordFPS(this.fps);this.evaluatePerformance();}requestAnimationFrame(()=> this.monitorFrame());}recordFPS(fps){this.performanceHistory.push({timestamp: Date.now(),fps: fps,level: this.getFPSLevel(fps)});if(this.performanceHistory.length > 100){this.performanceHistory.shift();}}getFPSLevel(fps){if(fps >=this.thresholds.excellent)return 'excellent';if(fps >=this.thresholds.good)return 'good';if(fps >=this.thresholds.fair)return 'fair';return 'poor';}evaluatePerformance(){const recentHistory=this.performanceHistory.slice(-10);if(recentHistory.length < 5)return;const avgFPS=recentHistory.reduce((sum,record)=> sum+record.fps,0)/recentHistory.length;const currentLevel=this.getFPSLevel(avgFPS);if(currentLevel !==this.performanceLevel){console.log(`ğŸ“ˆ æ€§èƒ½ç­‰çº§å˜åŒ–: ${this.performanceLevel}â†’ ${currentLevel}`);this.performanceLevel=currentLevel;this.optimizeSettings();}}optimizeSettings(){const oldSettings={...this.adaptiveSettings};switch(this.performanceLevel){case 'excellent': this.adaptiveSettings={particleCount: 30,effectQuality: 'ultra',animationSpeed: 1.0,shadowQuality: 'high',enableAdvancedEffects: true};break;case 'good': this.adaptiveSettings={particleCount: 20,effectQuality: 'high',animationSpeed: 1.0,shadowQuality: 'medium',enableAdvancedEffects: true};break;case 'fair': this.adaptiveSettings={particleCount: 15,effectQuality: 'medium',animationSpeed: 0.8,shadowQuality: 'low',enableAdvancedEffects: false};break;case 'poor': this.adaptiveSettings={particleCount: 8,effectQuality: 'low',animationSpeed: 0.6,shadowQuality: 'none',enableAdvancedEffects: false};break;}this.notifyOptimization(oldSettings,this.adaptiveSettings);}notifyOptimization(oldSettings,newSettings){const optimizationData={performanceLevel: this.performanceLevel,fps: this.fps,oldSettings,newSettings,timestamp: Date.now()};this.optimizationCallbacks.forEach(callback=>{try{callback(optimizationData);}catch(error){console.error('âŒ ä¼˜åŒ–å›è°ƒæ‰§è¡Œå¤±è´¥:',error);}});console.log('âš¡ æ€§èƒ½ä¼˜åŒ–åº”ç”¨:',optimizationData);}onOptimization(callback){this.optimizationCallbacks.push(callback);}recordPerformanceMetric(entry){if(entry.duration > 16.67){console.warn(`âš ï¸ æ€§èƒ½ç“¶é¢ˆæ£€æµ‹: ${entry.name}è€—æ—¶ ${entry.duration.toFixed(2)}ms`);}}getPerformanceReport(){const recent=this.performanceHistory.slice(-30);const avgFPS=recent.length ? recent.reduce((sum,r)=> sum+r.fps,0)/recent.length : 0;return{currentFPS: this.fps,averageFPS: Math.round(avgFPS),performanceLevel: this.performanceLevel,deviceInfo: this.deviceInfo,adaptiveSettings: this.adaptiveSettings,history: this.performanceHistory.slice(-10)};}mark(name){performance.mark(name);}measure(name,startMark,endMark){performance.measure(name,startMark,endMark);}destroy(){this.stopMonitoring();this.optimizationCallbacks=[];this.performanceHistory=[];console.log('ğŸ—‘ï¸ æ€§èƒ½ç›‘æ§å™¨å·²é”€æ¯');}}window.AnimationPerformanceMonitor=AnimationPerformanceMonitor;if(typeof module !=='undefined' && module.exports){module.exports=AnimationPerformanceMonitor;}