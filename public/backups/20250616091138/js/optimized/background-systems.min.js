class UnifiedBackgroundManager{constructor(){this.currentMode='minimalist';this.quantumEnabled=false;this.performanceMode=this.detectPerformanceLevel();this.backgroundSystems=new Map();this.init();}init(){console.log('🎨 初始化统一背景管理器...');this.performanceMode=this.detectPerformanceLevel();console.log(`📊 设备性能等级: ${this.performanceMode}`);this.initializeBackgroundSystems();this.setupEventListeners();this.applyBackgroundMode(this.currentMode);console.log('✅ 统一背景管理器初始化完成');}detectPerformanceLevel(){const canvas=document.createElement('canvas');const gl=canvas.getContext('webgl')|| canvas.getContext('experimental-webgl');if(!gl)return 'low';const debugInfo=gl.getExtension('WEBGL_debug_renderer_info');const renderer=debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL): '';const memory=navigator.deviceMemory || 4;const cores=navigator.hardwareConcurrency || 4;if(memory >=8 && cores >=8)return 'high';if(memory >=4 && cores >=4)return 'medium';return 'low';}initializeBackgroundSystems(){if(window.MinimalistBackground){this.backgroundSystems.set('minimalist',window.MinimalistBackground);console.log('✅ 极简主义背景系统已注册');}if(window.quantumParticleSystem){this.backgroundSystems.set('quantum',window.quantumParticleSystem);console.log('✅ 量子粒子系统已注册');}if(window.quantumAnimation){this.backgroundSystems.set('quantumAnimation',window.quantumAnimation);console.log('✅ 量子动画系统已注册');}}setupEventListeners(){if('connection' in navigator){navigator.connection.addEventListener('change',()=>{this.handleConnectionChange();});}document.addEventListener('visibilitychange',()=>{this.handleVisibilityChange();});if(window.quantumChatIntegrator){window.quantumChatIntegrator.on('chatEvent',(data)=>{this.handleQuantumEvent(data);});}this.addBackgroundToggle();}addBackgroundToggle(){const toggleButton=document.createElement('button');toggleButton.id='backgroundModeToggle';toggleButton.innerHTML=` <i class="fas fa-palette"></i> <span>背景模式</span> `;toggleButton.className='fixed top-4 left-4 z-50 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg px-3 py-2 text-white hover:bg-white/20 transition-all duration-300 text-sm';toggleButton.style.cssText=` display: flex;align-items: center;gap: 8px;font-size: 12px;`;toggleButton.addEventListener('click',()=>{this.toggleBackgroundMode();});document.body.appendChild(toggleButton);document.addEventListener('keydown',(e)=>{if(e.ctrlKey && e.key==='b'){e.preventDefault();this.toggleBackgroundMode();}});}toggleBackgroundMode(){const modes=['minimalist','quantum','hybrid'];const currentIndex=modes.indexOf(this.currentMode);const nextMode=modes[(currentIndex+1)% modes.length];this.setBackgroundMode(nextMode);this.showModeNotification(nextMode);}setBackgroundMode(mode){console.log(`🎨 切换背景模式: ${this.currentMode}→ ${mode}`);this.disableCurrentMode();this.currentMode=mode;this.applyBackgroundMode(mode);localStorage.setItem('backgroundMode',mode);}applyBackgroundMode(mode){const body=document.body;body.classList.remove('bg-minimalist','bg-quantum','bg-hybrid');switch(mode){case 'minimalist': this.enableMinimalistMode();body.classList.add('bg-minimalist');break;case 'quantum': if(this.performanceMode !=='low'){this.enableQuantumMode();body.classList.add('bg-quantum');}else{this.enableMinimalistMode();body.classList.add('bg-minimalist');console.warn('⚠️ 低性能设备，降级到极简模式');}break;case 'hybrid': this.enableHybridMode();body.classList.add('bg-hybrid');break;}}enableMinimalistMode(){console.log('🎨 启用极简主义背景模式');const minimalistBg=this.backgroundSystems.get('minimalist');if(minimalistBg && minimalistBg.enable){minimalistBg.enable();}this.disableQuantumSystems();}enableQuantumMode(){console.log('🌌 启用量子背景模式');const minimalistBg=this.backgroundSystems.get('minimalist');if(minimalistBg && minimalistBg.disable){minimalistBg.disable();}this.enableQuantumSystems();}enableHybridMode(){console.log('🔄 启用混合背景模式');const minimalistBg=this.backgroundSystems.get('minimalist');if(minimalistBg && minimalistBg.enable){minimalistBg.enable();minimalistBg.setIntensity(0.5);}const quantumSystem=this.backgroundSystems.get('quantum');if(quantumSystem && quantumSystem.enable){quantumSystem.enable();if(quantumSystem.setOpacity)quantumSystem.setOpacity(0.3);}}disableCurrentMode(){this.backgroundSystems.forEach((system,name)=>{if(system && system.disable){system.disable();}});}enableQuantumSystems(){const quantumSystem=this.backgroundSystems.get('quantum');if(quantumSystem){if(quantumSystem.enable)quantumSystem.enable();this.quantumEnabled=true;}const quantumAnimation=this.backgroundSystems.get('quantumAnimation');if(quantumAnimation && quantumAnimation.enable){quantumAnimation.enable();}}disableQuantumSystems(){const quantumSystem=this.backgroundSystems.get('quantum');if(quantumSystem && quantumSystem.disable){quantumSystem.disable();}const quantumAnimation=this.backgroundSystems.get('quantumAnimation');if(quantumAnimation && quantumAnimation.hide){quantumAnimation.hide();}this.quantumEnabled=false;}handleQuantumEvent(data){if(this.currentMode==='quantum' || this.currentMode==='hybrid'){if(window.quantumChatIntegrator){window.quantumChatIntegrator.triggerChatEvent(data.eventType,data);}}}handleConnectionChange(){const connection=navigator.connection;if(connection && connection.effectiveType){const slowConnection=['slow-2g','2g'].includes(connection.effectiveType);if(slowConnection && this.currentMode==='quantum'){console.log('📶 检测到慢速网络，切换到极简模式');this.setBackgroundMode('minimalist');}}}handleVisibilityChange(){if(document.hidden){this.pauseAnimations();}else{this.resumeAnimations();}}pauseAnimations(){this.backgroundSystems.forEach((system)=>{if(system && system.pause){system.pause();}});}resumeAnimations(){this.backgroundSystems.forEach((system)=>{if(system && system.resume){system.resume();}});}showModeNotification(mode){const modeNames={minimalist: '极简主义',quantum: '量子动画',hybrid: '混合模式'};const notification=document.createElement('div');notification.className='fixed top-20 left-4 z-50 bg-blue-600/90 backdrop-blur-md border border-blue-400/30 rounded-lg px-4 py-2 text-white text-sm';notification.innerHTML=`🎨 已切换到 ${modeNames[mode]}背景模式`;document.body.appendChild(notification);setTimeout(()=>{notification.style.opacity='0';setTimeout(()=> notification.remove(),300);},2000);}getCurrentMode(){return this.currentMode;}getPerformanceMode(){return this.performanceMode;}isQuantumEnabled(){return this.quantumEnabled;}getSystemStatus(){return{currentMode: this.currentMode,performanceMode: this.performanceMode,quantumEnabled: this.quantumEnabled,availableSystems: Array.from(this.backgroundSystems.keys()),memoryUsage: performance.memory ? Math.round(performance.memory.usedJSHeapSize/1024/1024): 'Unknown'};}}document.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>{if(!window.unifiedBackgroundManager){window.unifiedBackgroundManager=new UnifiedBackgroundManager();const savedMode=localStorage.getItem('backgroundMode');if(savedMode && ['minimalist','quantum','hybrid'].includes(savedMode)){window.unifiedBackgroundManager.setBackgroundMode(savedMode);}}},1000);});console.log('📦 统一背景管理器模块已加载');class MinimalistBackground{constructor(){this.container=null;this.isInitialized=false;this.animationFrameId=null;this.performanceMode=this.detectPerformanceMode();this.init();}detectPerformanceMode(){const canvas=document.createElement('canvas');const gl=canvas.getContext('webgl')|| canvas.getContext('experimental-webgl');if(!gl)return 'low';const renderer=gl.getParameter(gl.RENDERER).toLowerCase();if(renderer.includes('intel')|| renderer.includes('software')){return 'low';}else if(renderer.includes('nvidia')|| renderer.includes('amd')){return 'high';}return 'medium';}init(){console.log('🎨 初始化简约科技背景...');const oldContainer=document.getElementById('backgroundContainer');if(oldContainer){oldContainer.remove();}this.container=document.createElement('div');this.container.id='minimalistBackground';this.container.className='minimalist-background';this.createBackgroundElements();document.body.insertBefore(this.container,document.body.firstChild);this.isInitialized=true;console.log('✅ 简约科技背景初始化完成');window.dispatchEvent(new CustomEvent('minimalistBackgroundReady'));}createBackgroundElements(){if(this.performanceMode !=='low'){const particles=document.createElement('div');particles.className='minimalist-particles';this.container.appendChild(particles);}const grid=document.createElement('div');grid.className='minimalist-grid';this.container.appendChild(grid);if(this.performanceMode==='high'){const glow=document.createElement('div');glow.className='minimalist-glow';this.container.appendChild(glow);}this.createTechLines();}createTechLines(){const linesContainer=document.createElement('div');linesContainer.className='tech-lines';const lineCount=this.performanceMode==='high' ? 3 : this.performanceMode==='medium' ? 2 : 1;for(let i=0;i < lineCount;i++){const line=document.createElement('div');line.className='tech-line';linesContainer.appendChild(line);}this.container.appendChild(linesContainer);}setTheme(theme){if(!this.container)return;const themes={blue: 'linear-gradient(135deg,#0a0e1a 0%,#1a1a2e 50%,#16213e 100%)',purple: 'linear-gradient(135deg,#0f0a1a 0%,#1f1a2e 50%,#2e1a3e 100%)',green: 'linear-gradient(135deg,#0a1a0e 0%,#1a2e1a 50%,#1e3e16 100%)',default: 'linear-gradient(135deg,#0a0e1a 0%,#1a1a2e 50%,#16213e 100%)'};this.container.style.background=themes[theme] || themes.default;console.log(`🎨 背景主题已切换为: ${theme}`);}onUserInteraction(event){if(!this.container)return;const ripple=document.createElement('div');ripple.style.cssText=` position: absolute;width: 100px;height: 100px;border-radius: 50%;background: radial-gradient(circle,rgba(79,172,254,0.3)0%,transparent 70%);pointer-events: none;animation: ripple-effect 2s ease-out forwards;left: ${event.clientX-50}px;top: ${event.clientY-50}px;`;const style=document.createElement('style');style.textContent=` @keyframes ripple-effect{0%{transform: scale(0);opacity: 1;}100%{transform: scale(3);opacity: 0;}}`;if(!document.head.querySelector('style[data-ripple]')){style.setAttribute('data-ripple','true');document.head.appendChild(style);}this.container.appendChild(ripple);setTimeout(()=>{if(ripple.parentNode){ripple.parentNode.removeChild(ripple);}},2000);}pauseAnimations(){if(this.container){this.container.style.animationPlayState='paused';this.container.querySelectorAll('*').forEach(el=>{el.style.animationPlayState='paused';});}}resumeAnimations(){if(this.container){this.container.style.animationPlayState='running';this.container.querySelectorAll('*').forEach(el=>{el.style.animationPlayState='running';});}}destroy(){if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId);}if(this.container && this.container.parentNode){this.container.parentNode.removeChild(this.container);}this.isInitialized=false;console.log('🧹 简约科技背景已清理');}updateState(state){if(state && state.theme){this.setTheme(state.theme);}}triggerAnimation(type){console.log(`🎬 触发动画: ${type}`);}}window.minimalistBackground=null;function initMinimalistBackground(){if(!window.minimalistBackground){window.minimalistBackground=new MinimalistBackground();document.addEventListener('click',(e)=>{if(window.minimalistBackground){window.minimalistBackground.onUserInteraction(e);}});document.addEventListener('visibilitychange',()=>{if(!window.minimalistBackground)return;if(document.hidden){window.minimalistBackground.pauseAnimations();}else{window.minimalistBackground.resumeAnimations();}});console.log('🌟 简约背景系统已启动');}}window.quantumParticleSystem={updateState:(state)=>{if(window.minimalistBackground){window.minimalistBackground.updateState(state);}},triggerAnimation:(type)=>{if(window.minimalistBackground){window.minimalistBackground.triggerAnimation(type);}}};if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initMinimalistBackground);}else{initMinimalistBackground();}if(typeof module !=='undefined' && module.exports){module.exports=MinimalistBackground;}