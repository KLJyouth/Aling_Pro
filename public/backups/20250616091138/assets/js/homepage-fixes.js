 class HomepageFixes { constructor() { this.isInitialized = false; this.currentTheme = 'dark'; // é»˜è®¤æ·±è‰²ä¸»é¢˜ this.chatSystem = null; this.init(); } async init() { console.log('ğŸ”§ åˆå§‹åŒ–é¦–é¡µåŠŸèƒ½ä¿®å¤...'); try { await this.initThemeSystem(); await this.initContactForm(); await this.initAIAssistant(); this.isInitialized = true; console.log('âœ… é¦–é¡µåŠŸèƒ½ä¿®å¤å®Œæˆ'); } catch (error) { console.error('âŒ é¦–é¡µåŠŸèƒ½ä¿®å¤å¤±è´¥:', error); } } async initThemeSystem() { console.log('ğŸ¨ åˆå§‹åŒ–ä¸»é¢˜ç³»ç»Ÿ...'); // ä»localStorageåŠ è½½ä¿å­˜çš„ä¸»é¢˜ const savedTheme = localStorage.getItem('alingai-theme') || 'dark'; this.currentTheme = savedTheme; // åº”ç”¨ä¸»é¢˜ this.applyTheme(this.currentTheme); // åˆ›å»ºä¸»é¢˜åˆ‡æ¢æŒ‰é’® this.createThemeToggle(); // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ– if (window.matchMedia) { window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => { if (!localStorage.getItem('alingai-theme')) { this.setTheme(e.matches ? 'dark' : 'light'); } }); } } createThemeToggle() { // æŸ¥æ‰¾å¯¼èˆªæ æˆ–åˆé€‚çš„ä½ç½® const nav = document.querySelector('nav') || document.querySelector('header'); if (!nav) return; // åˆ›å»ºä¸»é¢˜åˆ‡æ¢å®¹å™¨ const themeToggleContainer = document.createElement('div'); themeToggleContainer.className = 'theme-toggle-container'; themeToggleContainer.innerHTML = ` <button id="themeToggle" class="theme-toggle-btn" title="åˆ‡æ¢ä¸»é¢˜"> <i class="fas fa-sun theme-icon light-icon"></i> <i class="fas fa-moon theme-icon dark-icon"></i> </button> `; // æ·»åŠ æ ·å¼ const style = document.createElement('style'); style.textContent = ` .theme-toggle-container { position: fixed; top: 20px; right: 20px; z-index: 10000; } .theme-toggle-btn { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--border-color, rgba(255, 255, 255, 0.2)); background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; position: relative; overflow: hidden; } .theme-toggle-btn:hover { transform: scale(1.1); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3); } .theme-icon { position: absolute; font-size: 20px; transition: all 0.3s ease; } .light-icon { color: #fbbf24; opacity: 0; transform: rotate(180deg) scale(0); } .dark-icon { color: #e5e7eb; opacity: 1; transform: rotate(0deg) scale(1); } body.light-theme .light-icon { opacity: 1; transform: rotate(0deg) scale(1); } body.light-theme .dark-icon { opacity: 0; transform: rotate(-180deg) scale(0); } :root { --bg-primary: #0a0016; --bg-secondary: rgba(10, 0, 22, 0.9); --text-primary: #ffffff; --text-secondary: #e5e7eb; --border-color: rgba(255, 255, 255, 0.2); --accent-color: #667eea; } body.light-theme { --bg-primary: #ffffff; --bg-secondary: rgba(255, 255, 255, 0.9); --text-primary: #1f2937; --text-secondary: #4b5563; --border-color: rgba(0, 0, 0, 0.1); --accent-color: #3b82f6; } body { background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; } .glass-card { background: var(--bg-secondary); border-color: var(--border-color); } .text-gray-300 { color: var(--text-secondary); } `; document.head.appendChild(style); // æ·»åŠ åˆ°é¡µé¢ document.body.appendChild(themeToggleContainer); // ç»‘å®šäº‹ä»¶ document.getElementById('themeToggle').addEventListener('click', () => { this.toggleTheme(); }); } toggleTheme() { const newTheme = this.currentTheme === 'dark' ? 'light' : 'dark'; this.setTheme(newTheme); } setTheme(theme) { this.currentTheme = theme; this.applyTheme(theme); localStorage.setItem('alingai-theme', theme); } applyTheme(theme) { document.body.classList.remove('light-theme', 'dark-theme'); document.body.classList.add(`${theme}-theme`); // æ›´æ–°metaæ ‡ç­¾ let themeColorMeta = document.querySelector('meta[name="theme-color"]'); if (!themeColorMeta) { themeColorMeta = document.createElement('meta'); themeColorMeta.name = 'theme-color'; document.head.appendChild(themeColorMeta); } themeColorMeta.content = theme === 'dark' ? '#0a0016' : '#ffffff'; } async initContactForm() { console.log('ğŸ“§ åˆå§‹åŒ–è”ç³»è¡¨å•...'); const contactForm = document.getElementById('contactForm'); if (!contactForm) { console.warn('æœªæ‰¾åˆ°è”ç³»è¡¨å•'); return; } // ç§»é™¤åŸæœ‰çš„äº‹ä»¶ç›‘å¬å™¨ contactForm.replaceWith(contactForm.cloneNode(true)); const newContactForm = document.getElementById('contactForm'); // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨ newContactForm.addEventListener('submit', async (e) => { e.preventDefault(); await this.handleContactFormSubmit(e); }); // æ·»åŠ å®æ—¶éªŒè¯ this.addFormValidation(newContactForm); } async handleContactFormSubmit(event) { const form = event.target; const submitBtn = form.querySelector('button[type="submit"]'); const originalText = submitBtn.textContent; try { // æ˜¾ç¤ºåŠ è½½çŠ¶æ€ submitBtn.disabled = true; submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å‘é€ä¸­...'; // è·å–è¡¨å•æ•°æ® const formData = new FormData(form); const data = Object.fromEntries(formData); // éªŒè¯æ•°æ® if (!this.validateContactForm(data)) { throw new Error('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ'); } // å‘é€åˆ°åç«¯API const response = await fetch(API_ENDPOINTS.CONTACT, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify(data) }); const result = await response.json(); if (result.success) { this.showNotification('success', result.message); form.reset(); // æ·»åŠ æˆåŠŸåŠ¨ç”» this.addSuccessAnimation(form); } else { throw new Error(result.message || 'å‘é€å¤±è´¥'); } } catch (error) { console.error('è”ç³»è¡¨å•æäº¤é”™è¯¯:', error); this.showNotification('error', error.message || 'å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'); } finally { // æ¢å¤æŒ‰é’®çŠ¶æ€ submitBtn.disabled = false; submitBtn.textContent = originalText; } } validateContactForm(data) { const required = ['name', 'email', 'message']; const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; for (let field of required) { if (!data[field] || data[field].trim() === '') { this.showFieldError(field, 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹'); return false; } } if (!emailRegex.test(data.email)) { this.showFieldError('email', 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'); return false; } return true; } addFormValidation(form) { const inputs = form.querySelectorAll('input, textarea'); inputs.forEach(input => { input.addEventListener('blur', () => { this.validateField(input); }); input.addEventListener('input', () => { this.clearFieldError(input.name); }); }); } validateField(input) { const value = input.value.trim(); const name = input.name; if (input.required && !value) { this.showFieldError(name, 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹'); return false; } if (name === 'email' && value) { const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; if (!emailRegex.test(value)) { this.showFieldError(name, 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'); return false; } } this.clearFieldError(name); return true; } showFieldError(fieldName, message) { const field = document.querySelector(`[name="${fieldName}"]`); if (!field) return; // ç§»é™¤æ—§çš„é”™è¯¯ä¿¡æ¯ this.clearFieldError(fieldName); // æ·»åŠ é”™è¯¯æ ·å¼ field.classList.add('error'); // åˆ›å»ºé”™è¯¯ä¿¡æ¯å…ƒç´  const errorDiv = document.createElement('div'); errorDiv.className = 'field-error'; errorDiv.textContent = message; // æ’å…¥é”™è¯¯ä¿¡æ¯ field.parentNode.appendChild(errorDiv); // æ·»åŠ é”™è¯¯æ ·å¼ const style = document.createElement('style'); style.textContent = ` .field-error { color: #ef4444; font-size: 12px; margin-top: 4px; animation: slideDown 0.3s ease; } input.error, textarea.error { border-color: #ef4444 !important; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1); } @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } } `; if (!document.querySelector('.field-error-styles')) { style.className = 'field-error-styles'; document.head.appendChild(style); } } clearFieldError(fieldName) { const field = document.querySelector(`[name="${fieldName}"]`); if (!field) return; field.classList.remove('error'); const errorDiv = field.parentNode.querySelector('.field-error'); if (errorDiv) { errorDiv.remove(); } } addSuccessAnimation(form) { form.style.transform = 'scale(0.95)'; form.style.transition = 'transform 0.2s ease'; setTimeout(() => { form.style.transform = 'scale(1)'; }, 200); } async initAIAssistant() { console.log('ğŸ¤– åˆå§‹åŒ–AIåŠ©æ‰‹...'); try { // æ£€æŸ¥æ˜¯å¦å·²æœ‰èŠå¤©ç³»ç»Ÿ if (window.ChatSystem) { this.chatSystem = new window.ChatSystem({ apiEndpoint: API_ENDPOINTS.CHAT, enableQuantumEffects: true, autoSave: true }); console.log('âœ… AIåŠ©æ‰‹èŠå¤©ç³»ç»Ÿå·²åˆå§‹åŒ–'); } else { console.warn('âš ï¸ ChatSystemç±»æœªæ‰¾åˆ°ï¼Œåˆ›å»ºåŸºç¡€èŠå¤©åŠŸèƒ½'); await this.createBasicChatSystem(); } // æ·»åŠ èŠå¤©æŒ‰é’® this.createChatButton(); } catch (error) { console.error('âŒ AIåŠ©æ‰‹åˆå§‹åŒ–å¤±è´¥:', error); } } async createBasicChatSystem() { this.chatSystem = { isOpen: false, toggle: () => { this.chatSystem.isOpen = !this.chatSystem.isOpen; const chatModal = document.getElementById('chatModal'); if (chatModal) { chatModal.style.display = this.chatSystem.isOpen ? 'flex' : 'none'; } }, sendMessage: async (message) => { try { // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯ this.addChatMessage('user', message); // å‘é€åˆ°API const response = await fetch(API_ENDPOINTS.CHAT, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ message }) }); const result = await response.json(); // æ˜¾ç¤ºAIå›å¤ this.addChatMessage('ai', result.response || 'æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜ã€‚'); } catch (error) { console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error); this.addChatMessage('ai', 'æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚'); } } }; } createChatButton() { // åˆ›å»ºèŠå¤©æŒ‰é’® const chatButton = document.createElement('div'); chatButton.id = 'chatButton'; chatButton.innerHTML = ` <button class="chat-toggle-btn" title="AIæ™ºèƒ½åŠ©æ‰‹"> <i class="fas fa-robot"></i> <span class="chat-badge">AI</span> </button> `; // åˆ›å»ºèŠå¤©æ¨¡æ€æ¡† const chatModal = document.createElement('div'); chatModal.id = 'chatModal'; chatModal.innerHTML = ` <div class="chat-modal-content"> <div class="chat-header"> <h3><i class="fas fa-robot"></i> AIæ™ºèƒ½åŠ©æ‰‹</h3> <button class="chat-close-btn">&times;</button> </div> <div class="chat-messages" id="chatMessages"> <div class="chat-message ai-message"> <div class="message-content"> æ‚¨å¥½ï¼æˆ‘æ˜¯AlingAi Proçš„AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ </div> </div> </div> <div class="chat-input-container"> <input type="text" id="chatInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." /> <button id="chatSendBtn"><i class="fas fa-paper-plane"></i></button> </div> </div> `; // æ·»åŠ æ ·å¼ const chatStyles = document.createElement('style'); chatStyles.textContent = ` #chatButton { position: fixed; bottom: 20px; right: 20px; z-index: 9999; } .chat-toggle-btn { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; cursor: pointer; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4); display: flex; align-items: center; justify-content: center; position: relative; transition: all 0.3s ease; } .chat-toggle-btn:hover { transform: scale(1.1); box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6); } .chat-toggle-btn i { color: white; font-size: 24px; } .chat-badge { position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; border-radius: 10px; padding: 2px 6px; font-size: 10px; font-weight: bold; } #chatModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); z-index: 10000; display: none; align-items: center; justify-content: center; } .chat-modal-content { width: 400px; height: 500px; background: var(--bg-secondary, rgba(10, 0, 22, 0.95)); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); } .chat-header { padding: 15px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; justify-content: space-between; align-items: center; } .chat-header h3 { margin: 0; font-size: 16px; } .chat-close-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.3s ease; } .chat-close-btn:hover { background: rgba(255, 255, 255, 0.2); } .chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; } .chat-message { max-width: 80%; word-wrap: break-word; } .user-message { align-self: flex-end; } .ai-message { align-self: flex-start; } .message-content { padding: 12px 16px; border-radius: 15px; line-height: 1.4; } .user-message .message-content { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-bottom-right-radius: 5px; } .ai-message .message-content { background: rgba(255, 255, 255, 0.1); color: var(--text-primary, white); border-bottom-left-radius: 5px; } .chat-input-container { padding: 15px 20px; background: rgba(255, 255, 255, 0.05); display: flex; gap: 10px; align-items: center; } #chatInput { flex: 1; padding: 12px 16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 25px; background: rgba(255, 255, 255, 0.1); color: var(--text-primary, white); outline: none; transition: all 0.3s ease; } #chatInput:focus { border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); } #chatSendBtn { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; } #chatSendBtn:hover { transform: scale(1.1); } @media (max-width: 480px) { .chat-modal-content { width: 90%; height: 80%; } } `; document.head.appendChild(chatStyles); // æ·»åŠ åˆ°é¡µé¢ document.body.appendChild(chatButton); document.body.appendChild(chatModal); // ç»‘å®šäº‹ä»¶ document.querySelector('.chat-toggle-btn').addEventListener('click', () => { this.chatSystem.toggle(); }); document.querySelector('.chat-close-btn').addEventListener('click', () => { this.chatSystem.toggle(); }); // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­ chatModal.addEventListener('click', (e) => { if (e.target === chatModal) { this.chatSystem.toggle(); } }); // è¾“å…¥æ¡†äº‹ä»¶ const chatInput = document.getElementById('chatInput'); const sendBtn = document.getElementById('chatSendBtn'); sendBtn.addEventListener('click', () => { this.sendChatMessage(); }); chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { this.sendChatMessage(); } }); } async sendChatMessage() { const input = document.getElementById('chatInput'); const message = input.value.trim(); if (!message) return; input.value = ''; if (this.chatSystem && this.chatSystem.sendMessage) { await this.chatSystem.sendMessage(message); } } addChatMessage(type, content) { const messagesContainer = document.getElementById('chatMessages'); if (!messagesContainer) return; const messageDiv = document.createElement('div'); messageDiv.className = `chat-message ${type}-message`; messageDiv.innerHTML = ` <div class="message-content"> ${content} </div> `; messagesContainer.appendChild(messageDiv); messagesContainer.scrollTop = messagesContainer.scrollHeight; } showNotification(type, message) { // ç§»é™¤ç°æœ‰é€šçŸ¥ const existingNotification = document.querySelector('.notification'); if (existingNotification) { existingNotification.remove(); } // åˆ›å»ºé€šçŸ¥å…ƒç´  const notification = document.createElement('div'); notification.className = `notification notification-${type}`; notification.innerHTML = ` <div class="notification-content"> <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> <span>${message}</span> <button class="notification-close">&times;</button> </div> `; // æ·»åŠ æ ·å¼ const notificationStyles = document.createElement('style'); notificationStyles.textContent = ` .notification { position: fixed; top: 20px; right: 20px; z-index: 10001; min-width: 300px; max-width: 500px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); backdrop-filter: blur(20px); animation: slideInRight 0.3s ease; } .notification-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: 1px solid rgba(16, 185, 129, 0.3); } .notification-error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: 1px solid rgba(239, 68, 68, 0.3); } .notification-content { padding: 15px 20px; display: flex; align-items: center; gap: 10px; color: white; } .notification-content i { font-size: 18px; flex-shrink: 0; } .notification-content span { flex: 1; font-size: 14px; line-height: 1.4; } .notification-close { background: none; border: none; color: white; font-size: 18px; cursor: pointer; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.3s ease; flex-shrink: 0; } .notification-close:hover { background: rgba(255, 255, 255, 0.2); } @keyframes slideInRight { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } } @keyframes slideOutRight { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(100%); } } `; if (!document.querySelector('.notification-styles')) { notificationStyles.className = 'notification-styles'; document.head.appendChild(notificationStyles); } // æ·»åŠ åˆ°é¡µé¢ document.body.appendChild(notification); // ç»‘å®šå…³é—­äº‹ä»¶ notification.querySelector('.notification-close').addEventListener('click', () => { this.hideNotification(notification); }); // è‡ªåŠ¨æ¶ˆå¤± setTimeout(() => { if (notification.parentNode) { this.hideNotification(notification); } }, 5000); } hideNotification(notification) { notification.style.animation = 'slideOutRight 0.3s ease'; setTimeout(() => { if (notification.parentNode) { notification.remove(); } }, 300); } } // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– document.addEventListener('DOMContentLoaded', () => { window.homepageFixes = new HomepageFixes(); }); // ç¡®ä¿åœ¨ç°æœ‰ä»£ç æ‰§è¡Œåä¹Ÿèƒ½åˆå§‹åŒ– if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', () => { if (!window.homepageFixes) { window.homepageFixes = new HomepageFixes(); } }); } else { if (!window.homepageFixes) { window.homepageFixes = new HomepageFixes(); } } 