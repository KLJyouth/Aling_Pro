// æœ€ç»ˆåŠŸèƒ½éªŒè¯è„šæœ¬ - æ‰‹åŠ¨è§¦å‘èŠå¤©æµ‹è¯• // åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œ: runFinalVerification() console.log('ğŸ¯ åŠ è½½æœ€ç»ˆåŠŸèƒ½éªŒè¯è„šæœ¬...'); // å»¶è¿Ÿæ‰§è¡Œå‡½æ•° const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)); // æ£€æŸ¥è®¡æ•°å™¨ let checkCount = 0; const maxChecks = 5; // æœ€ç»ˆéªŒè¯æµ‹è¯• window.runFinalVerification = async function() { console.log('ğŸš€ å¼€å§‹æœ€ç»ˆåŠŸèƒ½éªŒè¯...\n'); let testResults = { domCheck: false, chatInstance: false, guestMode: false, messageTest: false, uiResponse: false }; try { // 1. DOMæ£€æŸ¥ console.log('1ï¸âƒ£ æ£€æŸ¥æ ¸å¿ƒDOMå…ƒç´ ...'); const coreElements = [ 'messageInput', 'sendButton', 'chatMessages', 'guestModeButton', 'userStatus' ]; const missingElements = coreElements.filter(id => !document.getElementById(id)); if (missingElements.length === 0) { console.log(' âœ… æ‰€æœ‰æ ¸å¿ƒDOMå…ƒç´ å­˜åœ¨'); testResults.domCheck = true; } else { console.log(' âŒ ç¼ºå°‘å…ƒç´ :', missingElements); } // 2. èŠå¤©å®ä¾‹æ£€æŸ¥ console.log('\n2ï¸âƒ£ æ£€æŸ¥èŠå¤©å®ä¾‹...'); if (window.chatInstance && window.chatInstance.core && window.chatInstance.ui && window.chatInstance.api) { console.log(' âœ… èŠå¤©å®ä¾‹å®Œæ•´åŠ è½½'); testResults.chatInstance = true; } else { console.log(' âŒ èŠå¤©å®ä¾‹æœªå®Œå…¨åŠ è½½'); console.log(' å®ä¾‹çŠ¶æ€:', { chatInstance: !!window.chatInstance, core: !!(window.chatInstance?.core), ui: !!(window.chatInstance?.ui), api: !!(window.chatInstance?.api) }); } // 3. è®¿å®¢æ¨¡å¼æ¿€æ´» console.log('\n3ï¸âƒ£ æ¿€æ´»è®¿å®¢æ¨¡å¼...'); localStorage.removeItem('guestMode'); localStorage.removeItem('token'); const guestBtn = document.getElementById('guestModeButton'); if (guestBtn) { guestBtn.click(); await delay(500); const guestModeSet = localStorage.getItem('guestMode') === 'true'; const userStatus = document.getElementById('userStatus'); const statusText = userStatus ? userStatus.textContent : ''; if (guestModeSet && statusText.includes('è®¿å®¢')) { console.log(' âœ… è®¿å®¢æ¨¡å¼æ¿€æ´»æˆåŠŸ'); console.log(' ğŸ“‹ ç”¨æˆ·çŠ¶æ€:', statusText); testResults.guestMode = true; } else { console.log(' âŒ è®¿å®¢æ¨¡å¼æ¿€æ´»å¤±è´¥'); console.log(' localStorage:', localStorage.getItem('guestMode')); console.log(' çŠ¶æ€æ–‡æœ¬:', statusText); } } else { console.log(' âŒ è®¿å®¢æ¨¡å¼æŒ‰é’®ä¸å­˜åœ¨'); } // 4. æ¶ˆæ¯å‘é€æµ‹è¯• console.log('\n4ï¸âƒ£ æµ‹è¯•æ¶ˆæ¯å‘é€...'); const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); const chatMessages = document.getElementById('chatMessages'); if (messageInput && sendButton && chatMessages) { const initialCount = chatMessages.children.length; // è¾“å…¥æµ‹è¯•æ¶ˆæ¯ const testMessage = 'ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯'; messageInput.value = testMessage; messageInput.dispatchEvent(new Event('input')); console.log(' ğŸ“ è¾“å…¥æµ‹è¯•æ¶ˆæ¯:', testMessage); console.log(' ğŸ”„ ç‚¹å‡»å‘é€æŒ‰é’®...'); // ç‚¹å‡»å‘é€ sendButton.click(); // ç­‰å¾…å¤„ç† await delay(2000); const finalCount = chatMessages.children.length; const messagesAdded = finalCount > initialCount; const inputCleared = messageInput.value === ''; if (messagesAdded && inputCleared) { console.log(' âœ… æ¶ˆæ¯å‘é€æˆåŠŸ'); console.log(' ğŸ“Š æ¶ˆæ¯æ•°é‡å˜åŒ–:', initialCount, 'â†’', finalCount); testResults.messageTest = true; // æ£€æŸ¥æ˜¯å¦æœ‰è®¿å®¢æ¨¡å¼å›å¤ const messages = Array.from(chatMessages.children); const lastMessages = messages.slice(-2); // è·å–æœ€åä¸¤æ¡æ¶ˆæ¯ const hasGuestResponse = lastMessages.some(msg => msg.textContent && ( msg.textContent.includes('è®¿å®¢æ¨¡å¼') || msg.textContent.includes('æ¼”ç¤ºå›å¤') || msg.textContent.includes('ç™»å½•') ) ); if (hasGuestResponse) { console.log(' âœ… æ”¶åˆ°è®¿å®¢æ¨¡å¼AIå›å¤'); testResults.uiResponse = true; } else { console.log(' âš ï¸ æœªæ£€æµ‹åˆ°è®¿å®¢æ¨¡å¼AIå›å¤'); console.log(' ğŸ’¬ æœ€æ–°æ¶ˆæ¯å†…å®¹:', lastMessages.map(m => m.textContent?.substring(0, 50))); } } else { console.log(' âŒ æ¶ˆæ¯å‘é€å¤±è´¥'); console.log(' è¯¦æƒ…:', { messagesAdded, inputCleared, initialCount, finalCount }); } } else { console.log(' âŒ æ¶ˆæ¯ç›¸å…³å…ƒç´ ç¼ºå¤±'); } // 5. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š console.log('\nğŸ“Š æœ€ç»ˆéªŒè¯ç»“æœ:'); console.log('================'); const results = [ { name: 'DOMå…ƒç´ æ£€æŸ¥', status: testResults.domCheck, icon: testResults.domCheck ? 'âœ…' : 'âŒ' }, { name: 'èŠå¤©å®ä¾‹åŠ è½½', status: testResults.chatInstance, icon: testResults.chatInstance ? 'âœ…' : 'âŒ' }, { name: 'è®¿å®¢æ¨¡å¼æ¿€æ´»', status: testResults.guestMode, icon: testResults.guestMode ? 'âœ…' : 'âŒ' }, { name: 'æ¶ˆæ¯å‘é€åŠŸèƒ½', status: testResults.messageTest, icon: testResults.messageTest ? 'âœ…' : 'âŒ' }, { name: 'AIå›å¤æ˜¾ç¤º', status: testResults.uiResponse, icon: testResults.uiResponse ? 'âœ…' : 'âŒ' } ]; results.forEach((result, index) => { console.log(`${index + 1}. ${result.icon} ${result.name}`); }); const passedTests = results.filter(r => r.status).length; const totalTests = results.length; const successRate = Math.round((passedTests / totalTests) * 100); console.log('\nğŸ“ˆ æµ‹è¯•ç»Ÿè®¡:'); console.log(` é€šè¿‡: ${passedTests}/${totalTests} (${successRate}%)`); if (successRate >= 80) { console.log('\nğŸ‰ èŠå¤©é¡µé¢åŠŸèƒ½éªŒè¯é€šè¿‡ï¼'); console.log('ğŸ’¡ æ‚¨ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨èŠå¤©åŠŸèƒ½äº†ã€‚'); } else if (successRate >= 60) { console.log('\nâš ï¸ èŠå¤©é¡µé¢åŸºæœ¬å¯ç”¨ï¼Œä½†æœ‰äº›åŠŸèƒ½éœ€è¦ä¼˜åŒ–ã€‚'); } else { console.log('\nâŒ èŠå¤©é¡µé¢å­˜åœ¨è¾ƒå¤šé—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•ã€‚'); } // è¿”å›ç»“æœä¾›åç»­ä½¿ç”¨ return { success: successRate >= 80, results: testResults, successRate, details: results }; } catch (error) { console.error('âŒ éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error); return { success: false, error: error.message }; } }; // å¿«é€Ÿæµ‹è¯•è®¿å®¢æ¨¡å¼èŠå¤© window.quickChatTest = function() { console.log('ğŸš€ å¿«é€ŸèŠå¤©æµ‹è¯•...'); // ç¡®ä¿è®¿å®¢æ¨¡å¼ localStorage.setItem('guestMode', 'true'); const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); if (messageInput && sendButton) { messageInput.value = 'ä½ å¥½ï¼ŒAlingAiï¼'; messageInput.dispatchEvent(new Event('input')); console.log('ğŸ“¤ å‘é€æµ‹è¯•æ¶ˆæ¯...'); sendButton.click(); console.log('â±ï¸ è¯·ç­‰å¾…2ç§’æŸ¥çœ‹ç»“æœ...'); } else { console.log('âŒ è¾“å…¥å…ƒç´ ä¸å­˜åœ¨'); } }; // æ£€æŸ¥é¡µé¢å°±ç»ªçŠ¶æ€ function checkPageReady() { checkCount++; const isReady = !!( document.getElementById('messageInput') && document.getElementById('sendButton') && window.chatInstance ); if (isReady) { console.log('âœ… é¡µé¢å·²å°±ç»ªï¼Œå¯ä»¥è¿è¡Œæµ‹è¯•'); console.log('ğŸ’¡ è¿è¡Œå‘½ä»¤:'); console.log(' - runFinalVerification() : å®Œæ•´åŠŸèƒ½éªŒè¯'); console.log(' - quickChatTest() : å¿«é€ŸèŠå¤©æµ‹è¯•'); checkCount = 0; } else if (checkCount < maxChecks) { console.log('â³ é¡µé¢å°šæœªå®Œå…¨åŠ è½½ï¼Œè¯·ç¨åé‡è¯•... (' + checkCount + '/' + maxChecks + ')'); setTimeout(checkPageReady, 2000); } else { console.log('âš ï¸ é¡µé¢åŠ è½½æ£€æŸ¥å·²è¾¾æœ€å¤§æ¬¡æ•°ï¼Œåœæ­¢é‡è¯•'); checkCount = 0; } } // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥ if (document.readyState === 'complete') { setTimeout(checkPageReady, 500); } else { window.addEventListener('load', () => setTimeout(checkPageReady, 500)); } console.log('âœ… æœ€ç»ˆéªŒè¯è„šæœ¬åŠ è½½å®Œæˆ!'); 