 class EnhancedUIManager { constructor() { this.isInitialized = false; this.components = new Map(); this.animations = new Map(); this.themes = { light: 'light-theme', dark: 'dark-theme', quantum: 'quantum-theme', highContrast: 'high-contrast-theme' }; this.currentTheme = localStorage.getItem('preferred-theme') || 'quantum'; this.notifications = []; this.modals = new Map(); this.init(); } async init() { if (this.isInitialized) return; try { await this.loadComponents(); this.setupEventListeners(); this.initializeTheme(); this.initializeAccessibility(); this.initializePerformanceMonitoring(); this.isInitialized = true; console.log('ğŸ¨ Enhanced UI Manager initialized successfully'); } catch (error) { console.error('âŒ Failed to initialize Enhanced UI Manager:', error); } } async loadComponents() { // åŠ è½½æ ¸å¿ƒUIç»„ä»¶ const components = [ 'NavigationComponent', 'ModalComponent', 'NotificationComponent', 'ChatComponent', 'FormComponent', 'AnimationComponent' ]; for (const componentName of components) { try { const component = await this.createComponent(componentName); this.components.set(componentName, component); } catch (error) { console.warn(`âš ï¸ Failed to load component ${componentName}:`, error); } } } async createComponent(name) { switch (name) { case 'NavigationComponent': return new NavigationComponent(this); case 'ModalComponent': return new ModalComponent(this); case 'NotificationComponent': return new NotificationComponent(this); case 'ChatComponent': return new ChatComponent(this); case 'FormComponent': return new FormComponent(this); case 'AnimationComponent': return new AnimationComponent(this); default: throw new Error(`Unknown component: ${name}`); } } setupEventListeners() { // å…¨å±€é”®ç›˜å¿«æ·é”® document.addEventListener('keydown', (e) => { this.handleGlobalKeyboard(e); }); // å“åº”å¼è®¾è®¡å¤„ç† window.addEventListener('resize', () => { this.handleResize(); }); // ç½‘ç»œçŠ¶æ€ç›‘æ§ window.addEventListener('online', () => { this.showNotification('ç½‘ç»œè¿æ¥å·²æ¢å¤', 'success'); }); window.addEventListener('offline', () => { this.showNotification('ç½‘ç»œè¿æ¥å·²æ–­å¼€', 'warning'); }); // é¡µé¢å¯è§æ€§å˜åŒ– document.addEventListener('visibilitychange', () => { this.handleVisibilityChange(); }); } handleGlobalKeyboard(event) { const { key, ctrlKey, altKey, shiftKey } = event; // Ctrl+K - å¿«é€Ÿæœç´¢ if (ctrlKey && key === 'k') { event.preventDefault(); this.openQuickSearch(); } // Ctrl+L - ç™»å½•æ¨¡æ€æ¡† if (ctrlKey && key === 'l') { event.preventDefault(); this.openModal('login'); } // Ctrl+/ - èŠå¤©çª—å£ if (ctrlKey && key === '/') { event.preventDefault(); this.toggleChat(); } // Ctrl+Alt+T - åˆ‡æ¢ä¸»é¢˜ if (ctrlKey && altKey && key === 't') { event.preventDefault(); this.cycleTheme(); } // Ctrl+Alt+H - é«˜å¯¹æ¯”åº¦æ¨¡å¼ if (ctrlKey && altKey && key === 'h') { event.preventDefault(); this.toggleHighContrast(); } // ESC - å…³é—­æ¨¡æ€æ¡† if (key === 'Escape') { this.closeAllModals(); } // F1 - å¸®åŠ© if (key === 'F1') { event.preventDefault(); this.showHelp(); } } handleResize() { const width = window.innerWidth; const height = window.innerHeight; // æ›´æ–°CSSå˜é‡ document.documentElement.style.setProperty('--viewport-width', `${width}px`); document.documentElement.style.setProperty('--viewport-height', `${height}px`); // é€šçŸ¥ç»„ä»¶å“åº”å¼å˜åŒ– this.components.forEach(component => { if (component.handleResize) { component.handleResize(width, height); } }); // ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ if (width < 768) { document.body.classList.add('mobile-view'); this.optimizeForMobile(); } else { document.body.classList.remove('mobile-view'); } } optimizeForMobile() { // ç¦ç”¨æŸäº›åŠ¨ç”»ä»¥æé«˜æ€§èƒ½ if (window.DeviceMotionEvent) { document.body.classList.add('mobile-device'); } // è°ƒæ•´è§¦æ‘¸åŒºåŸŸå¤§å° const touchElements = document.querySelectorAll('.btn, .card, .modal-trigger'); touchElements.forEach(el => { el.classList.add('touch-optimized'); }); } initializeTheme() { this.applyTheme(this.currentTheme); // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ– if (window.matchMedia) { const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)'); mediaQuery.addListener((e) => { if (this.currentTheme === 'auto') { this.applyTheme(e.matches ? 'dark' : 'light'); } }); } } applyTheme(themeName) { document.body.className = document.body.className.replace(/\b\w+-theme\b/g, ''); document.body.classList.add(this.themes[themeName] || this.themes.quantum); // æ›´æ–°metaæ ‡ç­¾ const themeColor = this.getThemeColor(themeName); this.updateMetaTheme(themeColor); this.currentTheme = themeName; localStorage.setItem('preferred-theme', themeName); // é€šçŸ¥ç»„ä»¶ä¸»é¢˜å˜åŒ– this.components.forEach(component => { if (component.onThemeChange) { component.onThemeChange(themeName); } }); } getThemeColor(theme) { const colors = { light: '#ffffff', dark: '#000000', quantum: '#0a0a23', highContrast: '#000000' }; return colors[theme] || colors.quantum; } updateMetaTheme(color) { let metaTheme = document.querySelector('meta[name="theme-color"]'); if (!metaTheme) { metaTheme = document.createElement('meta'); metaTheme.name = 'theme-color'; document.head.appendChild(metaTheme); } metaTheme.content = color; } cycleTheme() { const themes = Object.keys(this.themes); const currentIndex = themes.indexOf(this.currentTheme); const nextIndex = (currentIndex + 1) % themes.length; this.applyTheme(themes[nextIndex]); this.showNotification(`å·²åˆ‡æ¢åˆ° ${themes[nextIndex]} ä¸»é¢˜`, 'info'); } toggleHighContrast() { const isHighContrast = document.body.classList.contains('high-contrast'); document.body.classList.toggle('high-contrast', !isHighContrast); this.showNotification( `é«˜å¯¹æ¯”åº¦æ¨¡å¼å·²${isHighContrast ? 'å…³é—­' : 'å¼€å¯'}`, 'info' ); } initializeAccessibility() { // æ·»åŠ ARIAæ ‡ç­¾ this.enhanceAccessibility(); // ç„¦ç‚¹ç®¡ç† this.setupFocusManagement(); // å±å¹•é˜…è¯»å™¨æ”¯æŒ this.setupScreenReaderSupport(); } enhanceAccessibility() { // ä¸ºæ‰€æœ‰äº¤äº’å…ƒç´ æ·»åŠ ARIAæ ‡ç­¾ const interactiveElements = document.querySelectorAll( 'button, a, input, select, textarea, [tabindex]' ); interactiveElements.forEach(el => { if (!el.getAttribute('aria-label') && !el.getAttribute('aria-labelledby')) { const text = el.textContent.trim() || el.value || el.placeholder; if (text) { el.setAttribute('aria-label', text); } } }); } setupFocusManagement() { let focusedBeforeModal = null; // æ¨¡æ€æ¡†ç„¦ç‚¹ç®¡ç† document.addEventListener('modalOpen', (e) => { focusedBeforeModal = document.activeElement; const modal = e.detail.modal; const firstFocusable = modal.querySelector( 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])' ); if (firstFocusable) { firstFocusable.focus(); } }); document.addEventListener('modalClose', () => { if (focusedBeforeModal) { focusedBeforeModal.focus(); } }); } setupScreenReaderSupport() { // åˆ›å»ºå®æ—¶é€šçŸ¥åŒºåŸŸ const liveRegion = document.createElement('div'); liveRegion.setAttribute('aria-live', 'polite'); liveRegion.setAttribute('aria-atomic', 'true'); liveRegion.className = 'sr-only'; liveRegion.id = 'live-announcements'; document.body.appendChild(liveRegion); this.liveRegion = liveRegion; } announceToScreenReader(message) { if (this.liveRegion) { this.liveRegion.textContent = message; setTimeout(() => { this.liveRegion.textContent = ''; }, 1000); } } initializePerformanceMonitoring() { // ç›‘æ§é¡µé¢æ€§èƒ½ if ('PerformanceObserver' in window) { const observer = new PerformanceObserver((list) => { list.getEntries().forEach(entry => { if (entry.entryType === 'largest-contentful-paint') { console.log(`LCP: ${entry.startTime}ms`); } }); }); observer.observe({ entryTypes: ['largest-contentful-paint'] }); } // ç›‘æ§å†…å­˜ä½¿ç”¨ if ('memory' in performance) { setInterval(() => { const memory = performance.memory; if (memory.usedJSHeapSize > memory.jsHeapSizeLimit * 0.9) { console.warn('âš ï¸ Memory usage is getting high'); this.optimizeMemoryUsage(); } }, 30000); } } optimizeMemoryUsage() { // æ¸…ç†æœªä½¿ç”¨çš„ç»„ä»¶ this.components.forEach((component, name) => { if (component.cleanup && !component.isActive) { component.cleanup(); } }); // æ¸…ç†æ—§çš„é€šçŸ¥ this.notifications = this.notifications.slice(-10); // å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰ if (window.gc) { window.gc(); } } // æ¨¡æ€æ¡†ç®¡ç† openModal(modalType, options = {}) { const modalComponent = this.components.get('ModalComponent'); if (modalComponent) { return modalComponent.open(modalType, options); } } closeModal(modalId) { const modalComponent = this.components.get('ModalComponent'); if (modalComponent) { modalComponent.close(modalId); } } closeAllModals() { const modalComponent = this.components.get('ModalComponent'); if (modalComponent) { modalComponent.closeAll(); } } // é€šçŸ¥ç³»ç»Ÿ showNotification(message, type = 'info', duration = 5000) { const notificationComponent = this.components.get('NotificationComponent'); if (notificationComponent) { return notificationComponent.show(message, type, duration); } } // èŠå¤©åŠŸèƒ½ toggleChat() { const chatComponent = this.components.get('ChatComponent'); if (chatComponent) { chatComponent.toggle(); } } openQuickSearch() { // å®ç°å¿«é€Ÿæœç´¢åŠŸèƒ½ const searchModal = this.openModal('search', { title: 'å¿«é€Ÿæœç´¢', placeholder: 'æœç´¢åŠŸèƒ½ã€é¡µé¢æˆ–å†…å®¹...' }); } showHelp() { const helpContent = ` <div class="help-content"> <h3>é”®ç›˜å¿«æ·é”®</h3> <ul> <li><kbd>Ctrl</kbd> + <kbd>K</kbd> - å¿«é€Ÿæœç´¢</li> <li><kbd>Ctrl</kbd> + <kbd>L</kbd> - ç™»å½•</li> <li><kbd>Ctrl</kbd> + <kbd>/</kbd> - åˆ‡æ¢èŠå¤©</li> <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>T</kbd> - åˆ‡æ¢ä¸»é¢˜</li> <li><kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>H</kbd> - é«˜å¯¹æ¯”åº¦æ¨¡å¼</li> <li><kbd>ESC</kbd> - å…³é—­æ¨¡æ€æ¡†</li> <li><kbd>F1</kbd> - æ˜¾ç¤ºå¸®åŠ©</li> </ul> </div> `; this.openModal('help', { title: 'å¸®åŠ©ä¸å¿«æ·é”®', content: helpContent }); } handleVisibilityChange() { if (document.hidden) { // é¡µé¢éšè—æ—¶æš‚åœä¸€äº›æ“ä½œ this.pauseAnimations(); } else { // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤æ“ä½œ this.resumeAnimations(); } } pauseAnimations() { document.body.classList.add('animations-paused'); } resumeAnimations() { document.body.classList.remove('animations-paused'); } // è·å–ç»„ä»¶å®ä¾‹ getComponent(name) { return this.components.get(name); } // é”€æ¯ç®¡ç†å™¨ destroy() { this.components.forEach(component => { if (component.destroy) { component.destroy(); } }); this.components.clear(); this.animations.clear(); this.notifications = []; this.isInitialized = false; } } // å¯¼å‡ºä¸ºå…¨å±€å˜é‡ window.EnhancedUIManager = EnhancedUIManager; 