// èŠå¤©é¡µé¢ç»¼åˆéªŒè¯è„šæœ¬ // å¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œæ­¤è„šæœ¬æ¥éªŒè¯åŠŸèƒ½ console.log('ğŸš€ å¼€å§‹èŠå¤©é¡µé¢ç»¼åˆéªŒè¯...'); // å»¶è¿Ÿæ‰§è¡Œå‡½æ•° const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)); // éªŒè¯æ­¥éª¤ const verificationSteps = { // 1. DOM å…ƒç´ éªŒè¯ async verifyDOMElements() { console.log('ğŸ“‹ éªŒè¯ DOM å…ƒç´ ...'); const requiredElements = { 'loginModal': 'ç™»å½•æ¨¡æ€æ¡†', 'loginButton': 'ç™»å½•æŒ‰é’®', 'guestModeButton': 'è®¿å®¢æ¨¡å¼æŒ‰é’®', 'userStatus': 'ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º', 'messageInput': 'æ¶ˆæ¯è¾“å…¥æ¡†', 'sendButton': 'å‘é€æŒ‰é’®', 'chatMessages': 'èŠå¤©æ¶ˆæ¯åŒºåŸŸ', 'recordButton': 'è¯­éŸ³è¾“å…¥æŒ‰é’®', 'imageGenButton': 'å›¾åƒç”ŸæˆæŒ‰é’®', 'ttsButton': 'è¯­éŸ³æ’­æ”¾æŒ‰é’®', 'historyBtn': 'å†å²è®°å½•æŒ‰é’®', 'settingsBtn': 'è®¾ç½®æŒ‰é’®' }; const results = {}; for (const [id, desc] of Object.entries(requiredElements)) { const element = document.getElementById(id); results[id] = { exists: !!element, description: desc, element: element }; console.log(` ${results[id].exists ? 'âœ…' : 'âŒ'} ${desc} (${id})`); } const allExists = Object.values(results).every(r => r.exists); console.log(`ğŸ“‹ DOMå…ƒç´ éªŒè¯ ${allExists ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`); return { success: allExists, results }; }, // 2. èŠå¤©å®ä¾‹éªŒè¯ async verifyChatInstance() { console.log('ğŸ¤– éªŒè¯èŠå¤©å®ä¾‹...'); const hasInstance = !!window.chatInstance; const hasCore = hasInstance && !!window.chatInstance.core; const hasUI = hasInstance && !!window.chatInstance.ui; const hasAPI = hasInstance && !!window.chatInstance.api; console.log(` ${hasInstance ? 'âœ…' : 'âŒ'} èŠå¤©å®ä¾‹å­˜åœ¨`); console.log(` ${hasCore ? 'âœ…' : 'âŒ'} Core æ¨¡å—åŠ è½½`); console.log(` ${hasUI ? 'âœ…' : 'âŒ'} UI æ¨¡å—åŠ è½½`); console.log(` ${hasAPI ? 'âœ…' : 'âŒ'} API æ¨¡å—åŠ è½½`); if (hasAPI) { const apiInitialized = window.chatInstance.api.isInitialized; console.log(` ${apiInitialized ? 'âœ…' : 'âŒ'} API å·²åˆå§‹åŒ–`); } const allOK = hasInstance && hasCore && hasUI && hasAPI; console.log(`ğŸ¤– èŠå¤©å®ä¾‹éªŒè¯ ${allOK ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`); return { success: allOK, instance: window.chatInstance }; }, // 3. è®¿å®¢æ¨¡å¼éªŒè¯ async verifyGuestMode() { console.log('ğŸ‘¤ éªŒè¯è®¿å®¢æ¨¡å¼...'); // æ¸…é™¤ä¹‹å‰çš„çŠ¶æ€ localStorage.removeItem('guestMode'); localStorage.removeItem('token'); const guestBtn = document.getElementById('guestModeButton'); const userStatus = document.getElementById('userStatus'); if (!guestBtn) { console.log(' âŒ è®¿å®¢æ¨¡å¼æŒ‰é’®ä¸å­˜åœ¨'); return { success: false }; } // æ¨¡æ‹Ÿç‚¹å‡»è®¿å®¢æ¨¡å¼æŒ‰é’® console.log(' ğŸ”„ ç‚¹å‡»è®¿å®¢æ¨¡å¼æŒ‰é’®...'); guestBtn.click(); await delay(500); // æ£€æŸ¥çŠ¶æ€ const guestModeSet = localStorage.getItem('guestMode') === 'true'; const statusText = userStatus ? userStatus.textContent : ''; console.log(` ${guestModeSet ? 'âœ…' : 'âŒ'} è®¿å®¢æ¨¡å¼çŠ¶æ€è®¾ç½®`); console.log(` ${statusText.includes('è®¿å®¢') ? 'âœ…' : 'âŒ'} ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º: "${statusText}"`); const success = guestModeSet && statusText.includes('è®¿å®¢'); console.log(`ğŸ‘¤ è®¿å®¢æ¨¡å¼éªŒè¯ ${success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`); return { success, guestModeSet, statusText }; }, // 4. æ¶ˆæ¯è¾“å…¥éªŒè¯ async verifyMessageInput() { console.log('ğŸ’¬ éªŒè¯æ¶ˆæ¯è¾“å…¥...'); const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); if (!messageInput || !sendButton) { console.log(' âŒ è¾“å…¥å…ƒç´ ä¸å­˜åœ¨'); return { success: false }; } // æµ‹è¯•ç©ºè¾“å…¥ messageInput.value = ''; messageInput.dispatchEvent(new Event('input')); await delay(100); const emptyDisabled = sendButton.disabled; console.log(` ${emptyDisabled ? 'âœ…' : 'âŒ'} ç©ºè¾“å…¥æ—¶æŒ‰é’®ç¦ç”¨`); // æµ‹è¯•æœ‰å†…å®¹è¾“å…¥ messageInput.value = 'æµ‹è¯•æ¶ˆæ¯'; messageInput.dispatchEvent(new Event('input')); await delay(100); const textEnabled = !sendButton.disabled; console.log(` ${textEnabled ? 'âœ…' : 'âŒ'} æœ‰å†…å®¹æ—¶æŒ‰é’®å¯ç”¨`); // æ¸…ç©ºè¾“å…¥ messageInput.value = ''; const success = emptyDisabled && textEnabled; console.log(`ğŸ’¬ æ¶ˆæ¯è¾“å…¥éªŒè¯ ${success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`); return { success, emptyDisabled, textEnabled }; }, // 5. æ¶ˆæ¯å‘é€éªŒè¯ï¼ˆè®¿å®¢æ¨¡å¼ï¼‰ async verifyMessageSending() { console.log('ğŸ“¤ éªŒè¯æ¶ˆæ¯å‘é€ï¼ˆè®¿å®¢æ¨¡å¼ï¼‰...'); // ç¡®ä¿åœ¨è®¿å®¢æ¨¡å¼ localStorage.setItem('guestMode', 'true'); const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); const chatMessages = document.getElementById('chatMessages'); if (!messageInput || !sendButton || !chatMessages) { console.log(' âŒ å¿…è¦å…ƒç´ ä¸å­˜åœ¨'); return { success: false }; } // è®°å½•åˆå§‹æ¶ˆæ¯æ•°é‡ const initialMessageCount = chatMessages.children.length; // å‘é€æµ‹è¯•æ¶ˆæ¯ const testMessage = 'è¿™æ˜¯ä¸€æ¡è‡ªåŠ¨åŒ–æµ‹è¯•æ¶ˆæ¯'; messageInput.value = testMessage; messageInput.dispatchEvent(new Event('input')); console.log(' ğŸ”„ å‘é€æµ‹è¯•æ¶ˆæ¯...'); sendButton.click(); // ç­‰å¾…å¤„ç† await delay(2000); // æ£€æŸ¥ç»“æœ const finalMessageCount = chatMessages.children.length; const messagesAdded = finalMessageCount > initialMessageCount; const inputCleared = messageInput.value === ''; console.log(` ${messagesAdded ? 'âœ…' : 'âŒ'} æ¶ˆæ¯å·²æ·»åŠ åˆ°ç•Œé¢`); console.log(` ${inputCleared ? 'âœ…' : 'âŒ'} è¾“å…¥æ¡†å·²æ¸…ç©º`); console.log(` ğŸ“Š æ¶ˆæ¯æ•°é‡: ${initialMessageCount} â†’ ${finalMessageCount}`); // æ£€æŸ¥æ˜¯å¦æœ‰è®¿å®¢æ¨¡å¼å›å¤ const messages = Array.from(chatMessages.querySelectorAll('.message, [class*="message"]')); const hasGuestResponse = messages.some(msg => msg.textContent && msg.textContent.includes('è®¿å®¢æ¨¡å¼') ); console.log(` ${hasGuestResponse ? 'âœ…' : 'âŒ'} æ”¶åˆ°è®¿å®¢æ¨¡å¼å›å¤`); const success = messagesAdded && inputCleared && hasGuestResponse; console.log(`ğŸ“¤ æ¶ˆæ¯å‘é€éªŒè¯ ${success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`); return { success, messagesAdded, inputCleared, hasGuestResponse, messageCount: { initial: initialMessageCount, final: finalMessageCount } }; }, // 6. æŒ‰é’®åŠŸèƒ½éªŒè¯ async verifyButtonFunctions() { console.log('ğŸ”˜ éªŒè¯æŒ‰é’®åŠŸèƒ½...'); const buttons = [ { id: 'historyBtn', name: 'å†å²è®°å½•' }, { id: 'settingsBtn', name: 'è®¾ç½®' }, { id: 'recordButton', name: 'è¯­éŸ³è¾“å…¥' }, { id: 'imageGenButton', name: 'å›¾åƒç”Ÿæˆ' }, { id: 'ttsButton', name: 'è¯­éŸ³æ’­æ”¾' } ]; const results = {}; for (const button of buttons) { const element = document.getElementById(button.id); if (element) { try { element.click(); await delay(300); results[button.id] = { success: true, error: null }; console.log(` âœ… ${button.name}æŒ‰é’®å¯ç‚¹å‡»`); } catch (error) { results[button.id] = { success: false, error: error.message }; console.log(` âŒ ${button.name}æŒ‰é’®é”™è¯¯: ${error.message}`); } } else { results[button.id] = { success: false, error: 'æŒ‰é’®ä¸å­˜åœ¨' }; console.log(` âŒ ${button.name}æŒ‰é’®ä¸å­˜åœ¨`); } } const allWorking = Object.values(results).every(r => r.success); console.log(`ğŸ”˜ æŒ‰é’®åŠŸèƒ½éªŒè¯ ${allWorking ? 'âœ… é€šè¿‡' : 'âš ï¸ éƒ¨åˆ†é€šè¿‡'}`); return { success: allWorking, results }; } }; // ä¸»éªŒè¯å‡½æ•° async function runComprehensiveVerification() { console.log('ğŸ¯ å¼€å§‹ç»¼åˆåŠŸèƒ½éªŒè¯...\n'); const results = {}; try { // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½ await delay(1000); // è¿è¡Œæ‰€æœ‰éªŒè¯æ­¥éª¤ results.domElements = await verificationSteps.verifyDOMElements(); console.log(''); results.chatInstance = await verificationSteps.verifyChatInstance(); console.log(''); results.guestMode = await verificationSteps.verifyGuestMode(); console.log(''); results.messageInput = await verificationSteps.verifyMessageInput(); console.log(''); results.messageSending = await verificationSteps.verifyMessageSending(); console.log(''); results.buttonFunctions = await verificationSteps.verifyButtonFunctions(); console.log(''); // ç”Ÿæˆæ€»ç»“æŠ¥å‘Š const allTests = Object.values(results); const passedTests = allTests.filter(test => test.success).length; const totalTests = allTests.length; console.log('ğŸ“Š éªŒè¯ç»“æœæ€»ç»“:'); console.log(` æ€»æµ‹è¯•æ•°: ${totalTests}`); console.log(` é€šè¿‡æµ‹è¯•: ${passedTests}`); console.log(` å¤±è´¥æµ‹è¯•: ${totalTests - passedTests}`); console.log(` æˆåŠŸç‡: ${Math.round((passedTests / totalTests) * 100)}%`); if (passedTests === totalTests) { console.log('ğŸ‰ æ‰€æœ‰åŠŸèƒ½éªŒè¯é€šè¿‡ï¼èŠå¤©é¡µé¢è¿è¡Œæ­£å¸¸ã€‚'); } else { console.log('âš ï¸ éƒ¨åˆ†åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚'); } return results; } catch (error) { console.error('âŒ éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error); return { error: error.message, results }; } } // è‡ªåŠ¨è¿è¡ŒéªŒè¯ï¼ˆå¦‚æœåœ¨æµè§ˆå™¨ä¸­ï¼‰ if (typeof window !== 'undefined') { // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œ if (document.readyState === 'complete') { setTimeout(runComprehensiveVerification, 1500); } else { window.addEventListener('load', () => { setTimeout(runComprehensiveVerification, 1500); }); } // æ·»åŠ åˆ°å…¨å±€ä»¥ä¾¿æ‰‹åŠ¨è°ƒç”¨ window.chatVerification = { runComprehensiveVerification, verificationSteps }; } console.log('â„¹ï¸ éªŒè¯è„šæœ¬å·²åŠ è½½ã€‚å¦‚éœ€æ‰‹åŠ¨è¿è¡Œï¼Œè¯·è°ƒç”¨: chatVerification.runComprehensiveVerification()'); 