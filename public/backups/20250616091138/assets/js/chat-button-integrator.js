 class ChatButtonIntegrator { constructor() { this.chatButtons = new Map(); this.init(); } init() { // ç­‰å¾…DOMåŠ è½½å®Œæˆååˆå§‹åŒ– if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', () => { this.integrateExistingButtons(); }); } else { this.integrateExistingButtons(); } } integrateExistingButtons() { // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿å…¶ä»–ç³»ç»Ÿå·²åˆå§‹åŒ– setTimeout(() => { this.integrateChatButtons(); }, 1000); } integrateChatButtons() { // æŸ¥æ‰¾å¹¶é›†æˆç°æœ‰çš„èŠå¤©æŒ‰é’® this.integrateQuantumChatButton(); this.integrateAIAssistantButton(); this.integrateOtherChatButtons(); } integrateQuantumChatButton() { const floatingButton = document.getElementById('floating-chat-button'); if (floatingButton && window.floatingButtonsManager) { // ç§»é™¤ç°æœ‰æ ·å¼ floatingButton.className = ''; floatingButton.style.cssText = ''; // é‡æ–°æ³¨å†Œåˆ°ç®¡ç†å™¨ window.floatingButtonsManager.registerButton('quantum-chat', { element: floatingButton, preferredPosition: 'bottom-right-1', type: 'chat', priority: 5, title: 'é‡å­æ™ºèƒ½åŠ©æ‰‹', icon: 'fas fa-comments' }); console.log('âœ… é‡å­èŠå¤©æŒ‰é’®å·²é›†æˆåˆ°ç®¡ç†å™¨'); } } integrateAIAssistantButton() { const aiAssistantBtn = document.getElementById('aiAssistantBtn'); if (aiAssistantBtn && window.floatingButtonsManager) { // å¦‚æœå·²ç»æ˜¯æ‚¬æµ®æŒ‰é’®æ ·å¼ï¼Œåˆ™é›†æˆ const computedStyle = window.getComputedStyle(aiAssistantBtn); if (computedStyle.position === 'fixed') { aiAssistantBtn.className = ''; aiAssistantBtn.style.cssText = ''; window.floatingButtonsManager.registerButton('ai-assistant', { element: aiAssistantBtn, preferredPosition: 'bottom-right-1', type: 'chat', priority: 4, title: 'AIæ™ºèƒ½åŠ©æ‰‹', icon: 'fas fa-robot' }); console.log('âœ… AIåŠ©æ‰‹æŒ‰é’®å·²é›†æˆåˆ°ç®¡ç†å™¨'); } } } integrateOtherChatButtons() { // æŸ¥æ‰¾å…¶ä»–å¯èƒ½çš„èŠå¤©æŒ‰é’® const chatToggleBtn = document.getElementById('chatToggleBtn'); const chatButton = document.getElementById('chatButton'); [chatToggleBtn, chatButton].forEach((btn, index) => { if (btn && window.floatingButtonsManager) { const computedStyle = window.getComputedStyle(btn); if (computedStyle.position === 'fixed') { btn.className = ''; btn.style.cssText = ''; window.floatingButtonsManager.registerButton(`chat-${index}`, { element: btn, preferredPosition: 'bottom-right-1', type: 'chat', priority: 3 - index, title: 'èŠå¤©åŠ©æ‰‹', icon: 'fas fa-comment-dots' }); console.log(`âœ… èŠå¤©æŒ‰é’® ${index} å·²é›†æˆåˆ°ç®¡ç†å™¨`); } } }); } createUnifiedChatButton() { // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç°æœ‰æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„èŠå¤©æŒ‰é’® if (this.chatButtons.size === 0) { const unifiedButton = document.createElement('button'); unifiedButton.id = 'unified-chat-button'; unifiedButton.innerHTML = '<i class="fas fa-comments"></i>'; document.body.appendChild(unifiedButton); if (window.floatingButtonsManager) { window.floatingButtonsManager.registerButton('unified-chat', { element: unifiedButton, preferredPosition: 'bottom-right-1', type: 'chat', priority: 10, title: 'æ™ºèƒ½èŠå¤©åŠ©æ‰‹', icon: 'fas fa-comments', onClick: this.handleUnifiedChatClick.bind(this) }); console.log('âœ… ç»Ÿä¸€èŠå¤©æŒ‰é’®å·²åˆ›å»º'); } } } handleUnifiedChatClick() { // å°è¯•æ‰“å¼€ä»»ä½•å¯ç”¨çš„èŠå¤©ç•Œé¢ const chatContainer = document.getElementById('chat-container'); const chatWidget = document.getElementById('chatWidget'); const aiChatContainer = document.getElementById('ai-chat-container'); if (chatContainer) { // é‡å­èŠå¤© if (window.quantumChatIntegrator && typeof window.quantumChatIntegrator.showChatInterface === 'function') { window.quantumChatIntegrator.showChatInterface(); } } else if (chatWidget) { // æ ‡å‡†èŠå¤©å°éƒ¨ä»¶ chatWidget.classList.remove('hidden'); } else if (aiChatContainer) { // AIèŠå¤©å®¹å™¨ if (window.aiChat && typeof window.aiChat.showChat === 'function') { window.aiChat.showChat(); } } else { // åˆ›å»ºåŸºæœ¬èŠå¤©ç•Œé¢ this.createBasicChatInterface(); } } createBasicChatInterface() { // åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„èŠå¤©ç•Œé¢ const chatInterface = document.createElement('div'); chatInterface.id = 'basic-chat-interface'; chatInterface.innerHTML = ` <div class="fixed bottom-20 right-20 w-80 h-96 bg-white rounded-lg shadow-2xl border z-50"> <div class="bg-blue-600 text-white p-4 rounded-t-lg"> <div class="flex justify-between items-center"> <h3 class="font-semibold">æ™ºèƒ½åŠ©æ‰‹</h3> <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-white hover:text-gray-200"> <i class="fas fa-times"></i> </button> </div> </div> <div class="p-4 h-64 overflow-y-auto"> <div class="mb-4 p-3 bg-gray-100 rounded-lg"> æ‚¨å¥½ï¼æˆ‘æ˜¯AlingAi Proçš„æ™ºèƒ½åŠ©æ‰‹ã€‚æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ </div> </div> <div class="p-4 border-t"> <div class="flex gap-2"> <input type="text" placeholder="è¾“å…¥æ¶ˆæ¯..." class="flex-1 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"> <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"> å‘é€ </button> </div> </div> </div> `; document.body.appendChild(chatInterface); console.log('âœ… åŸºæœ¬èŠå¤©ç•Œé¢å·²åˆ›å»º'); } } // å…¨å±€åˆå§‹åŒ– window.chatButtonIntegrator = new ChatButtonIntegrator(); console.log('ğŸ’¬ èŠå¤©æŒ‰é’®é›†æˆç®¡ç†å™¨å·²åŠ è½½'); 