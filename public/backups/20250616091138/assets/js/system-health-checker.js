 class SystemHealthChecker { constructor() { this.checkInterval = 5000; // 5ç§’æ£€æŸ¥ä¸€æ¬¡ this.issues = []; this.autoFix = true; this.startHealthCheck(); } startHealthCheck() { console.log('ğŸ’š å¯åŠ¨ç³»ç»Ÿå¥åº·æ£€æŸ¥...'); setInterval(() => { this.performHealthCheck(); }, this.checkInterval); } performHealthCheck() { this.issues = []; // æ£€æŸ¥æ ¸å¿ƒç³»ç»Ÿ this.checkCoreScripts(); this.checkDOMElements(); this.checkEventListeners(); this.checkMemoryUsage(); if (this.issues.length > 0) { console.warn('âš ï¸ å‘ç°ç³»ç»Ÿé—®é¢˜:', this.issues); if (this.autoFix) { this.attemptAutoFix(); } } } checkCoreScripts() { const coreChecks = [ { name: 'jQuery', test: () => typeof $ !== 'undefined' }, { name: 'THREE.js', test: () => typeof THREE !== 'undefined' }, { name: 'QuantumParticleSystem', test: () => window.quantumParticleSystem || window.QuantumParticleSystem }, { name: 'QuantumFeatureEnhancer', test: () => window.quantumFeatureEnhancer || window.QuantumFeatureEnhancer } ]; coreChecks.forEach(check => { if (!check.test()) { this.issues.push(`æ ¸å¿ƒè„šæœ¬ç¼ºå¤±: ${check.name}`); } }); } checkDOMElements() { const requiredElements = [ 'loginModal', 'header', 'main-content' ]; requiredElements.forEach(id => { if (!document.getElementById(id)) { this.issues.push(`DOMå…ƒç´ ç¼ºå¤±: ${id}`); } }); } checkEventListeners() { // æ£€æŸ¥é‡è¦çš„äº‹ä»¶ç›‘å¬å™¨ const testButton = document.createElement('button'); testButton.click(); // å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¯´æ˜äº‹ä»¶ç³»ç»Ÿæ­£å¸¸ } checkMemoryUsage() { if (performance.memory) { const used = performance.memory.usedJSHeapSize; const limit = performance.memory.jsHeapSizeLimit; const percentage = (used / limit) * 100; if (percentage > 80) { this.issues.push(`å†…å­˜ä½¿ç”¨è¿‡é«˜: ${percentage.toFixed(1)}%`); } } } attemptAutoFix() { console.log('ğŸ”§ å°è¯•è‡ªåŠ¨ä¿®å¤é—®é¢˜...'); this.issues.forEach(issue => { if (issue.includes('å†…å­˜ä½¿ç”¨è¿‡é«˜')) { this.performGarbageCollection(); } else if (issue.includes('DOMå…ƒç´ ç¼ºå¤±')) { this.recreateMissingElements(); } }); } performGarbageCollection() { // å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰ if (window.gc) { window.gc(); } // æ¸…ç†å…¨å±€å˜é‡ Object.keys(window).forEach(key => { if (key.startsWith('temp_') || key.startsWith('cache_')) { delete window[key]; } }); console.log('ğŸ§¹ æ‰§è¡Œå†…å­˜æ¸…ç†'); } recreateMissingElements() { // é‡æ–°åˆ›å»ºç¼ºå¤±çš„å…³é”®å…ƒç´  if (!document.getElementById('loginModal')) { console.log('ğŸ”§ é‡æ–°åˆ›å»ºç™»å½•æ¨¡æ€æ¡†...'); // é‡æ–°åˆ›å»ºé€»è¾‘ } } } // è‡ªåŠ¨å¯åŠ¨å¥åº·æ£€æŸ¥ if (typeof window !== 'undefined') { window.systemHealthChecker = new SystemHealthChecker(); } 