// ä¿®å¤éªŒè¯è„šæœ¬ - åœ¨é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œ // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åå¼€å§‹æµ‹è¯• // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿èŠå¤©æ¨¡å—æœ‰æ—¶é—´åˆå§‹åŒ– setTimeout(() => { console.log('ğŸš€ å¼€å§‹éªŒè¯èŠå¤©åŠŸèƒ½ä¿®å¤...'); runChatFixVerification(); }, 2000); function runChatFixVerification() { // æµ‹è¯•ç»“æœå­˜å‚¨ const testResults = { syntaxErrors: [], moduleLoading: false, domElements: {}, guestMode: false, sendButton: false, inputFunction: false }; // 1. æ£€æŸ¥JavaScriptè¯­æ³•é”™è¯¯ console.log('1ï¸âƒ£ æ£€æŸ¥JavaScriptè¯­æ³•é”™è¯¯...'); const jsErrors = []; const originalError = console.error; console.error = function(...args) { const message = args.join(' '); if (message.includes('SyntaxError') || message.includes('Invalid left-hand side')) { jsErrors.push(message); testResults.syntaxErrors.push(message); } originalError.apply(console, args); }; // 2. æ£€æŸ¥èŠå¤©æ¨¡å—æ˜¯å¦æˆåŠŸåŠ è½½ console.log('2ï¸âƒ£ æ£€æŸ¥èŠå¤©æ¨¡å—åŠ è½½çŠ¶æ€...'); setTimeout(() => { testResults.moduleLoading = typeof window.chatInstance !== 'undefined' && window.chatInstance !== null; console.log(`ğŸ“¦ èŠå¤©å®ä¾‹: ${testResults.moduleLoading ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}`); if (testResults.moduleLoading) { console.log(' - èŠå¤©å®ä¾‹è¯¦æƒ…:', window.chatInstance); } }, 1000); // 3. æ£€æŸ¥å…³é”®DOMå…ƒç´  console.log('3ï¸âƒ£ æ£€æŸ¥å…³é”®DOMå…ƒç´ ...'); const checkElements = { messageInput: 'messageInput', sendButton: 'sendButton', guestModeBtn: 'guestModeBtn', messagesContainer: 'messages', darkModeSwitch: 'darkModeSwitch', voiceInputSwitch: 'voiceInputSwitch', autoTTSSwitch: 'autoTTSSwitch' }; Object.entries(checkElements).forEach(([name, id]) => { const element = document.getElementById(id); testResults.domElements[name] = !!element; console.log(` ${testResults.domElements[name] ? 'âœ…' : 'âŒ'} ${name}`); }); // 4. æµ‹è¯•è®¿å®¢æ¨¡å¼åŠŸèƒ½ console.log('4ï¸âƒ£ æµ‹è¯•è®¿å®¢æ¨¡å¼åŠŸèƒ½...'); const guestBtn = document.getElementById('guestModeBtn'); if (guestBtn) { try { guestBtn.click(); setTimeout(() => { testResults.guestMode = localStorage.getItem('guestMode') === 'true'; console.log(`ğŸ‘¤ è®¿å®¢æ¨¡å¼: ${testResults.guestMode ? 'âœ… å·²æ¿€æ´»' : 'âŒ æœªæ¿€æ´»'}`); }, 500); } catch (error) { console.log('âŒ è®¿å®¢æ¨¡å¼æŒ‰é’®ç‚¹å‡»å¤±è´¥:', error.message); } } else { console.log('âŒ æ‰¾ä¸åˆ°è®¿å®¢æ¨¡å¼æŒ‰é’®'); } // 5. æµ‹è¯•å‘é€æŒ‰é’®çŠ¶æ€æ§åˆ¶ console.log('5ï¸âƒ£ æµ‹è¯•å‘é€æŒ‰é’®çŠ¶æ€æ§åˆ¶...'); const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); if (messageInput && sendButton) { // æµ‹è¯•è¾“å…¥æ–‡æœ¬åæŒ‰é’®å¯ç”¨ messageInput.value = 'æµ‹è¯•æ¶ˆæ¯'; messageInput.dispatchEvent(new Event('input', { bubbles: true })); setTimeout(() => { const enabledAfterInput = !sendButton.disabled; console.log(`ğŸ“¤ è¾“å…¥åå‘é€æŒ‰é’®: ${enabledAfterInput ? 'âœ… å·²å¯ç”¨' : 'âŒ ä»ç¦ç”¨'}`); // æµ‹è¯•æ¸…ç©ºåæŒ‰é’®ç¦ç”¨ messageInput.value = ''; messageInput.dispatchEvent(new Event('input', { bubbles: true })); setTimeout(() => { const disabledAfterClear = sendButton.disabled; console.log(`ğŸ“¤ æ¸…ç©ºåå‘é€æŒ‰é’®: ${disabledAfterClear ? 'âœ… å·²ç¦ç”¨' : 'âŒ ä»å¯ç”¨'}`); testResults.sendButton = enabledAfterInput && disabledAfterClear; testResults.inputFunction = true; }, 200); }, 200); } else { console.log('âŒ æ‰¾ä¸åˆ°æ¶ˆæ¯è¾“å…¥æ¡†æˆ–å‘é€æŒ‰é’®'); } // 6. æ£€æŸ¥å¼€å…³æ§ä»¶åŠŸèƒ½ï¼ˆä¿®å¤åçš„ä»£ç ï¼‰ console.log('6ï¸âƒ£ æµ‹è¯•è®¾ç½®å¼€å…³åŠŸèƒ½...'); setTimeout(() => { const switches = ['darkModeSwitch', 'voiceInputSwitch', 'autoTTSSwitch']; let switchTests = 0; switches.forEach(switchId => { const switchElement = document.getElementById(switchId); if (switchElement) { try { // æµ‹è¯•å¼€å…³åˆ‡æ¢ const originalState = switchElement.checked; switchElement.checked = !originalState; switchElement.dispatchEvent(new Event('change', { bubbles: true })); // æ¢å¤åŸçŠ¶æ€ setTimeout(() => { switchElement.checked = originalState; switchElement.dispatchEvent(new Event('change', { bubbles: true })); }, 100); switchTests++; console.log(` âœ… ${switchId} åŠŸèƒ½æ­£å¸¸`); } catch (error) { console.log(` âŒ ${switchId} åŠŸèƒ½å¼‚å¸¸:`, error.message); } } else { console.log(` âŒ æ‰¾ä¸åˆ° ${switchId}`); } }); console.log(`ğŸ”§ å¼€å…³æµ‹è¯•: ${switchTests}/${switches.length} é€šè¿‡`); }, 2000); // 7. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š setTimeout(() => { console.log('\nğŸ“Š ä¿®å¤éªŒè¯æŠ¥å‘Š:'); console.log('='.repeat(50)); const tests = [ { name: 'JavaScriptè¯­æ³•é”™è¯¯', status: testResults.syntaxErrors.length === 0, detail: `${testResults.syntaxErrors.length} ä¸ªé”™è¯¯` }, { name: 'èŠå¤©æ¨¡å—åŠ è½½', status: testResults.moduleLoading, detail: testResults.moduleLoading ? 'æˆåŠŸ' : 'å¤±è´¥' }, { name: 'DOMå…ƒç´ å®Œæ•´æ€§', status: Object.values(testResults.domElements).every(v => v), detail: `${Object.values(testResults.domElements).filter(v => v).length}/${Object.keys(testResults.domElements).length}` }, { name: 'è®¿å®¢æ¨¡å¼åŠŸèƒ½', status: testResults.guestMode, detail: testResults.guestMode ? 'æ­£å¸¸' : 'å¼‚å¸¸' }, { name: 'å‘é€æŒ‰é’®æ§åˆ¶', status: testResults.sendButton, detail: testResults.sendButton ? 'æ­£å¸¸' : 'å¼‚å¸¸' }, { name: 'è¾“å…¥åŠŸèƒ½', status: testResults.inputFunction, detail: testResults.inputFunction ? 'æ­£å¸¸' : 'å¼‚å¸¸' } ]; let passed = 0; tests.forEach(test => { const icon = test.status ? 'âœ…' : 'âŒ'; console.log(`${icon} ${test.name}: ${test.detail}`); if (test.status) passed++; }); const successRate = Math.round((passed / tests.length) * 100); console.log('\nğŸ“ˆ æ€»ä½“ç»“æœ:'); console.log(`âœ… é€šè¿‡: ${passed}/${tests.length} (${successRate}%)`); if (successRate >= 80) { console.log('ğŸ‰ èŠå¤©åŠŸèƒ½ä¿®å¤æˆåŠŸï¼'); } else if (successRate >= 60) { console.log('âš ï¸ åŸºæœ¬åŠŸèƒ½å·²ä¿®å¤ï¼Œä½†ä»éœ€ä¼˜åŒ–'); } else { console.log('âŒ ä»éœ€è¿›ä¸€æ­¥ä¿®å¤'); } // è¾“å‡ºå…·ä½“é”™è¯¯ä¿¡æ¯ if (testResults.syntaxErrors.length > 0) { console.log('\nğŸ› å‘ç°çš„é”™è¯¯:'); testResults.syntaxErrors.forEach((error, index) => { console.log(` ${index + 1}. ${error}`); }); } console.log('\nğŸ’¡ ä¿®å¤å»ºè®®:'); if (!testResults.moduleLoading) { console.log(' - æ£€æŸ¥æ¨¡å—å¯¼å…¥å’Œåˆå§‹åŒ–ä»£ç '); } if (!testResults.guestMode) { console.log(' - éªŒè¯è®¿å®¢æ¨¡å¼æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨'); } if (!testResults.sendButton) { console.log(' - æ£€æŸ¥è¾“å…¥äº‹ä»¶å¤„ç†å’ŒæŒ‰é’®çŠ¶æ€æ§åˆ¶'); } console.log('\nğŸ”§ æ‰‹åŠ¨æµ‹è¯•æç¤º:'); console.log('å¯ä»¥åœ¨æ§åˆ¶å°è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ›´å¤šæµ‹è¯•:'); console.log('window.manualTestHelper.simulateMessage("æµ‹è¯•æ¶ˆæ¯")'); console.log('window.manualTestHelper.checkChatObjects()'); console.log('window.manualTestHelper.activateGuestMode()'); }, 5000); console.log('â³ æµ‹è¯•è¿›è¡Œä¸­ï¼Œè¯·ç­‰å¾…ç»“æœ...'); } 