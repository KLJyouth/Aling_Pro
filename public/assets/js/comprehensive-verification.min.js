 const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)); const verificationSteps = { async verifyDOMElements() {  const requiredElements = { 'loginModal': '登录模态框', 'loginButton': '登录按钮', 'guestModeButton': '访客模式按钮', 'userStatus': '用户状态显示', 'messageInput': '消息输入框', 'sendButton': '发送按钮', 'chatMessages': '聊天消息区域', 'recordButton': '语音输入按钮', 'imageGenButton': '图像生成按钮', 'ttsButton': '语音播放按钮', 'historyBtn': '历史记录按钮', 'settingsBtn': '设置按钮' }; const results = {}; for (const [id, desc] of Object.entries(requiredElements)) { const element = document.getElementById(id); results[id] = { exists: !!element, description: desc, element: element }; console.log(` ${results[id].exists ? '✅' : '❌'} ${desc} (${id})`); } const allExists = Object.values(results).every(r => r.exists);  return { success: allExists, results }; }, async verifyChatInstance() {  const hasInstance = !!window.chatInstance; const hasCore = hasInstance && !!window.chatInstance.core; const hasUI = hasInstance && !!window.chatInstance.ui; const hasAPI = hasInstance && !!window.chatInstance.api;     if (hasAPI) { const apiInitialized = window.chatInstance.api.isInitialized;  } const allOK = hasInstance && hasCore && hasUI && hasAPI;  return { success: allOK, instance: window.chatInstance }; }, async verifyGuestMode() {  localStorage.removeItem('guestMode'); localStorage.removeItem('token'); const guestBtn = document.getElementById('guestModeButton'); const userStatus = document.getElementById('userStatus'); if (!guestBtn) {  return { success: false }; }  guestBtn.click(); await delay(500); const guestModeSet = localStorage.getItem('guestMode') === 'true'; const statusText = userStatus ? userStatus.textContent : '';  console.log(` ${statusText.includes('访客') ? '✅' : '❌'} 用户状态显示: "${statusText}"`); const success = guestModeSet && statusText.includes('访客');  return { success, guestModeSet, statusText }; }, async verifyMessageInput() {  const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); if (!messageInput || !sendButton) {  return { success: false }; } messageInput.value = ''; messageInput.dispatchEvent(new Event('input')); await delay(100); const emptyDisabled = sendButton.disabled;  messageInput.value = '测试消息'; messageInput.dispatchEvent(new Event('input')); await delay(100); const textEnabled = !sendButton.disabled;  messageInput.value = ''; const success = emptyDisabled && textEnabled;  return { success, emptyDisabled, textEnabled }; }, async verifyMessageSending() {  localStorage.setItem('guestMode', 'true'); const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); const chatMessages = document.getElementById('chatMessages'); if (!messageInput || !sendButton || !chatMessages) {  return { success: false }; } const initialMessageCount = chatMessages.children.length; const testMessage = '这是一条自动化测试消息'; messageInput.value = testMessage; messageInput.dispatchEvent(new Event('input'));  sendButton.click(); await delay(2000); const finalMessageCount = chatMessages.children.length; const messagesAdded = finalMessageCount > initialMessageCount; const inputCleared = messageInput.value === '';    const messages = Array.from(chatMessages.querySelectorAll('.message, [class*="message"]')); const hasGuestResponse = messages.some(msg => msg.textContent && msg.textContent.includes('访客模式') );  const success = messagesAdded && inputCleared && hasGuestResponse;  return { success, messagesAdded, inputCleared, hasGuestResponse, messageCount: { initial: initialMessageCount, final: finalMessageCount } }; }, async verifyButtonFunctions() {  const buttons = [ { id: 'historyBtn', name: '历史记录' }, { id: 'settingsBtn', name: '设置' }, { id: 'recordButton', name: '语音输入' }, { id: 'imageGenButton', name: '图像生成' }, { id: 'ttsButton', name: '语音播放' } ]; const results = {}; for (const button of buttons) { const element = document.getElementById(button.id); if (element) { try { element.click(); await delay(300); results[button.id] = { success: true, error: null };  } catch (error) { results[button.id] = { success: false, error: error.message };  } } else { results[button.id] = { success: false, error: '按钮不存在' };  } } const allWorking = Object.values(results).every(r => r.success);  return { success: allWorking, results }; } }; async function runComprehensiveVerification() {  const results = {}; try { await delay(1000); results.domElements = await verificationSteps.verifyDOMElements();  results.chatInstance = await verificationSteps.verifyChatInstance();  results.guestMode = await verificationSteps.verifyGuestMode();  results.messageInput = await verificationSteps.verifyMessageInput();  results.messageSending = await verificationSteps.verifyMessageSending();  results.buttonFunctions = await verificationSteps.verifyButtonFunctions();  const allTests = Object.values(results); const passedTests = allTests.filter(test => test.success).length; const totalTests = allTests.length;     console.log(` 成功率: ${Math.round((passedTests / totalTests) * 100)}%`); if (passedTests === totalTests) {  } else {  } return results; } catch (error) { console.error('❌ 验证过程中发生错误:', error); return { error: error.message, results }; } } if (typeof window !== 'undefined') { if (document.readyState === 'complete') { setTimeout(runComprehensiveVerification, 1500); } else { window.addEventListener('load', () => { setTimeout(runComprehensiveVerification, 1500); }); } window.chatVerification = { runComprehensiveVerification, verificationSteps }; } console.log('ℹ️ 验证脚本已加载。如需手动运行，请调用: chatVerification.runComprehensiveVerification()');