// æœ€ç»ˆåŠŸèƒ½éªŒè¯è„šæœ¬ - æ‰‹åŠ¨è§¦å‘èŠå¤©æµ‹è¯• // åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œ: runFinalVerification()  // å»¶è¿Ÿæ‰§è¡Œå‡½æ•° const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)); // æ£€æŸ¥è®¡æ•°å™¨ let checkCount = 0; const maxChecks = 5; // æœ€ç»ˆéªŒè¯æµ‹è¯• window.runFinalVerification = async function() {  let testResults = { domCheck: false, chatInstance: false, guestMode: false, messageTest: false, uiResponse: false }; try { // 1. DOMæ£€æŸ¥  const coreElements = [ 'messageInput', 'sendButton', 'chatMessages', 'guestModeButton', 'userStatus' ]; const missingElements = coreElements.filter(id => !document.getElementById(id)); if (missingElements.length === 0) {  testResults.domCheck = true; } else {  } // 2. èŠå¤©å®ä¾‹æ£€æŸ¥  if (window.chatInstance && window.chatInstance.core && window.chatInstance.ui && window.chatInstance.api) {  testResults.chatInstance = true; } else {  console.log(' å®ä¾‹çŠ¶æ€:', { chatInstance: !!window.chatInstance, core: !!(window.chatInstance?.core), ui: !!(window.chatInstance?.ui), api: !!(window.chatInstance?.api) }); } // 3. è®¿å®¢æ¨¡å¼æ¿€æ´»  localStorage.removeItem('guestMode'); localStorage.removeItem('token'); const guestBtn = document.getElementById('guestModeButton'); if (guestBtn) { guestBtn.click(); await delay(500); const guestModeSet = localStorage.getItem('guestMode') === 'true'; const userStatus = document.getElementById('userStatus'); const statusText = userStatus ? userStatus.textContent : ''; if (guestModeSet && statusText.includes('è®¿å®¢')) {   testResults.guestMode = true; } else {  console.log(' localStorage:', localStorage.getItem('guestMode'));  } } else {  } // 4. æ¶ˆæ¯å‘é€æµ‹è¯•  const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); const chatMessages = document.getElementById('chatMessages'); if (messageInput && sendButton && chatMessages) { const initialCount = chatMessages.children.length; // è¾“å…¥æµ‹è¯•æ¶ˆæ¯ const testMessage = 'ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯'; messageInput.value = testMessage; messageInput.dispatchEvent(new Event('input'));   // ç‚¹å‡»å‘é€ sendButton.click(); // ç­‰å¾…å¤„ç† await delay(2000); const finalCount = chatMessages.children.length; const messagesAdded = finalCount > initialCount; const inputCleared = messageInput.value === ''; if (messagesAdded && inputCleared) {   testResults.messageTest = true; // æ£€æŸ¥æ˜¯å¦æœ‰è®¿å®¢æ¨¡å¼å›å¤ const messages = Array.from(chatMessages.children); const lastMessages = messages.slice(-2); // è·å–æœ€åä¸¤æ¡æ¶ˆæ¯ const hasGuestResponse = lastMessages.some(msg => msg.textContent && ( msg.textContent.includes('è®¿å®¢æ¨¡å¼') || msg.textContent.includes('æ¼”ç¤ºå›å¤') || msg.textContent.includes('ç™»å½•') ) ); if (hasGuestResponse) {  testResults.uiResponse = true; } else {  console.log(' ğŸ’¬ æœ€æ–°æ¶ˆæ¯å†…å®¹:', lastMessages.map(m => m.textContent?.substring(0, 50))); } } else {   } } else {  } // 5. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š   const results = [ { name: 'DOMå…ƒç´ æ£€æŸ¥', status: testResults.domCheck, icon: testResults.domCheck ? 'âœ…' : 'âŒ' }, { name: 'èŠå¤©å®ä¾‹åŠ è½½', status: testResults.chatInstance, icon: testResults.chatInstance ? 'âœ…' : 'âŒ' }, { name: 'è®¿å®¢æ¨¡å¼æ¿€æ´»', status: testResults.guestMode, icon: testResults.guestMode ? 'âœ…' : 'âŒ' }, { name: 'æ¶ˆæ¯å‘é€åŠŸèƒ½', status: testResults.messageTest, icon: testResults.messageTest ? 'âœ…' : 'âŒ' }, { name: 'AIå›å¤æ˜¾ç¤º', status: testResults.uiResponse, icon: testResults.uiResponse ? 'âœ…' : 'âŒ' } ]; results.forEach((result, index) => {  }); const passedTests = results.filter(r => r.status).length; const totalTests = results.length; const successRate = Math.round((passedTests / totalTests) * 100);  console.log(` é€šè¿‡: ${passedTests}/${totalTests} (${successRate}%)`); if (successRate >= 80) {   } else if (successRate >= 60) {  } else {  } // è¿”å›ç»“æœä¾›åç»­ä½¿ç”¨ return { success: successRate >= 80, results: testResults, successRate, details: results }; } catch (error) { console.error('âŒ éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error); return { success: false, error: error.message }; } }; // å¿«é€Ÿæµ‹è¯•è®¿å®¢æ¨¡å¼èŠå¤© window.quickChatTest = function() {  // ç¡®ä¿è®¿å®¢æ¨¡å¼ localStorage.setItem('guestMode', 'true'); const messageInput = document.getElementById('messageInput'); const sendButton = document.getElementById('sendButton'); if (messageInput && sendButton) { messageInput.value = 'ä½ å¥½ï¼ŒAlingAiï¼'; messageInput.dispatchEvent(new Event('input'));  sendButton.click();  } else {  } }; // æ£€æŸ¥é¡µé¢å°±ç»ªçŠ¶æ€ function checkPageReady() { checkCount++; const isReady = !!( document.getElementById('messageInput') && document.getElementById('sendButton') && window.chatInstance ); if (isReady) {   console.log(' - runFinalVerification() : å®Œæ•´åŠŸèƒ½éªŒè¯'); console.log(' - quickChatTest() : å¿«é€ŸèŠå¤©æµ‹è¯•'); checkCount = 0; } else if (checkCount < maxChecks) { console.log('â³ é¡µé¢å°šæœªå®Œå…¨åŠ è½½ï¼Œè¯·ç¨åé‡è¯•... (' + checkCount + '/' + maxChecks + ')'); setTimeout(checkPageReady, 2000); } else {  checkCount = 0; } } // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥ if (document.readyState === 'complete') { setTimeout(checkPageReady, 500); } else { window.addEventListener('load', () => setTimeout(checkPageReady, 500)); }  