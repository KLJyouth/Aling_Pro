<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlingAi Pro æ™ºèƒ½å¯¹è¯ - ä¼ä¸šçº§AIèŠå¤©ç³»ç»Ÿ</title>
    <meta name="description" content="AlingAi Proæ™ºèƒ½å¯¹è¯ç³»ç»Ÿ - æ”¯æŒå¤šæ¨¡æ€äº¤äº’ã€å®æ—¶è¯­éŸ³ã€å›¾åƒè¯†åˆ«ã€æ–‡æ¡£åˆ†æçš„ä¼ä¸šçº§AIåŠ©æ‰‹">
    
    <!-- æ ¸å¿ƒèµ„æº -->
    <link href="/assets/css/https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/css/https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/assets/js/https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="/assets/js/https://cdn.jsdelivr.net/npm/three@0.132.0/build/three.min.js"></script>
    
    <!-- AI & WebSocket æ”¯æŒ -->
    <script src="/assets/js/https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="/assets/js/https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/lib/core.min.js"></script>
    <script src="/assets/js/https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/lib/languages/javascript.min.js"></script>
    <script src="/assets/js/https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/lib/languages/python.min.js"></script>
    <script src="/assets/js/https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/lib/languages/php.min.js"></script>
    <link href="/assets/css/https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/github-dark.min.css" rel="stylesheet">
    
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link href="/assets/css/assets/css/chat.css" rel="stylesheet">
    <link href="/assets/css/assets/css/quantum-chat-animations.css" rel="stylesheet">

    <!-- Tailwindé…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'quantum-purple': '#6366f1',
                        'quantum-blue': '#3b82f6',
                        'quantum-cyan': '#06b6d4',
                        'quantum-green': '#10b981',
                        'electric-blue': '#0ea5e9',
                        'neon-pink': '#ec4899',
                        'deep-space': '#0f172a',
                        'glass-white': 'rgba(255, 255, 255, 0.1)',
                        'glass-dark': 'rgba(0, 0, 0, 0.1)',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite alternate',
                        'typing': 'typing 1.5s steps(3, end) infinite',
                        'gradient': 'gradient 15s ease infinite',
                    },
                    backdropBlur: {
                        xs: '2px',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* å…¨å±€æ ·å¼å¢å¼º */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --message-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow-x: hidden;
        }
        
        /* ç»ç’ƒå½¢æ€æ•ˆæœ */
        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }
        
        /* èŠå¤©å®¹å™¨å¢å¼º */
        .chat-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        /* æ¶ˆæ¯æ°”æ³¡å¢å¼º */
        .message-bubble {
            backdrop-filter: blur(16px);
            box-shadow: var(--message-shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message-bubble:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .ai-message {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* è¾“å…¥åŒºåŸŸå¢å¼º */
        .input-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse-glow {
            from { box-shadow: 0 0 20px rgba(102, 126, 234, 0.4); }
            to { box-shadow: 0 0 40px rgba(102, 126, 234, 0.8); }
        }

        @keyframes typing {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* AIçŠ¶æ€æŒ‡ç¤ºå™¨ */
        .ai-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        /* å·¥å…·æ æŒ‰é’® */
        .toolbar-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            border-radius: 0.75rem;
            padding: 0.75rem;
        }
        
        .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .toolbar-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(24px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-history-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .chat-history-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }

        /* ä»£ç å—æ ·å¼ */
        .code-block {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .code-header {
            background: rgba(0, 0, 0, 0.6);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .file-drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 1rem;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .file-drop-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        /* å¿«æ·æ“ä½œæŒ‰é’® */
        .quick-action {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .quick-action:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .chat-container {
                margin: 0.5rem;
                border-radius: 1rem;
            }
        }

        /* æ‰“å­—æ•ˆæœ */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            animation: typing 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(1) { animation-delay: 0ms; }
        .typing-dot:nth-child(2) { animation-delay: 200ms; }
        .typing-dot:nth-child(3) { animation-delay: 400ms; }

        /* ç‰¹æ®Šæ¶ˆæ¯ç±»å‹æ ·å¼ */
        .system-message {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .warning-message {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #f59e0b;
        }
    </style>
</head>

<body>
    <!-- èƒŒæ™¯ç²’å­ç³»ç»Ÿ -->
    <div id="quantum-particles" class="fixed inset-0 pointer-events-none z-0"></div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg fixed-top glass-effect">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center text-white" href="/">
                <i class="fas fa-atom me-2 text-quantum-blue"></i>
                <span class="fw-bold">AlingAi Pro</span>
                <span class="badge bg-primary ms-2 small">Beta</span>
            </a>
            
            <div class="d-flex align-items-center gap-3">
                <!-- AIçŠ¶æ€æŒ‡ç¤ºå™¨ -->
                <div class="ai-status d-none d-md-flex">
                    <div class="status-dot"></div>
                    <span class="small text-white">AIåœ¨çº¿</span>
                        </div>
                
                <!-- å·¥å…·æ  -->
                <div class="btn-group" role="group">
                    <button type="button" class="toolbar-btn" id="toggleSidebar" title="å†å²è®°å½•">
                        <i class="fas fa-history"></i>
                        </button>
                    <button type="button" class="toolbar-btn" id="toggleSettings" title="è®¾ç½®">
                            <i class="fas fa-cog"></i>
                        </button>
                    <button type="button" class="toolbar-btn" id="toggleFullscreen" title="å…¨å±">
                        <i class="fas fa-expand"></i>
                    </button>
            </div>
            
                <!-- ç”¨æˆ·èœå• -->
                <div class="dropdown">
                    <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user me-1"></i>
                        <span class="d-none d-md-inline">ç”¨æˆ·</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end glass-effect">
                        <li><a class="dropdown-item text-white" href="/dashboard.html"><i class="fas fa-tachometer-alt me-2"></i>æ§åˆ¶å°</a></li>
                        <li><a class="dropdown-item text-white" href="/profile.html"><i class="fas fa-user me-2"></i>ä¸ªäººèµ„æ–™</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-white" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>é€€å‡ºç™»å½•</a></li>
                    </ul>
                    </div>
                            </div>
                            </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container-fluid pt-5 mt-3">
        <div class="row h-100">
            <!-- ä¾§è¾¹æ  -->
            <div class="col-md-3 col-lg-2 sidebar p-0" id="chatSidebar">
                <div class="p-3">
                    <h6 class="text-white mb-3">
                        <i class="fas fa-comments me-2"></i>èŠå¤©å†å²
                    </h6>
                    
                    <!-- æ–°å»ºèŠå¤©æŒ‰é’® -->
                    <button class="btn btn-primary w-100 mb-3" onclick="newChat()">
                        <i class="fas fa-plus me-2"></i>æ–°å»ºå¯¹è¯
                    </button>
                    
                    <!-- èŠå¤©å†å²åˆ—è¡¨ -->
                    <div id="chatHistory" class="chat-history">
                        <!-- èŠå¤©å†å²é¡¹å°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
                            </div>
                            </div>
                            </div>

            <!-- ä¸»èŠå¤©åŒºåŸŸ -->
            <div class="col-md-9 col-lg-10 px-0">
                <div class="chat-container mx-3 mb-3 rounded-4 h-100 d-flex flex-column">
                    <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
                    <div class="flex-grow-1 overflow-auto p-4" id="chatMessages">
                        <!-- æ¬¢è¿æ¶ˆæ¯ -->
                        <div class="welcome-section text-center py-5" id="welcomeSection">
                            <div class="mb-4">
                                <i class="fas fa-robot fa-4x text-quantum-blue mb-3 animate-float"></i>
                                <h3 class="text-white mb-2">æ¬¢è¿ä½¿ç”¨ AlingAi Pro</h3>
                                <p class="text-white-50">æ‚¨çš„æ™ºèƒ½AIåŠ©æ‰‹ï¼Œæ”¯æŒå¤šæ¨¡æ€äº¤äº’å’Œä¼ä¸šçº§åº”ç”¨</p>
                            </div>
                            
                            <!-- å¿«æ·æ“ä½œ -->
                            <div class="row g-3 mt-4">
                                <div class="col-md-6 col-lg-3">
                                    <div class="quick-action" onclick="insertQuickMessage('å¸®æˆ‘åˆ†æä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„æ¶æ„')">
                                        <i class="fas fa-project-diagram text-quantum-blue mb-2"></i>
                                        <div class="small text-white">é¡¹ç›®åˆ†æ</div>
                        </div>
                    </div>
                                <div class="col-md-6 col-lg-3">
                                    <div class="quick-action" onclick="insertQuickMessage('ç”Ÿæˆä¸€ä¸ªPythonçˆ¬è™«ä»£ç ')">
                                        <i class="fas fa-code text-quantum-green mb-2"></i>
                                        <div class="small text-white">ä»£ç ç”Ÿæˆ</div>
                </div>
                    </div>
                                <div class="col-md-6 col-lg-3">
                                    <div class="quick-action" onclick="insertQuickMessage('å¸®æˆ‘å†™ä¸€ä»½æŠ€æœ¯æ–‡æ¡£')">
                                        <i class="fas fa-file-alt text-quantum-cyan mb-2"></i>
                                        <div class="small text-white">æ–‡æ¡£ç¼–å†™</div>
                    </div>
                </div>
                                <div class="col-md-6 col-lg-3">
                                    <div class="quick-action" onclick="insertQuickMessage('è§£é‡Šä¸€ä¸‹æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µ')">
                                        <i class="fas fa-brain text-neon-pink mb-2"></i>
                                        <div class="small text-white">çŸ¥è¯†é—®ç­”</div>
                    </div>
                            </div>
                    </div>
                </div>
            </div>
            
            <!-- è¾“å…¥åŒºåŸŸ -->
                    <div class="input-container p-4 rounded-bottom-4">
                        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                        <div class="file-drop-zone p-3 mb-3 text-center d-none" id="fileDropZone">
                            <i class="fas fa-cloud-upload-alt fa-2x text-white-50 mb-2"></i>
                            <p class="text-white-50 mb-0">æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                            <input type="file" id="fileInput" class="d-none" multiple accept=".txt,.md,.pdf,.doc,.docx,.jpg,.png,.gif">
                        </div>

                        <!-- è¾“å…¥æ¡†å’Œå·¥å…·æ  -->
                        <div class="d-flex align-items-end gap-3">
                            <!-- å·¦ä¾§å·¥å…·æŒ‰é’® -->
                            <div class="d-flex flex-column gap-2">
                                <button type="button" class="toolbar-btn" id="attachFile" title="é™„ä»¶">
                        <i class="fas fa-paperclip"></i>
                    </button>
                                <button type="button" class="toolbar-btn" id="voiceInput" title="è¯­éŸ³è¾“å…¥">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                
                            <!-- ä¸»è¾“å…¥åŒºåŸŸ -->
                            <div class="flex-grow-1">
                                <div class="position-relative">
                                    <textarea 
                                        class="form-control input-field resize-none" 
                                        id="messageInput" 
                                        rows="1" 
                                        placeholder="è¾“å…¥æ‚¨çš„æ¶ˆæ¯... (Shift+Enteræ¢è¡Œï¼ŒEnterå‘é€)"
                                        style="min-height: 50px; max-height: 150px;"
                                    ></textarea>
                                    
                                    <!-- è¾“å…¥å¢å¼ºå·¥å…· -->
                                    <div class="position-absolute bottom-0 end-0 p-2">
                                        <div class="d-flex gap-1">
                                            <button type="button" class="btn btn-sm text-white-50" id="formatText" title="æ ¼å¼åŒ–">
                                                <i class="fas fa-font"></i>
                        </button>
                                            <button type="button" class="btn btn-sm text-white-50" id="insertEmoji" title="è¡¨æƒ…">
                                                <i class="fas fa-smile"></i>
                        </button>
                    </div>
                    </div>
                </div>
                                
                                <!-- è¾“å…¥æç¤º -->
                                <div class="small text-white-50 mt-1" id="inputHint">
                                    AIæ­£åœ¨å­¦ä¹ ä¸­...
            </div>
        </div>
        
                            <!-- å‘é€æŒ‰é’® -->
                            <button type="button" class="btn btn-primary btn-lg px-4" id="sendMessage">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>

                        <!-- å¿«æ·å‘½ä»¤æç¤º -->
                        <div class="mt-2 d-flex flex-wrap gap-2" id="quickCommands">
                            <span class="badge bg-secondary small">/help - å¸®åŠ©</span>
                            <span class="badge bg-secondary small">/clear - æ¸…ç©ºå¯¹è¯</span>
                            <span class="badge bg-secondary small">/export - å¯¼å‡ºå¯¹è¯</span>
                        </div>
                        </div>
                </div>
            </div>
                    </div>
                </div>
                
    <!-- è®¾ç½®é¢æ¿ -->
    <div class="offcanvas offcanvas-end glass-effect" tabindex="-1" id="settingsPanel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title text-white">èŠå¤©è®¾ç½®</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
                        </div>
        <div class="offcanvas-body">
            <!-- AIæ¨¡å‹é€‰æ‹© -->
            <div class="mb-4">
                <label class="form-label text-white">AIæ¨¡å‹</label>
                <select class="form-select input-field" id="aiModel">
                    <option value="gpt-4">GPT-4 (æ¨è)</option>
                    <option value="gpt-3.5">GPT-3.5 Turbo</option>
                    <option value="claude">Claude 3</option>
                    <option value="deepseek">DeepSeek</option>
                </select>
                        </div>

            <!-- åˆ›é€ æ€§è®¾ç½® -->
            <div class="mb-4">
                <label class="form-label text-white">åˆ›é€ æ€§ (Temperature)</label>
                <input type="range" class="form-range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                <div class="d-flex justify-content-between small text-white-50">
                    <span>ä¿å®ˆ</span>
                    <span id="temperatureValue">0.7</span>
                    <span>åˆ›æ–°</span>
                    </div>
                </div>
                
            <!-- æœ€å¤§å›å¤é•¿åº¦ -->
            <div class="mb-4">
                <label class="form-label text-white">æœ€å¤§å›å¤é•¿åº¦</label>
                <select class="form-select input-field" id="maxTokens">
                    <option value="512">çŸ­å›å¤ (512)</option>
                    <option value="1024" selected>ä¸­ç­‰å›å¤ (1024)</option>
                    <option value="2048">é•¿å›å¤ (2048)</option>
                    <option value="4096">è¶…é•¿å›å¤ (4096)</option>
                </select>
                        </div>

            <!-- åŠŸèƒ½å¼€å…³ -->
            <div class="mb-4">
                <h6 class="text-white mb-3">åŠŸèƒ½è®¾ç½®</h6>
                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="enableVoice" checked>
                    <label class="form-check-label text-white" for="enableVoice">è¯­éŸ³è¾“å…¥</label>
                        </div>
                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="enableFileUpload" checked>
                    <label class="form-check-label text-white" for="enableFileUpload">æ–‡ä»¶ä¸Šä¼ </label>
                    </div>
                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="enableCodeHighlight" checked>
                    <label class="form-check-label text-white" for="enableCodeHighlight">ä»£ç é«˜äº®</label>
                </div>
                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="enableAutoSave" checked>
                    <label class="form-check-label text-white" for="enableAutoSave">è‡ªåŠ¨ä¿å­˜</label>
                </div>
            </div>
            
            <!-- å¿«æ·é”®è¯´æ˜ -->
            <div class="mb-4">
                <h6 class="text-white mb-3">å¿«æ·é”®</h6>
                <div class="small text-white-50">
                    <div class="d-flex justify-content-between mb-1">
                        <span>å‘é€æ¶ˆæ¯</span>
                        <kbd class="bg-secondary">Enter</kbd>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>æ¢è¡Œ</span>
                        <kbd class="bg-secondary">Shift+Enter</kbd>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>æ¸…ç©ºè¾“å…¥</span>
                        <kbd class="bg-secondary">Ctrl+L</kbd>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>è¯­éŸ³è¾“å…¥</span>
                        <kbd class="bg-secondary">Ctrl+M</kbd>
                    </div>
                </div>
            </div>
            
            <!-- é‡ç½®æŒ‰é’® -->
            <button class="btn btn-outline-light w-100" onclick="resetSettings()">
                <i class="fas fa-undo me-2"></i>é‡ç½®è®¾ç½®
                    </button>
        </div>
    </div>
    
    <!-- Toasté€šçŸ¥å®¹å™¨ -->
    <div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer"></div>

    <!-- JavaScriptæ ¸å¿ƒ -->
    <script src="/assets/js/https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- è‡ªå®šä¹‰è„šæœ¬ -->
    <script>
        // èŠå¤©ç³»ç»Ÿæ ¸å¿ƒç±»
        class EnhancedChatSystem {
            constructor() {
                this.currentChatId = null;
                this.messages = [];
                this.websocket = null;
                this.isTyping = false;
                this.settings = {
                    model: 'gpt-4',
                    temperature: 0.7,
                    maxTokens: 1024,
                    enableVoice: true,
                    enableFileUpload: true,
                    enableCodeHighlight: true,
                    enableAutoSave: true
                };
                this.init();
            }

            init() {
                console.log('ğŸš€ åˆå§‹åŒ–å¢å¼ºèŠå¤©ç³»ç»Ÿ...');
                this.setupEventListeners();
                this.setupWebSocket();
                this.loadChatHistory();
                this.setupQuantumBackground();
                this.loadSettings();
                this.setupAutoResize();
                this.setupShortcuts();
                console.log('âœ… èŠå¤©ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            }

            setupEventListeners() {
                // å‘é€æ¶ˆæ¯
                document.getElementById('sendMessage').addEventListener('click', () => this.sendMessage());
                document.getElementById('messageInput').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // æ–‡ä»¶ä¸Šä¼ 
                document.getElementById('attachFile').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });
                
                document.getElementById('fileInput').addEventListener('change', (e) => {
                    this.handleFileUpload(e.target.files);
                });

                // è¯­éŸ³è¾“å…¥
                document.getElementById('voiceInput').addEventListener('click', () => {
                    this.toggleVoiceInput();
                });

                // ä¾§è¾¹æ åˆ‡æ¢
                document.getElementById('toggleSidebar').addEventListener('click', () => {
                    this.toggleSidebar();
                });

                // è®¾ç½®é¢æ¿
                document.getElementById('toggleSettings').addEventListener('click', () => {
                    const offcanvas = new bootstrap.Offcanvas(document.getElementById('settingsPanel'));
                    offcanvas.show();
                });

                // å…¨å±åˆ‡æ¢
                document.getElementById('toggleFullscreen').addEventListener('click', () => {
                    this.toggleFullscreen();
                });

                // æ¸©åº¦æ»‘å—
                document.getElementById('temperature').addEventListener('input', (e) => {
                    document.getElementById('temperatureValue').textContent = e.target.value;
                    this.settings.temperature = parseFloat(e.target.value);
                    this.saveSettings();
                });

                // æ–‡ä»¶æ‹–æ‹½
                this.setupFileDragDrop();
            }

            setupWebSocket() {
                try {
                    this.websocket = new WebSocket('ws://localhost:8081/chat');
                    
                    this.websocket.onopen = () => {
                        console.log('ğŸ”— WebSocketè¿æ¥å·²å»ºç«‹');
                        this.updateConnectionStatus(true);
                    };
                    
                    this.websocket.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleWebSocketMessage(data);
                    };
                    
                    this.websocket.onclose = () => {
                        console.log('ğŸ”Œ WebSocketè¿æ¥å·²æ–­å¼€');
                        this.updateConnectionStatus(false);
                        // è‡ªåŠ¨é‡è¿
                        setTimeout(() => this.setupWebSocket(), 5000);
                    };
                    
                    this.websocket.onerror = (error) => {
                        console.error('âŒ WebSocketé”™è¯¯:', error);
                        this.updateConnectionStatus(false);
                    };
                } catch (error) {
                    console.error('âŒ WebSocketåˆå§‹åŒ–å¤±è´¥:', error);
                    this.updateConnectionStatus(false);
                }
            }

            async sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            input.value = '';
                this.autoResize(input);

                // éšè—æ¬¢è¿ç•Œé¢
                const welcomeSection = document.getElementById('welcomeSection');
                if (welcomeSection) {
                    welcomeSection.style.display = 'none';
                }

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                this.addMessage({
                    type: 'user',
                    content: message,
                    timestamp: new Date()
                });

                // æ˜¾ç¤ºAIæ€è€ƒçŠ¶æ€
                this.showTypingIndicator();

                try {
                    // å‘é€åˆ°AIæœåŠ¡
                    const response = await this.callAIService(message);
                    
                    // éšè—æ€è€ƒçŠ¶æ€
                    this.hideTypingIndicator();
                    
                    // æ·»åŠ AIå›å¤
                    this.addMessage({
                        type: 'ai',
                        content: response,
                        timestamp: new Date()
                    });

                    // è‡ªåŠ¨ä¿å­˜
                    if (this.settings.enableAutoSave) {
                        this.saveChatHistory();
                    }

                } catch (error) {
                    console.error('âŒ å‘é€æ¶ˆæ¯å¤±è´¥:', error);
                    this.hideTypingIndicator();
                    this.addMessage({
                        type: 'error',
                        content: 'æŠ±æ­‰ï¼Œæ¶ˆæ¯å‘é€å¤±è´¥ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚',
                        timestamp: new Date()
                    });
                }
            }

            async callAIService(message) {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.getAuthToken()}`
                    },
                    body: JSON.stringify({
                        message: message,
                        chatId: this.currentChatId,
                        settings: this.settings,
                        history: this.messages.slice(-10) // å‘é€æœ€è¿‘10æ¡æ¶ˆæ¯ä½œä¸ºä¸Šä¸‹æ–‡
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                return data.response;
            }

            addMessage(message) {
            const chatMessages = document.getElementById('chatMessages');
                const messageElement = this.createMessageElement(message);
                
                chatMessages.appendChild(messageElement);
                this.messages.push(message);
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                this.scrollToBottom();
                
                // åŠ¨ç”»æ•ˆæœ
                gsap.fromTo(messageElement, 
                    { opacity: 0, y: 20 }, 
                    { opacity: 1, y: 0, duration: 0.5, ease: "power2.out" }
                );
            }

            createMessageElement(message) {
            const messageDiv = document.createElement('div');
                messageDiv.className = `message-bubble mb-3 p-3 rounded-4 ${this.getMessageClass(message.type)}`;
            
                const content = this.formatMessageContent(message.content, message.type);
                const timestamp = this.formatTimestamp(message.timestamp);
                
                messageDiv.innerHTML = `
                    <div class="d-flex align-items-start gap-3">
                        ${this.getMessageAvatar(message.type)}
                        <div class="flex-grow-1">
                            <div class="message-content">${content}</div>
                            <div class="message-meta mt-2 d-flex justify-content-between align-items-center">
                                <small class="text-white-50">${timestamp}</small>
                                <div class="message-actions">
                                    <button class="btn btn-sm text-white-50" onclick="copyMessage(this)" title="å¤åˆ¶">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    ${message.type === 'ai' ? `
                                        <button class="btn btn-sm text-white-50" onclick="regenerateResponse(this)" title="é‡æ–°ç”Ÿæˆ">
                                            <i class="fas fa-redo"></i>
                                        </button>
                                    ` : ''}
                    </div>
                    </div>
                    </div>
                    </div>
                `;
                
                return messageDiv;
            }

            getMessageClass(type) {
                switch (type) {
                    case 'user': return 'user-message ms-5';
                    case 'ai': return 'ai-message me-5';
                    case 'system': return 'system-message';
                    case 'error': return 'error-message';
                    case 'warning': return 'warning-message';
                    default: return 'ai-message me-5';
                }
            }

            getMessageAvatar(type) {
                switch (type) {
                    case 'user':
                        return '<div class="avatar bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-user text-white"></i></div>';
                    case 'ai':
                        return '<div class="avatar bg-gradient-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-robot text-white"></i></div>';
                    case 'system':
                        return '<div class="avatar bg-success rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-cog text-white"></i></div>';
                    default:
                        return '<div class="avatar bg-secondary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;"><i class="fas fa-info text-white"></i></div>';
                }
            }

            formatMessageContent(content, type) {
                if (type === 'ai' && this.settings.enableCodeHighlight) {
                    // å¤„ç†ä»£ç å—
                    content = content.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, language, code) => {
                        const lang = language || 'text';
                        return `
                            <div class="code-block mt-2 mb-2">
                                <div class="code-header">
                                    <span class="text-white-50">${lang}</span>
                                    <button class="btn btn-sm text-white-50" onclick="copyCode(this)" title="å¤åˆ¶ä»£ç ">
                                        <i class="fas fa-copy"></i>
                                    </button>
                </div>
                                <pre class="p-3 mb-0"><code class="language-${lang}">${this.escapeHtml(code.trim())}</code></pre>
                            </div>
                        `;
                    });
                    
                    // å¤„ç†è¡Œå†…ä»£ç 
                    content = content.replace(/`([^`]+)`/g, '<code class="bg-dark text-warning p-1 rounded">$1</code>');
                }
                
                // å¤„ç†Markdown
                if (typeof marked !== 'undefined') {
                    content = marked.parse(content);
                }
                
                return content;
            }

            formatTimestamp(timestamp) {
                return new Date(timestamp).toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            showTypingIndicator() {
                if (this.isTyping) return;
                
                this.isTyping = true;
                const typingElement = document.createElement('div');
                typingElement.id = 'typingIndicator';
                typingElement.className = 'message-bubble ai-message me-5 mb-3 p-3 rounded-4';
                typingElement.innerHTML = `
                    <div class="d-flex align-items-start gap-3">
                        ${this.getMessageAvatar('ai')}
                <div class="typing-indicator">
                            <span class="text-white-50 me-2">AIæ­£åœ¨æ€è€ƒ</span>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                </div>
            `;
            
                document.getElementById('chatMessages').appendChild(typingElement);
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }
                this.isTyping = false;
            }

            scrollToBottom() {
                const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
            // ...existing code...
            setupQuantumBackground() {
                const container = document.getElementById('quantum-particles');
                const particleCount = 50;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'quantum-particle';
                    particle.style.cssText = `
                        position: absolute;
                        width: ${Math.random() * 4 + 2}px;
                        height: ${Math.random() * 4 + 2}px;
                        background: rgba(102, 126, 234, ${Math.random() * 0.5 + 0.2});
                        border-radius: 50%;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                        animation: float ${Math.random() * 6 + 4}s ease-in-out infinite;
                        animation-delay: ${Math.random() * 2}s;
                    `;
                    container.appendChild(particle);
                }
            }

            // æ›´å¤šæ–¹æ³•...
            loadSettings() {
                const saved = localStorage.getItem('chatSettings');
                if (saved) {
                    this.settings = { ...this.settings, ...JSON.parse(saved) };
                    this.applySettings();
                }
            }

            saveSettings() {
                localStorage.setItem('chatSettings', JSON.stringify(this.settings));
            }

            applySettings() {
                document.getElementById('aiModel').value = this.settings.model;
                document.getElementById('temperature').value = this.settings.temperature;
                document.getElementById('temperatureValue').textContent = this.settings.temperature;
                document.getElementById('maxTokens').value = this.settings.maxTokens;
                document.getElementById('enableVoice').checked = this.settings.enableVoice;
                document.getElementById('enableFileUpload').checked = this.settings.enableFileUpload;
                document.getElementById('enableCodeHighlight').checked = this.settings.enableCodeHighlight;
                document.getElementById('enableAutoSave').checked = this.settings.enableAutoSave;
            }

            setupAutoResize() {
                const textarea = document.getElementById('messageInput');
                textarea.addEventListener('input', () => this.autoResize(textarea));
            }

            autoResize(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
            }

            setupShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey) {
                        switch (e.key.toLowerCase()) {
                            case 'l':
                                e.preventDefault();
                                document.getElementById('messageInput').value = '';
                                break;
                            case 'm':
                                e.preventDefault();
                                this.toggleVoiceInput();
                                break;
                        }
                    }
                });
            }

            toggleVoiceInput() {
                // è¯­éŸ³è¾“å…¥å®ç°
                console.log('ğŸ¤ è¯­éŸ³è¾“å…¥åŠŸèƒ½');
            }

            toggleSidebar() {
                const sidebar = document.getElementById('chatSidebar');
                sidebar.classList.toggle('active');
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }

            // å·¥å…·æ–¹æ³•
            getAuthToken() {
                return localStorage.getItem('auth_token') || '';
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            updateConnectionStatus(connected) {
                const statusDot = document.querySelector('.status-dot');
                const statusText = document.querySelector('.ai-status span');
                
                if (connected) {
                    statusDot.style.background = '#10b981';
                    statusText.textContent = 'AIåœ¨çº¿';
                } else {
                    statusDot.style.background = '#ef4444';
                    statusText.textContent = 'AIç¦»çº¿';
                }
            }

            // æ›´å¤šå®ç”¨æ–¹æ³•...
            newChat() {
                this.currentChatId = this.generateChatId();
                this.messages = [];
                document.getElementById('chatMessages').innerHTML = '';
                document.getElementById('welcomeSection').style.display = 'block';
            }

            generateChatId() {
                return 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            saveChatHistory() {
                const chats = JSON.parse(localStorage.getItem('chatHistory') || '[]');
                const currentChat = {
                    id: this.currentChatId,
                    messages: this.messages,
                    timestamp: new Date(),
                    title: this.generateChatTitle()
                };
                
                chats.unshift(currentChat);
                localStorage.setItem('chatHistory', JSON.stringify(chats.slice(0, 50))); // ä¿å­˜æœ€è¿‘50ä¸ªå¯¹è¯
                this.renderChatHistory();
            }

            loadChatHistory() {
                const chats = JSON.parse(localStorage.getItem('chatHistory') || '[]');
                this.renderChatHistory(chats);
            }

            renderChatHistory(chats = []) {
                const container = document.getElementById('chatHistory');
                container.innerHTML = '';
                
                chats.forEach(chat => {
                    const item = document.createElement('div');
                    item.className = 'chat-history-item p-3 mb-2 rounded-3 cursor-pointer';
                    item.innerHTML = `
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="text-white mb-1">${chat.title}</div>
                                <div class="small text-white-50">${this.formatTimestamp(chat.timestamp)}</div>
                            </div>
                            <button class="btn btn-sm text-white-50" onclick="deleteChat('${chat.id}')" title="åˆ é™¤">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    item.addEventListener('click', () => this.loadChat(chat.id));
                    container.appendChild(item);
                });
            }

            generateChatTitle() {
                if (this.messages.length > 0) {
                    const firstMessage = this.messages.find(m => m.type === 'user');
                    if (firstMessage) {
                        return firstMessage.content.substring(0, 30) + (firstMessage.content.length > 30 ? '...' : '');
                    }
                }
                return 'æ–°å¯¹è¯';
            }
        }

        // å…¨å±€å‡½æ•°
        function insertQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            document.getElementById('messageInput').focus();
        }

        function copyMessage(button) {
            const messageContent = button.closest('.message-bubble').querySelector('.message-content').textContent;
            navigator.clipboard.writeText(messageContent);
            showToast('æ¶ˆæ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }

        function copyCode(button) {
            const codeContent = button.closest('.code-block').querySelector('code').textContent;
            navigator.clipboard.writeText(codeContent);
            showToast('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }

        function regenerateResponse(button) {
            // é‡æ–°ç”ŸæˆAIå›å¤çš„é€»è¾‘
            showToast('æ­£åœ¨é‡æ–°ç”Ÿæˆå›å¤...', 'info');
        }

        function resetSettings() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿ')) {
                localStorage.removeItem('chatSettings');
                window.location.reload();
            }
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast_' + Date.now();
            
            const toastHTML = `
                <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0" role="alert" id="${toastId}">
                    <div class="d-flex">
                        <div class="toast-body">${message}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            const toast = new bootstrap.Toast(document.getElementById(toastId));
            toast.show();
        }

        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('auth_token');
                window.location.href = '/login.html';
            }
        }

        // åˆå§‹åŒ–ç³»ç»Ÿ
        let chatSystem;
        document.addEventListener('DOMContentLoaded', () => {
            chatSystem = new EnhancedChatSystem();
        });
    </script>
</body>
</html>
