async function runEndToEndChatTest(){const results={passed: 0,failed: 0,tests: []};function addTest(name,passed,details=''){results.tests.push({name,passed,details});if(passed)results.passed++;else results.failed++;}try{try{const healthResponse=await fetch('/health');const healthData=await healthResponse.json();addTest('æœåŠ¡å™¨å¥åº·æ£€æŸ¥',healthResponse.ok && healthData.status==='healthy',`æ•°æ®åº“: ${healthData.database}`);}catch(error){addTest('æœåŠ¡å™¨å¥åº·æ£€æŸ¥',false,error.message);}try{const chatResponse=await fetch('/api/chat/deepseek-chat',{method: 'POST',headers:{'Content-Type': 'application/json'},body: JSON.stringify({text: 'è¿™æ˜¯ä¸€ä¸ªAPIè¿žæŽ¥æµ‹è¯•æ¶ˆæ¯',temperature: 0.7})});const chatData=await chatResponse.json();addTest('èŠå¤©APIè¿žæŽ¥',chatResponse.ok && chatData.success,`å“åº”é•¿åº¦: ${chatData.assistantText?.length || 0}`);}catch(error){addTest('èŠå¤©APIè¿žæŽ¥',false,error.message);}const requiredElements=[ 'messageInput','sendButton','chatMessages','guestModeButton','recordButton','settingsBtn' ];for(const elementId of requiredElements){const element=document.getElementById(elementId);addTest(`å…ƒç´  ${elementId}`,element !==null,element ? 'å­˜åœ¨' : 'ç¼ºå¤±');}const hasCore=typeof ChatCore !=='undefined';const hasUI=typeof ChatUI !=='undefined';const hasAPI=typeof ChatAPI !=='undefined';const hasInstance=typeof window.chatInstance !=='undefined' && window.chatInstance !==null;addTest('ChatCoreæ¨¡å—',hasCore);addTest('ChatUIæ¨¡å—',hasUI);addTest('ChatAPIæ¨¡å—',hasAPI);addTest('chatInstanceå®žä¾‹',hasInstance);const guestButton=document.getElementById('guestModeButton');if(guestButton){guestButton.click();await new Promise(resolve=> setTimeout(resolve,500));const guestMode=localStorage.getItem('guestMode');addTest('è®¿å®¢æ¨¡å¼æ¿€æ´»',guestMode==='true');}else{addTest('è®¿å®¢æ¨¡å¼æ¿€æ´»',false,'æŒ‰é’®ä¸å­˜åœ¨');}const messageInput=document.getElementById('messageInput');const sendButton=document.getElementById('sendButton');if(messageInput && sendButton){const testMessage='è¿™æ˜¯ä¸€æ¡ç«¯åˆ°ç«¯æµ‹è¯•æ¶ˆæ¯ '+Date.now();messageInput.value=testMessage;messageInput.dispatchEvent(new Event('input'));addTest('å‘é€æŒ‰é’®å¯ç”¨',!sendButton.disabled);const chatMessages=document.getElementById('chatMessages');const messageCountBefore=chatMessages.children.length;sendButton.click();await new Promise(resolve=> setTimeout(resolve,2000));const messageCountAfter=chatMessages.children.length;addTest('æ¶ˆæ¯æ·»åŠ åˆ°ç•Œé¢',messageCountAfter > messageCountBefore,`æ¶ˆæ¯æ•°é‡: ${messageCountBefore}â†’ ${messageCountAfter}`);}else{addTest('æ¶ˆæ¯å‘é€æµ‹è¯•',false,'è¾“å…¥æ¡†æˆ–æŒ‰é’®ç¼ºå¤±');}if(messageInput){messageInput.value='å›žè½¦é”®æµ‹è¯•æ¶ˆæ¯';const enterEvent=new KeyboardEvent('keydown',{key: 'Enter',keyCode: 13,which: 13});messageInput.dispatchEvent(enterEvent);addTest('å›žè½¦é”®å‘é€',true,'äº‹ä»¶å·²è§¦å‘');}else{addTest('å›žè½¦é”®å‘é€',false,'è¾“å…¥æ¡†ä¸å­˜åœ¨');}const settingsBtn=document.getElementById('settingsBtn');const historyBtn=document.getElementById('historyBtn');addTest('è®¾ç½®æŒ‰é’®å“åº”',settingsBtn && settingsBtn.onclick !==null);addTest('åŽ†å²æŒ‰é’®å“åº”',historyBtn && historyBtn.onclick !==null);}catch(error){console.error('æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:',error);addTest('æµ‹è¯•æ‰§è¡Œ',false,error.message);}console.log('\n'+'='.repeat(50));console.log('='.repeat(50));console.log(`ðŸ“Š æˆåŠŸçŽ‡: ${Math.round((results.passed/(results.passed+results.failed))*100)}%`);results.tests.forEach(test=>{});if(results.failed > 0){results.tests.filter(t=> !t.passed).forEach(test=>{if(test.name.includes('æœåŠ¡å™¨')){}else if(test.name.includes('API')){}else if(test.name.includes('å…ƒç´ ')){}else if(test.name.includes('æ¨¡å—')){}});}return results;}setTimeout(()=>{runEndToEndChatTest().then(results=>{window.testResults=results;});},3000);