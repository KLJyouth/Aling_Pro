class ChatFunctionVerifier{constructor(){this.results={total: 0,passed: 0,failed: 0,tests: []};this.startTime=Date.now();}log(message,status='info'){const timestamp=new Date().toLocaleTimeString();const icons={info: 'â„¹ï¸',success: 'âœ…',error: 'âŒ',warning: 'âš ï¸'};}addTest(name,passed,details=''){this.results.total++;if(passed)this.results.passed++;else this.results.failed++;this.results.tests.push({name,passed,details,timestamp: Date.now()});this.log(`${name}${details ? `-${details}` : ''}`,passed ? 'success' : 'error');}async sleep(ms){return new Promise(resolve=> setTimeout(resolve,ms));}async verifyServerHealth(){this.log('æ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶æ€...');try{const response=await fetch('/health');const data=await response.json();this.addTest('æœåŠ¡å™¨å¥åº·æ£€æŸ¥',response.ok && data.status==='healthy',`çŠ¶æ€: ${data.status},æ•°æ®åº“: ${data.database}`);}catch(error){this.addTest('æœåŠ¡å™¨å¥åº·æ£€æŸ¥',false,error.message);}}async verifyAPIConnection(){this.log('æµ‹è¯•èŠå¤©APIè¿æ¥...');try{const response=await fetch(API_ENDPOINTS.CHAT_DEEPSEEK,{method: 'POST',headers:{'Content-Type': 'application/json'},body: JSON.stringify({text: 'è¿™æ˜¯APIè¿æ¥éªŒè¯æ¶ˆæ¯',temperature: 0.7,max_tokens: 100})});const data=await response.json();this.addTest('èŠå¤©APIè¿æ¥',response.ok && data.success,`å“åº”é•¿åº¦: ${data.assistantText?.length || 0}å­—ç¬¦`);return data;}catch(error){this.addTest('èŠå¤©APIè¿æ¥',false,error.message);return null;}}verifyDOMElements(){this.log('æ£€æŸ¥é¡µé¢DOMå…ƒç´ ...');const requiredElements={'messageInput': 'æ¶ˆæ¯è¾“å…¥æ¡†','sendButton': 'å‘é€æŒ‰é’®','chatMessages': 'æ¶ˆæ¯å®¹å™¨','guestModeButton': 'è®¿å®¢æ¨¡å¼æŒ‰é’®','recordButton': 'å½•éŸ³æŒ‰é’®','settingsBtn': 'è®¾ç½®æŒ‰é’®','historyBtn': 'å†å²æŒ‰é’®','loginModal': 'ç™»å½•æ¨¡æ€æ¡†'};Object.entries(requiredElements).forEach(([id,name])=>{const element=document.getElementById(id);this.addTest(`DOMå…ƒç´ : ${name}`,element !==null,id);});}verifyJavaScriptModules(){this.log('æ£€æŸ¥JavaScriptæ¨¡å—åŠ è½½...');const globalChecks={'ChatCoreç±»': typeof ChatCore !=='undefined','ChatUIç±»': typeof ChatUI !=='undefined','ChatAPIç±»': typeof ChatAPI !=='undefined','chatInstanceå®ä¾‹': typeof window.chatInstance !=='undefined' && window.chatInstance !==null,'manualTestHelper': typeof window.manualTestHelper !=='undefined'};Object.entries(globalChecks).forEach(([name,exists])=>{this.addTest(`JSæ¨¡å—: ${name}`,exists);});}async verifyGuestMode(){this.log('æµ‹è¯•è®¿å®¢æ¨¡å¼åŠŸèƒ½...');const guestButton=document.getElementById('guestModeButton');if(guestButton){guestButton.click();await this.sleep(500);const guestMode=localStorage.getItem('guestMode');this.addTest('è®¿å®¢æ¨¡å¼æ¿€æ´»',guestMode==='true');}else{this.addTest('è®¿å®¢æ¨¡å¼æ¿€æ´»',false,'æŒ‰é’®ä¸å­˜åœ¨');}}async verifyMessageSending(){this.log('æµ‹è¯•æ¶ˆæ¯å‘é€åŠŸèƒ½...');const messageInput=document.getElementById('messageInput');const sendButton=document.getElementById('sendButton');const chatMessages=document.getElementById('chatMessages');if(!messageInput || !sendButton || !chatMessages){this.addTest('æ¶ˆæ¯å‘é€å‡†å¤‡',false,'ç¼ºå°‘å¿…è¦å…ƒç´ ');return;}const initialMessageCount=chatMessages.children.length;const testMessage=`éªŒè¯æµ‹è¯•æ¶ˆæ¯ ${Date.now()}`;messageInput.value=testMessage;messageInput.dispatchEvent(new Event('input'));const buttonEnabled=!sendButton.disabled;this.addTest('å‘é€æŒ‰é’®çŠ¶æ€',buttonEnabled);if(buttonEnabled){sendButton.click();await this.sleep(2000);const finalMessageCount=chatMessages.children.length;this.addTest('æ¶ˆæ¯æ·»åŠ åˆ°ç•Œé¢',finalMessageCount > initialMessageCount,`æ¶ˆæ¯æ•°é‡: ${initialMessageCount}â†’ ${finalMessageCount}`);}}generateReport(){const duration=Date.now()-this.startTime;const successRate=Math.round((this.results.passed/this.results.total)*100);console.log('\n'+'='.repeat(60));console.log('='.repeat(60));console.log(`â±ï¸ æµ‹è¯•æ—¶é•¿: ${Math.round(duration/1000)}ç§’`);this.results.tests.forEach(test=>{});if(successRate >=90){}else if(successRate >=70){}else{}window.verificationReport={...this.results,duration,successRate,timestamp: new Date().toISOString()};return this.results;}async runAllVerifications(){this.log('å¼€å§‹æ‰§è¡Œå®Œæ•´çš„èŠå¤©åŠŸèƒ½éªŒè¯...','info');await this.verifyServerHealth();await this.verifyAPIConnection();this.verifyDOMElements();this.verifyJavaScriptModules();await this.verifyGuestMode();await this.verifyMessageSending();return this.generateReport();}}window.chatVerifier=new ChatFunctionVerifier();setTimeout(async()=>{const results=await window.chatVerifier.runAllVerifications();},3000);window.runManualVerification=()=>{const verifier=new ChatFunctionVerifier();return verifier.runAllVerifications();};console.log('ğŸ’¡ æ‰‹åŠ¨è¿è¡ŒéªŒè¯: window.runManualVerification()');