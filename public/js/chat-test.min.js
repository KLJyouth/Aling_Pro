function waitForPageLoad(){return new Promise(resolve=>{if(document.readyState==='complete'){resolve();}else{window.addEventListener('load',resolve);}});}function testDOMElements(){const requiredElements=[ 'loginModal','loginButton','guestModeButton','userStatus','messageInput','sendButton','chatMessages','historyBtn','settingsBtn' ];const results={};requiredElements.forEach(id=>{const element=document.getElementById(id);results[id]=!!element;if(!element){console.error(`缺少必需的DOM元素: ${id}`);}});return results;}function testGuestMode(){const guestBtn=document.getElementById('guestModeButton');const userStatus=document.getElementById('userStatus');if(!guestBtn){console.error('访客模式按钮不存在');return false;}guestBtn.click();const isGuestMode=localStorage.getItem('guestMode')==='true';if(userStatus){}return isGuestMode;}function testMessageInput(){const messageInput=document.getElementById('messageInput');const sendButton=document.getElementById('sendButton');if(!messageInput || !sendButton){console.error('消息输入元素不存在');return false;}messageInput.value='';messageInput.dispatchEvent(new Event('input'));messageInput.value='测试消息';messageInput.dispatchEvent(new Event('input'));return true;}async function testChatAPI(){try{if(window.chatInstance){const{api}=window.chatInstance;if(api && api.isInitialized){localStorage.setItem('guestMode','true');try{const response=await api.sendMessage('这是一条测试消息');return true;}catch(error){console.error('访客模式消息发送失败:',error);return false;}}else{console.error('API未初始化 ✗');return false;}}else{console.error('聊天实例不存在 ✗');return false;}}catch(error){console.error('API测试失败:',error);return false;}}function testUIFunctions(){if(!window.chatInstance){console.error('聊天实例不存在');return false;}const{ui}=window.chatInstance;try{ui.updateUserStatus('测试状态');const userStatus=document.getElementById('userStatus');ui.addMessage({id: 'test-'+Date.now(),type: 'user',content: '这是一条测试消息',timestamp: new Date().toISOString()});return true;}catch(error){console.error('UI功能测试失败:',error);return false;}}async function runTests(){try{await waitForPageLoad();const domResults=testDOMElements();await new Promise(resolve=> setTimeout(resolve,3000));const guestModeResult=testGuestMode();const inputResult=testMessageInput();const apiResult=await testChatAPI();const uiResult=testUIFunctions();console.log('DOM元素:',Object.values(domResults).every(v=> v)? '✓' : '✗');const allPassed=Object.values(domResults).every(v=> v)&& guestModeResult && inputResult && apiResult && uiResult;return allPassed;}catch(error){console.error('测试过程中发生错误:',error);return false;}}if(typeof window !=='undefined'){if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{setTimeout(runTests,1000);});}else{setTimeout(runTests,1000);}window.chatTest={runTests,testDOMElements,testGuestMode,testMessageInput,testChatAPI,testUIFunctions};}if(typeof module !=='undefined' && module.exports){module.exports={runTests,testDOMElements,testGuestMode,testMessageInput,testChatAPI,testUIFunctions};}