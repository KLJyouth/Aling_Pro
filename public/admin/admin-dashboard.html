            <!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlingAi Pro 5.0 - Admin管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --dark-color: #34495e;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .admin-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            margin: 20px;
            overflow: hidden;
        }

        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--dark-color) 100%);
            min-height: 100vh;
            color: white;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 15px 20px;
            border-radius: 0;
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-tachometer-alt"></i> 系统仪表板</h2>
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i> 
                                <strong>数据库迁移成功！</strong> 
                                15个数据表已创建，系统已准备就绪。默认管理员账户：admin / admin123
                            </div>
                        </div>
                    </div>

                    <!-- 核心指标 -->
                    <div class="row">
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="metric-value" id="totalUsers">1</div>
                                <div class="metric-label">总用户数</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-key"></i>
                                </div>
                                <div class="metric-value" id="activeTokens">0</div>
                                <div class="metric-label">活跃Token</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="metric-value" id="riskEvents">0</div>
                                <div class="metric-label">风险事件</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div class="metric-value" id="emailQueue">0</div>
                                <div class="metric-label">邮件队列</div>
                            </div>
                        </div>
                    </div>

                    <!-- 系统状态 -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5><i class="fas fa-server"></i> 系统状态</h5>
                                <div id="systemStatus">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>MySQL数据库</span>
                                        <span class="status-badge status-success">已连接</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>API网关</span>
                                        <span class="status-badge status-success">运行中</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>WebSocket</span>
                                        <span class="status-badge status-warning" id="wsStatus">检查中...</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>邮件系统</span>
                                        <span class="status-badge status-success">就绪</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="metric-card">
                                <h5><i class="fas fa-database"></i> 数据表状态</h5>
                                <div id="databaseTables">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_users</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_tokens</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_permissions</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_api_keys</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_system_logs</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_monitoring</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_risk_control</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_email_queue</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_chat_monitoring</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small>admin_migrations</small>
                                                <span class="status-badge status-success">✓</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- API测试区域 -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="api-test-section">
                                <h5><i class="fas fa-flask"></i> API快速测试</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <button class="btn btn-primary-custom btn-custom me-2 mb-2" onclick="testAPI('users')">
                                            <i class="fas fa-users"></i> 测试用户API
                                        </button>
                                        <button class="btn btn-primary-custom btn-custom me-2 mb-2" onclick="testAPI('monitoring')">
                                            <i class="fas fa-chart-line"></i> 测试监控API
                                        </button>
                                        <button class="btn btn-primary-custom btn-custom me-2 mb-2" onclick="testAPI('third-party')">
                                            <i class="fas fa-plug"></i> 测试第三方API
                                        </button>
                                        <button class="btn btn-primary-custom btn-custom me-2 mb-2" onclick="testAPI('email')">
                                            <i class="fas fa-envelope"></i> 测试邮件API
                                        </button>
                                        <button class="btn btn-primary-custom btn-custom me-2 mb-2" onclick="testAPI('gateway')">
                                            <i class="fas fa-gateway"></i> 测试网关API
                                        </button>
                                        <button class="btn btn-primary-custom btn-custom me-2 mb-2" onclick="testAPI('websocket')">
                                            <i class="fas fa-plug"></i> 测试WebSocket
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <div id="apiTestResults" class="log-viewer" style="max-height: 200px; display: none;">
                                            <!-- API测试结果将在这里显示 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 用户管理 -->
                <div class="tab-pane fade" id="users">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-users"></i> 用户管理</h2>
                            <div class="metric-card">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5>用户列表</h5>
                                    <button class="btn btn-primary-custom btn-custom" onclick="loadUsers()">
                                        <i class="fas fa-sync-alt"></i> 刷新数据
                                    </button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>用户名</th>
                                                <th>邮箱</th>
                                                <th>角色</th>
                                                <th>状态</th>
                                                <th>最后登录</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usersTableBody">
                                            <tr>
                                                <td>1</td>
                                                <td>admin</td>
                                                <td>admin@alingai.com</td>
                                                <td><span class="badge bg-primary">super_admin</span></td>
                                                <td><span class="status-badge status-success">活跃</span></td>
                                                <td>刚刚创建</td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary">编辑</button>
                                                    <button class="btn btn-sm btn-outline-danger">删除</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第三方服务 -->
                <div class="tab-pane fade" id="thirdparty">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-plug"></i> 第三方服务管理</h2>
                            <div class="metric-card">
                                <h5>服务状态</h5>
                                <div id="thirdPartyServices">
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6><i class="fas fa-credit-card"></i> 支付服务</h6>
                                                    <span class="status-badge status-warning">待配置</span>
                                                    <p class="small mt-2">需要配置支付接口</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6><i class="fas fa-sms"></i> 短信服务</h6>
                                                    <span class="status-badge status-warning">待配置</span>
                                                    <p class="small mt-2">需要配置短信接口</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6><i class="fas fa-envelope"></i> 邮件服务</h6>
                                                    <span class="status-badge status-success">已配置</span>
                                                    <p class="small mt-2">SMTP服务就绪</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统监控 -->
                <div class="tab-pane fade" id="monitoring">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-chart-line"></i> 系统监控</h2>
                            <div class="metric-card">
                                <h5>监控指标</h5>
                                <div id="monitoringData">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3 class="text-primary">正常</h3>
                                                <p>系统状态</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3 class="text-success">在线</h3>
                                                <p>数据库状态</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center">
                                                <h3 class="text-info">8/8</h3>
                                                <p>API模块</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 风控管理 -->
                <div class="tab-pane fade" id="riskcontrol">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-shield-alt"></i> 风控管理</h2>
                            <div class="metric-card">
                                <h5>风险控制规则</h5>
                                <div id="riskControlData">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i> 
                                        已加载2条默认风控规则：频繁登录检测、异常IP检测。
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>规则名称</th>
                                                    <th>类型</th>
                                                    <th>状态</th>
                                                    <th>触发次数</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>频繁登录检测</td>
                                                    <td>login_frequency</td>
                                                    <td><span class="status-badge status-success">启用</span></td>
                                                    <td>0</td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary">编辑</button>
                                                        <button class="btn btn-sm btn-outline-danger">禁用</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>异常IP检测</td>
                                                    <td>ip_location</td>
                                                    <td><span class="status-badge status-success">启用</span></td>
                                                    <td>0</td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary">编辑</button>
                                                        <button class="btn btn-sm btn-outline-danger">禁用</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 邮件系统 -->
                <div class="tab-pane fade" id="email">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-envelope"></i> 邮件系统</h2>
                            <div class="metric-card">
                                <h5>邮件模板</h5>
                                <div id="emailSystemData">
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle"></i> 
                                        已加载2个默认邮件模板：欢迎邮件、密码重置。
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6><i class="fas fa-envelope-open"></i> 欢迎邮件</h6>
                                                    <span class="status-badge status-success">活跃</span>
                                                    <p class="small mt-2">新用户注册时发送</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h6><i class="fas fa-key"></i> 密码重置</h6>
                                                    <span class="status-badge status-success">活跃</span>
                                                    <p class="small mt-2">密码重置请求时发送</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 聊天监控 -->
                <div class="tab-pane fade" id="chat">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-comments"></i> 聊天监控</h2>
                            <div class="metric-card">
                                <h5>敏感词库</h5>
                                <div id="chatMonitoringData">
                                    <div class="alert alert-info">
                                        <i class="fas fa-shield-alt"></i> 
                                        已加载4个默认敏感词用于内容审核。
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>敏感词</th>
                                                    <th>分类</th>
                                                    <th>严重程度</th>
                                                    <th>命中次数</th>
                                                    <th>状态</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>诈骗</td>
                                                    <td>fraud</td>
                                                    <td><span class="status-badge status-danger">高</span></td>
                                                    <td>0</td>
                                                    <td><span class="status-badge status-success">启用</span></td>
                                                </tr>
                                                <tr>
                                                    <td>色情</td>
                                                    <td>adult</td>
                                                    <td><span class="status-badge status-danger">高</span></td>
                                                    <td>0</td>
                                                    <td><span class="status-badge status-success">启用</span></td>
                                                </tr>
                                                <tr>
                                                    <td>暴力</td>
                                                    <td>violence</td>
                                                    <td><span class="status-badge status-warning">中</span></td>
                                                    <td>0</td>
                                                    <td><span class="status-badge status-success">启用</span></td>
                                                </tr>
                                                <tr>
                                                    <td>垃圾</td>
                                                    <td>inappropriate</td>
                                                    <td><span class="status-badge status-warning">低</span></td>
                                                    <td>0</td>
                                                    <td><span class="status-badge status-success">启用</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API文档 -->
                <div class="tab-pane fade" id="api">
                    <div class="row">
                        <div class="col-12">
                            <h2 class="mb-4"><i class="fas fa-code"></i> API文档</h2>
                            <div class="metric-card">
                                <h5>可用API端点</h5>
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>方法</th>
                                                <th>端点</th>
                                                <th>描述</th>
                                                <th>状态</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><span class="badge bg-primary">GET</span></td>
                                                <td>/admin/api/users</td>
                                                <td>获取用户列表</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-success">POST</span></td>
                                                <td>/admin/api/users</td>
                                                <td>创建新用户</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">GET</span></td>
                                                <td>/admin/api/monitoring</td>
                                                <td>获取监控指标</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">GET</span></td>
                                                <td>/admin/api/third-party</td>
                                                <td>第三方服务状态</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">GET</span></td>
                                                <td>/admin/api/risk-control</td>
                                                <td>风控管理</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">GET</span></td>
                                                <td>/admin/api/email</td>
                                                <td>邮件系统管理</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">GET</span></td>
                                                <td>/admin/api/chat-monitoring</td>
                                                <td>聊天监控</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">GET</span></td>
                                                <td>/admin/api/gateway</td>
                                                <td>API网关状态</td>
                                                <td><span class="status-badge status-success">可用</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 主要管理系统类
        class AdminSystemManager {
            constructor() {
                this.baseURL = '/admin/api';
                this.wsClient = null;
                this.init();
            }

            async init() {
                console.log('🚀 Initializing Admin System...');
                
                // 初始化WebSocket
                this.initWebSocket();
                
                // 加载初始数据
                await this.loadDashboardData();
                
                // 设置定时刷新
                this.setupAutoRefresh();
                
                console.log('✅ Admin System initialized successfully!');
            }

            initWebSocket() {
                try {
                    // 尝试连接WebSocket
                    const ws = new WebSocket('ws://127.0.0.1:8080');
                    
                    ws.onopen = () => {
                        this.updateConnectionStatus('WebSocket连接成功', 'success');
                        document.getElementById('wsStatus').textContent = '已连接';
                        document.getElementById('wsStatus').className = 'status-badge status-success';
                        
                        // 发送心跳
                        const heartbeat = () => {
                            if (ws.readyState === WebSocket.OPEN) {
                                ws.send(JSON.stringify({type: 'ping', timestamp: Date.now()}));
                            }
                        };
                        setInterval(heartbeat, 30000);
                    };

                    ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleWebSocketMessage(data);
                        } catch (e) {
                            console.log('WebSocket消息:', event.data);
                        }
                    };

                    ws.onclose = () => {
                        this.updateConnectionStatus('WebSocket连接断开', 'warning');
                        document.getElementById('wsStatus').textContent = '断开';
                        document.getElementById('wsStatus').className = 'status-badge status-danger';
                    };

                    ws.onerror = () => {
                        this.updateConnectionStatus('WebSocket连接失败', 'danger');
                        document.getElementById('wsStatus').textContent = '不可用';
                        document.getElementById('wsStatus').className = 'status-badge status-warning';
                    };

                    this.wsClient = ws;

                } catch (error) {
                    console.log('WebSocket连接失败，使用HTTP轮询模式');
                    document.getElementById('wsStatus').textContent = '不可用';
                    document.getElementById('wsStatus').className = 'status-badge status-warning';
                }
            }

            updateConnectionStatus(message, type) {
                const statusEl = document.getElementById('connectionStatus');
                statusEl.innerHTML = `<i class="fas fa-wifi"></i> ${message}`;
                statusEl.className = `connection-status status-${type}`;
            }

            async loadDashboardData() {
                try {
                    // 模拟加载用户统计
                    document.getElementById('totalUsers').textContent = '1';
                    document.getElementById('activeTokens').textContent = '0';
                    document.getElementById('riskEvents').textContent = '0';
                    document.getElementById('emailQueue').textContent = '0';

                    console.log('✅ Dashboard data loaded');
                } catch (error) {
                    console.error('❌ Failed to load dashboard data:', error);
                }
            }

            async loadUsers() {
                try {
                    const response = await this.fetchAPI('/users');
                    const tbody = document.getElementById('usersTableBody');
                    
                    if (response && response.success && response.data) {
                        tbody.innerHTML = response.data.map(user => `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.username}</td>
                                <td>${user.email}</td>
                                <td><span class="badge bg-primary">${user.role}</span></td>
                                <td><span class="status-badge ${user.is_active ? 'status-success' : 'status-danger'}">
                                    ${user.is_active ? '活跃' : '禁用'}
                                </span></td>
                                <td>${user.last_login_at || '从未'}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary">编辑</button>
                                    <button class="btn btn-sm btn-outline-danger">删除</button>
                                </td>
                            </tr>
                        `).join('');
                    } else {
                        console.log('使用默认用户数据');
                    }
                } catch (error) {
                    console.error('用户数据加载失败:', error);
                }
            }

            async fetchAPI(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                const defaultOptions = {
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                try {
                    const response = await fetch(url, { ...defaultOptions, ...options });
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error(`API请求失败 ${endpoint}:`, error);
                    throw error;
                }
            }

            setupAutoRefresh() {
                // 每30秒刷新仪表板数据
                setInterval(() => {
                    this.loadDashboardData();
                }, 30000);
            }

            handleWebSocketMessage(data) {
                if (data.type === 'metrics_update') {
                    this.updateMetrics(data.metrics);
                } else if (data.type === 'alert') {
                    this.showAlert(data.message, data.level);
                }
            }

            updateMetrics(metrics) {
                Object.keys(metrics).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = metrics[key];
                    }
                });
            }

            showAlert(message, level = 'info') {
                console.log(`${level.toUpperCase()}: ${message}`);
            }
        }

        // API测试函数
        async function testAPI(apiType) {
            const resultsDiv = document.getElementById('apiTestResults');
            resultsDiv.style.display = 'block';
            
            const testResult = document.createElement('div');
            testResult.className = 'log-entry log-info';
            testResult.innerHTML = `<i class="fas fa-sync-alt loading-spinner"></i> 测试 ${apiType} API...`;
            resultsDiv.appendChild(testResult);

            try {
                let endpoint = `/${apiType}`;
                
                if (apiType === 'websocket') {
                    // WebSocket测试
                    testResult.className = 'log-entry log-info';
                    testResult.innerHTML = `<i class="fas fa-plug"></i> WebSocket 连接测试...`;
                    
                    const wsTest = new WebSocket('ws://127.0.0.1:8080');
                    
                    wsTest.onopen = () => {
                        testResult.className = 'log-entry log-success';
                        testResult.innerHTML = `<i class="fas fa-check"></i> WebSocket 连接成功`;
                        wsTest.close();
                    };
                    
                    wsTest.onerror = () => {
                        testResult.className = 'log-entry log-error';
                        testResult.innerHTML = `<i class="fas fa-times"></i> WebSocket 连接失败`;
                    };
                    
                    return;
                }
                
                const response = await adminSystem.fetchAPI(endpoint);
                testResult.className = 'log-entry log-success';
                testResult.innerHTML = `<i class="fas fa-check"></i> ${apiType} API 测试成功`;
            } catch (error) {
                testResult.className = 'log-entry log-error';
                testResult.innerHTML = `<i class="fas fa-times"></i> ${apiType} API 测试失败: ${error.message}`;
            }

            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // 初始化系统
        let adminSystem;
        
        document.addEventListener('DOMContentLoaded', function() {
            adminSystem = new AdminSystemManager();

            // 标签页切换事件
            const tabLinks = document.querySelectorAll('[data-bs-toggle="pill"]');
            tabLinks.forEach(link => {
                link.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('href');
                    
                    // 根据不同标签页加载相应数据
                    switch(target) {
                        case '#users':
                            adminSystem.loadUsers();
                            break;
                        case '#thirdparty':
                            // 加载第三方服务数据
                            break;
                        case '#monitoring':
                            // 加载监控数据
                            break;
                        // ... 其他标签页
                    }
                });
            });
        });

        // 全局函数
        window.testAPI = testAPI;
        window.loadUsers = () => adminSystem.loadUsers();
    </script>
</body>
</html>
