@echo off
REM ?????????????
REM ??????????????????

echo ======================================================
echo ??????????
echo ????????PHP?????
echo ======================================================
echo.

REM ??PHP????
where php >nul 2>nul
if %errorlevel% neq 0 (
    echo ??: ???PHP??????PHP???????PATH??
    echo ??????????PHP...
    
    if exist portable_php\php.exe (
        echo ?????PHP???????PHP?????
        set PHP_CMD=portable_php\php.exe
    ) else (
        echo ??????PHP?
        echo ???PHP??????PHP???portable_php????
        exit /b 1
    )
) else (
    set PHP_CMD=php
)

echo ??PHP: %PHP_CMD%
echo.

REM ??????
set BACKUP_DIR=backups\systematic_fix_%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%%time:~6,2%
set BACKUP_DIR=%BACKUP_DIR: =0%

if not exist %BACKUP_DIR% (
    mkdir %BACKUP_DIR%
    echo ??????: %BACKUP_DIR%
)

echo ????????????...
echo ????????????????
echo.

REM ????????????
%PHP_CMD% -f systematic_fix.php

echo.
if %errorlevel% equ 0 (
    echo ???????????
    echo ???SYSTEMATIC_FIX_REPORT.md???????
) else (
    echo ??????????????????
    echo ??????????????
)

echo.
echo ??????...
pause > nul
