<!DOCTYPE html> <html lang="zh-CN"> <head> <link rel="preload" href="/assets/css/main.css" as="style"> <link rel="preload" href="/assets/js/main.js" as="script"> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>WebSocket æµ‹è¯• - AlingAi Pro</title> <style> body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; } .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 12px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); } h1 { color: #333; text-align: center; margin-bottom: 30px; } .status { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; } .status.connected { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; } .status.disconnected { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; } .controls { display: grid; grid-template-columns: 1fr auto; gap: 10px; margin-bottom: 20px; } input, button { padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; } button { background: #007bff; color: white; cursor: pointer; border: none; min-width: 120px; } button:hover { background: #0056b3; } button:disabled { background: #6c757d; cursor: not-allowed; } .messages { height: 400px; border: 1px solid #ddd; border-radius: 6px; padding: 15px; overflow-y: auto; background: #f8f9fa; font-family: 'Courier New', monospace; } .message { margin-bottom: 10px; padding: 8px; border-radius: 4px; } .message.sent { background: #e3f2fd; border-left: 4px solid #2196f3; } .message.received { background: #f3e5f5; border-left: 4px solid #9c27b0; } .message.system { background: #fff3e0; border-left: 4px solid #ff9800; } .timestamp { font-size: 0.8em; color: #666; margin-right: 10px; } .action-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 20px; } </style> 
        <style>
            @media (max-width: 768px) {
                .container { width: 100%; padding: 0 15px; }
                .row { flex-direction: column; }
                .col { width: 100%; }
            }
            @media (max-width: 480px) {
                body { font-size: 14px; }
                h1 { font-size: 24px; }
                h2 { font-size: 20px; }
            }
        </style></head> <body> <div class="container"> <h1>ğŸ”Œ WebSocket è¿æ¥æµ‹è¯•</h1> <div id="status" class="status disconnected"> âŒ æœªè¿æ¥åˆ° WebSocket æœåŠ¡å™¨ </div> <div class="controls"> <input type="text" id="messageInput" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯..." disabled> <button id="sendBtn" onclick="sendMessage()" disabled>å‘é€æ¶ˆæ¯</button> </div> <div class="action-buttons"> <button onclick="connectWebSocket()">ğŸ”— è¿æ¥æœåŠ¡å™¨</button> <button onclick="disconnectWebSocket()">âŒ æ–­å¼€è¿æ¥</button> <button onclick="sendPing()">ğŸ“¡ å‘é€å¿ƒè·³</button> <button onclick="sendChatMessage()">ğŸ’¬ æµ‹è¯•èŠå¤©</button> <button onclick="sendNotification()">ğŸ”” å‘é€é€šçŸ¥</button> <button onclick="clearMessages()">ğŸ—‘ï¸ æ¸…ç©ºæ¶ˆæ¯</button> </div> <div id="messages" class="messages"></div> </div> <script async> let ws = null; let reconnectAttempts = 0; const maxReconnectAttempts = 5; const statusEl = document.getElementById('status'); const messagesEl = document.getElementById('messages'); const messageInput = document.getElementById('messageInput'); const sendBtn = document.getElementById('sendBtn'); function addMessage(content, type = 'system') { const timestamp = new Date().toLocaleTimeString(); const messageEl = document.createElement('div'); messageEl.className = `message ${type}`; messageEl.innerHTML = `<span class="timestamp">[${timestamp}]</span>${content}`; messagesEl.appendChild(messageEl); messagesEl.scrollTop = messagesEl.scrollHeight; } function updateStatus(connected) { if (connected) { statusEl.className = 'status connected'; statusEl.innerHTML = 'âœ… å·²è¿æ¥åˆ° WebSocket æœåŠ¡å™¨'; messageInput.disabled = false; sendBtn.disabled = false; } else { statusEl.className = 'status disconnected'; statusEl.innerHTML = 'âŒ æœªè¿æ¥åˆ° WebSocket æœåŠ¡å™¨'; messageInput.disabled = true; sendBtn.disabled = true; } } function connectWebSocket() { if (ws && ws.readyState === WebSocket.OPEN) { addMessage('WebSocket å·²ç»è¿æ¥', 'system'); return; } const wsUrl = 'ws://127.0.0.1:8080/ws'; addMessage(`æ­£åœ¨è¿æ¥åˆ°: ${wsUrl}`, 'system'); try { ws = new WebSocket(wsUrl); ws.onopen = function(event) { addMessage('WebSocket è¿æ¥æˆåŠŸå»ºç«‹ï¼', 'system'); updateStatus(true); reconnectAttempts = 0; }; ws.onmessage = function(event) { try { const data = JSON.parse(event.data); const content = `<strong>ç±»å‹:</strong> ${data.type}<br> <strong>æ¶ˆæ¯:</strong> ${data.message || 'N/A'}<br> <strong>æ—¶é—´æˆ³:</strong> ${data.timestamp || 'N/A'}`; addMessage(content, 'received'); } catch (e) { addMessage(`æ”¶åˆ°åŸå§‹æ¶ˆæ¯: ${event.data}`, 'received'); } }; ws.onclose = function(event) { addMessage(`WebSocket è¿æ¥å…³é—­ (ä»£ç : ${event.code})`, 'system'); updateStatus(false); // è‡ªåŠ¨é‡è¿ if (reconnectAttempts < maxReconnectAttempts) { reconnectAttempts++; addMessage(`${3}ç§’åå°è¯•é‡è¿ (${reconnectAttempts}/${maxReconnectAttempts})`, 'system'); setTimeout(connectWebSocket, 3000); } }; ws.onerror = function(error) { addMessage('WebSocket è¿æ¥é”™è¯¯ï¼', 'system'); updateStatus(false); }; } catch (error) { addMessage(`è¿æ¥å¤±è´¥: ${error.message}`, 'system'); updateStatus(false); } } function disconnectWebSocket() { if (ws) { ws.close(); addMessage('æ‰‹åŠ¨æ–­å¼€ WebSocket è¿æ¥', 'system'); } } function sendMessage() { const message = messageInput.value.trim(); if (!message) return; if (!ws || ws.readyState !== WebSocket.OPEN) { addMessage('WebSocket æœªè¿æ¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯', 'system'); return; } const data = { type: 'echo', content: message, timestamp: Date.now() }; ws.send(JSON.stringify(data)); addMessage(`å‘é€: ${message}`, 'sent'); messageInput.value = ''; } function sendPing() { if (!ws || ws.readyState !== WebSocket.OPEN) { addMessage('WebSocket æœªè¿æ¥', 'system'); return; } const data = { type: 'ping', timestamp: Date.now() }; ws.send(JSON.stringify(data)); addMessage('å‘é€å¿ƒè·³åŒ…', 'sent'); } function sendChatMessage() { if (!ws || ws.readyState !== WebSocket.OPEN) { addMessage('WebSocket æœªè¿æ¥', 'system'); return; } const data = { type: 'chat', content: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•èŠå¤©æ¶ˆæ¯', user: 'TestUser', timestamp: Date.now() }; ws.send(JSON.stringify(data)); addMessage('å‘é€èŠå¤©æ¶ˆæ¯', 'sent'); } function sendNotification() { if (!ws || ws.readyState !== WebSocket.OPEN) { addMessage('WebSocket æœªè¿æ¥', 'system'); return; } const data = { type: 'notification', content: 'ç³»ç»Ÿé€šçŸ¥æµ‹è¯•', level: 'info', timestamp: Date.now() }; ws.send(JSON.stringify(data)); addMessage('å‘é€ç³»ç»Ÿé€šçŸ¥', 'sent'); } function clearMessages() { messagesEl.innerHTML = ''; addMessage('æ¶ˆæ¯å·²æ¸…ç©º', 'system'); } // å›è½¦å‘é€æ¶ˆæ¯ messageInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') { sendMessage(); } }); // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºçŠ¶æ€ addMessage('WebSocket æµ‹è¯•é¡µé¢å·²åŠ è½½', 'system'); addMessage('ç‚¹å‡»"è¿æ¥æœåŠ¡å™¨"å¼€å§‹æµ‹è¯•', 'system'); </script> </body> </html> 