<!DOCTYPE html> <html lang="zh-CN"> <head> <link rel="preload" href="/assets/css/main.css" as="style"> <link rel="preload" href="/assets/js/main.js" as="script"> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>数据库集成测试 - AlingAi Pro</title> <style> body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; padding: 20px; margin: 0; } .container { max-width: 800px; margin: 0 auto; } .test-section { background: #2a2a2a; border-radius: 8px; padding: 20px; margin-bottom: 20px; } .test-button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; transition: all 0.3s ease; } .test-button:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); } .test-result { background: #333; border-radius: 5px; padding: 10px; margin-top: 10px; font-family: monospace; white-space: pre-wrap; } .success { color: #4CAF50; } .error { color: #f44336; } .warning { color: #ff9800; } .status { padding: 10px; border-radius: 5px; margin: 10px 0; } .status.authenticated { background: rgba(76, 175, 80, 0.2); border: 1px solid #4CAF50; } .status.guest { background: rgba(255, 152, 0, 0.2); border: 1px solid #ff9800; } </style> 
        <style>
            @media (max-width: 768px) {
                .container { width: 100%; padding: 0 15px; }
                .row { flex-direction: column; }
                .col { width: 100%; }
            }
            @media (max-width: 480px) {
                body { font-size: 14px; }
                h1 { font-size: 24px; }
                h2 { font-size: 20px; }
            }
        </style></head> <body> <div class="container"> <h1>📊 AlingAi Pro 数据库集成测试</h1> <div class="test-section"> <h2>🔐 认证状态检查</h2> <button class="test-button" onclick="testAuthentication()">检查认证状态</button> <div id="auth-status"></div> </div> <div class="test-section"> <h2>💬 聊天系统测试</h2> <button class="test-button" onclick="testChatSave()">测试保存聊天记录</button> <button class="test-button" onclick="testChatLoad()">测试加载聊天记录</button> <button class="test-button" onclick="testChatClear()">测试清空聊天记录</button> <div id="chat-test-result" class="test-result"></div> </div> <div class="test-section"> <h2>🏠 首页聊天组件测试</h2> <button class="test-button" onclick="testHomepageChat()">测试首页聊天功能</button> <div id="homepage-test-result" class="test-result"></div> </div> <div class="test-section"> <h2>⚡ 量子聊天集成器测试</h2> <button class="test-button" onclick="testQuantumIntegrator()">测试量子聊天集成器</button> <div id="quantum-test-result" class="test-result"></div> </div> <div class="test-section"> <h2>🔄 数据同步测试</h2> <button class="test-button" onclick="testDataSync()">测试本地到服务器同步</button> <div id="sync-test-result" class="test-result"></div> </div> </div> <script src="/assets/js/assets/js/homepage-ai-chat.js"></script> <script src="/assets/js/assets/js/components/chat-component.js"></script> <script src="/assets/js/assets/js/components/enhanced-chat-component.js"></script> <script src="/assets/js/assets/js/chat/core.js"></script> <script src="/assets/js/assets/js/quantum-chat-integrator.js"></script> <script> // 测试认证状态 async function testAuthentication() { const statusDiv = document.getElementById('auth-status'); statusDiv.innerHTML = '检查中...'; try { const response = await fetch('http://localhost:3001/api/v1/auth/check', { method: 'GET', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' } }); if (response.ok) { const result = await response.json(); const isAuthenticated = result.success && result.data?.authenticated; statusDiv.innerHTML = ` <div class="status ${isAuthenticated ? 'authenticated' : 'guest'}"> <strong>认证状态:</strong> ${isAuthenticated ? '✅ 已认证用户' : '👤 访客用户'}<br> <strong>存储模式:</strong> ${isAuthenticated ? 'API + localStorage 备份' : 'localStorage 主要存储'}<br> <strong>响应状态:</strong> ${response.status}<br> <strong>响应数据:</strong> ${JSON.stringify(result, null, 2)} </div> `; } else { throw new Error(`HTTP ${response.status}`); } } catch (error) { statusDiv.innerHTML = ` <div class="status guest"> <strong>认证状态:</strong> ❌ 无法连接到认证服务<br> <strong>存储模式:</strong> localStorage 离线模式<br> <strong>错误信息:</strong> ${error.message} </div> `; } } // 测试聊天保存 async function testChatSave() { const resultDiv = document.getElementById('chat-test-result'); resultDiv.innerHTML = '测试聊天记录保存...\n'; try { // 测试数据 const testMessage = { id: Date.now(), type: 'user', content: '这是一条测试消息', timestamp: new Date().toISOString() }; // 如果存在聊天核心类，使用它 if (typeof ChatCore !== 'undefined') { const chatCore = new ChatCore(); await chatCore.saveMessage(testMessage); resultDiv.innerHTML += '✅ ChatCore 保存成功\n'; } // 如果存在首页聊天类，使用它 if (typeof HomepageAIChat !== 'undefined') { const homepageChat = new HomepageAIChat(); const testHistory = [testMessage]; await homepageChat.saveChatToStorage(testHistory); resultDiv.innerHTML += '✅ HomepageAIChat 保存成功\n'; } resultDiv.innerHTML += '\n✅ 聊天记录保存测试完成'; } catch (error) { resultDiv.innerHTML += `\n❌ 保存测试失败: ${error.message}`; } } // 测试聊天加载 async function testChatLoad() { const resultDiv = document.getElementById('chat-test-result'); resultDiv.innerHTML = '测试聊天记录加载...\n'; try { // 如果存在聊天核心类，使用它 if (typeof ChatCore !== 'undefined') { const chatCore = new ChatCore(); const history = await chatCore.loadChatHistory(); resultDiv.innerHTML += `✅ ChatCore 加载成功，历史记录数量: ${history.length}\n`; } // 如果存在首页聊天类，使用它 if (typeof HomepageAIChat !== 'undefined') { const homepageChat = new HomepageAIChat(); const history = await homepageChat.loadChatHistoryFromStorage(); resultDiv.innerHTML += `✅ HomepageAIChat 加载成功，历史记录数量: ${history.length}\n`; } resultDiv.innerHTML += '\n✅ 聊天记录加载测试完成'; } catch (error) { resultDiv.innerHTML += `\n❌ 加载测试失败: ${error.message}`; } } // 测试聊天清空 async function testChatClear() { const resultDiv = document.getElementById('chat-test-result'); resultDiv.innerHTML = '测试清空聊天记录...\n'; try { let clearedCount = 0; // 如果存在聊天核心类，使用它 if (typeof ChatCore !== 'undefined') { const chatCore = new ChatCore(); await chatCore.clearHistory(); clearedCount++; resultDiv.innerHTML += '✅ ChatCore 清空成功\n'; } // 如果存在首页聊天类，使用它 if (typeof HomepageAIChat !== 'undefined') { const homepageChat = new HomepageAIChat(); await homepageChat.clearHistory(); clearedCount++; resultDiv.innerHTML += '✅ HomepageAIChat 清空成功\n'; } resultDiv.innerHTML += `\n✅ 聊天记录清空测试完成，共清空 ${clearedCount} 个组件`; } catch (error) { resultDiv.innerHTML += `\n❌ 清空测试失败: ${error.message}`; } } // 测试首页聊天 async function testHomepageChat() { const resultDiv = document.getElementById('homepage-test-result'); resultDiv.innerHTML = '测试首页聊天组件...\n'; try { if (typeof HomepageAIChat !== 'undefined') { // 创建实例但不绑定DOM const homepageChat = new HomepageAIChat(); // 测试认证检查 const isAuth = await homepageChat.checkAuthentication(); resultDiv.innerHTML += `✅ 认证检查: ${isAuth ? '已认证' : '访客模式'}\n`; // 测试AI响应生成 const testResponse = await homepageChat.getAIResponse('你好'); resultDiv.innerHTML += `✅ AI响应生成: ${testResponse.substring(0, 50)}...\n`; resultDiv.innerHTML += '\n✅ 首页聊天组件测试完成'; } else { throw new Error('HomepageAIChat 类未找到'); } } catch (error) { resultDiv.innerHTML += `\n❌ 首页聊天测试失败: ${error.message}`; } } // 测试量子聊天集成器 async function testQuantumIntegrator() { const resultDiv = document.getElementById('quantum-test-result'); resultDiv.innerHTML = '测试量子聊天集成器...\n'; try { if (typeof QuantumChatIntegrator !== 'undefined') { const integrator = new QuantumChatIntegrator(); // 测试认证检查 const isAuth = await integrator.checkAuthentication(); resultDiv.innerHTML += `✅ 认证检查: ${isAuth ? '已认证' : '访客模式'}\n`; resultDiv.innerHTML += '✅ 量子聊天集成器实例化成功\n'; resultDiv.innerHTML += '\n✅ 量子聊天集成器测试完成'; } else { throw new Error('QuantumChatIntegrator 类未找到'); } } catch (error) { resultDiv.innerHTML += `\n❌ 量子聊天集成器测试失败: ${error.message}`; } } // 测试数据同步 async function testDataSync() { const resultDiv = document.getElementById('sync-test-result'); resultDiv.innerHTML = '测试数据同步功能...\n'; try { if (typeof ChatCore !== 'undefined') { const chatCore = new ChatCore(); // 检查是否有同步方法 if (typeof chatCore.syncToDatabase === 'function') { const syncResult = await chatCore.syncToDatabase(); resultDiv.innerHTML += `✅ 数据同步完成: ${syncResult ? '成功' : '无数据需要同步'}\n`; } else { resultDiv.innerHTML += '⚠️ 同步方法不存在，可能还未实现\n'; } resultDiv.innerHTML += '\n✅ 数据同步测试完成'; } else { throw new Error('ChatCore 类未找到'); } } catch (error) { resultDiv.innerHTML += `\n❌ 数据同步测试失败: ${error.message}`; } } // 页面加载时自动检查认证状态 document.addEventListener('DOMContentLoaded', () => { testAuthentication(); }); </script> </body> </html> 