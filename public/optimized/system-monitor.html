<!DOCTYPE html> <html lang="zh-CN"> <head> <link rel="preload" href="/assets/css/main.css" as="style"> <link rel="preload" href="/assets/js/main.js" as="script"> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>AlingAi Pro - 系统监控仪表板</title> <link href="/assets/css/https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"> <link href="/assets/css/assets/css/quantum-styles.css" rel="stylesheet"> <script src="https://cdn.tailwindcss.com" async></script> <script src="/assets/js/https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" async></script> <style> .dashboard-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; transition: all 0.3s ease; } .dashboard-card:hover { background: rgba(255, 255, 255, 0.08); border-color: rgba(59, 130, 246, 0.5); transform: translateY(-2px); } .metric-value { font-size: 2rem; font-weight: bold; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; } .status-indicator { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; } .status-healthy { background-color: #10b981; } .status-warning { background-color: #f59e0b; } .status-critical { background-color: #ef4444; } .chart-container { position: relative; height: 300px; width: 100%; } .alert-item { animation: slideIn 0.3s ease-out; } @keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } } .loading-spinner { border: 2px solid rgba(255, 255, 255, 0.3); border-top: 2px solid #3b82f6; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } </style> 
        <style>
            @media (max-width: 768px) {
                .container { width: 100%; padding: 0 15px; }
                .row { flex-direction: column; }
                .col { width: 100%; }
            }
            @media (max-width: 480px) {
                body { font-size: 14px; }
                h1 { font-size: 24px; }
                h2 { font-size: 20px; }
            }
        </style></head> <body class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 min-h-screen text-white"> <nav class="bg-black bg-opacity-50 backdrop-blur-md border-b border-white border-opacity-20 p-4"> <div class="container mx-auto flex justify-between items-center"> <div class="flex items-center space-x-4"> <h1 class="text-xl font-bold">AlingAi Pro 系统监控</h1> <div class="status-indicator status-healthy"></div> <span class="text-sm" id="system-status">系统正常</span> </div> <div class="flex items-center space-x-4"> <button id="refresh-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors"> <i class="fas fa-sync-alt mr-2"></i>刷新 </button> <button id="settings-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors"> <i class="fas fa-cog"></i> </button> </div> </div> </nav> <div class="container mx-auto p-6"> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"> <div class="dashboard-card p-6"> <div class="flex items-center justify-between mb-4"> <h3 class="text-lg font-semibold">CPU 使用率</h3> <i class="fas fa-microchip text-blue-400"></i> </div> <div class="metric-value" id="cpu-usage">0%</div> <div class="text-sm text-gray-400 mt-2">实时监控</div> </div> <div class="dashboard-card p-6"> <div class="flex items-center justify-between mb-4"> <h3 class="text-lg font-semibold">内存使用</h3> <i class="fas fa-memory text-green-400"></i> </div> <div class="metric-value" id="memory-usage">0 MB</div> <div class="text-sm text-gray-400 mt-2" id="memory-percent">0%</div> </div> <div class="dashboard-card p-6"> <div class="flex items-center justify-between mb-4"> <h3 class="text-lg font-semibold">活跃连接</h3> <i class="fas fa-users text-purple-400"></i> </div> <div class="metric-value" id="active-connections">0</div> <div class="text-sm text-gray-400 mt-2">WebSocket 连接</div> </div> <div class="dashboard-card p-6"> <div class="flex items-center justify-between mb-4"> <h3 class="text-lg font-semibold">响应时间</h3> <i class="fas fa-tachometer-alt text-orange-400"></i> </div> <div class="metric-value" id="response-time">0ms</div> <div class="text-sm text-gray-400 mt-2">平均响应</div> </div> </div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"> <div class="dashboard-card p-6"> <h3 class="text-lg font-semibold mb-4">系统性能趋势</h3> <div class="chart-container"> <canvas id="performance-chart"></canvas> </div> </div> <div class="dashboard-card p-6"> <h3 class="text-lg font-semibold mb-4">API 请求统计</h3> <div class="chart-container"> <canvas id="api-chart"></canvas> </div> </div> </div> <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"> <div class="dashboard-card p-6"> <h3 class="text-lg font-semibold mb-4"> <i class="fas fa-server mr-2"></i>系统状态 </h3> <div class="space-y-3" id="system-services"> <div class="flex items-center justify-between"> <span>数据库</span> <div class="flex items-center"> <div class="loading-spinner mr-2"></div> <span class="text-sm">检查中...</span> </div> </div> <div class="flex items-center justify-between"> <span>WebSocket</span> <div class="flex items-center"> <div class="loading-spinner mr-2"></div> <span class="text-sm">检查中...</span> </div> </div> <div class="flex items-center justify-between"> <span>缓存</span> <div class="flex items-center"> <div class="loading-spinner mr-2"></div> <span class="text-sm">检查中...</span> </div> </div> <div class="flex items-center justify-between"> <span>文件系统</span> <div class="flex items-center"> <div class="loading-spinner mr-2"></div> <span class="text-sm">检查中...</span> </div> </div> </div> </div> <div class="dashboard-card p-6"> <h3 class="text-lg font-semibold mb-4"> <i class="fas fa-shield-alt mr-2"></i>安全警告 </h3> <div class="space-y-3" id="security-alerts"> <div class="text-sm text-gray-400">暂无安全警告</div> </div> </div> <div class="dashboard-card p-6"> <h3 class="text-lg font-semibold mb-4"> <i class="fas fa-clock mr-2"></i>最近活动 </h3> <div class="space-y-3" id="recent-activities"> <div class="text-sm text-gray-400">正在加载活动日志...</div> </div> </div> </div> <div class="dashboard-card p-6 mt-6"> <h3 class="text-lg font-semibold mb-4"> <i class="fas fa-chart-bar mr-2"></i>详细统计 </h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-6"> <div> <h4 class="font-semibold mb-3">数据库</h4> <div class="space-y-2 text-sm" id="database-stats"> <div class="flex justify-between"> <span>连接数:</span> <span id="db-connections">-</span> </div> <div class="flex justify-between"> <span>查询总数:</span> <span id="db-queries">-</span> </div> <div class="flex justify-between"> <span>数据库大小:</span> <span id="db-size">-</span> </div> </div> </div> <div> <h4 class="font-semibold mb-3">缓存</h4> <div class="space-y-2 text-sm" id="cache-stats"> <div class="flex justify-between"> <span>OPcache:</span> <span id="opcache-status">-</span> </div> <div class="flex justify-between"> <span>Redis:</span> <span id="redis-status">-</span> </div> <div class="flex justify-between"> <span>文件缓存:</span> <span id="file-cache-status">-</span> </div> </div> </div> <div> <h4 class="font-semibold mb-3">磁盘</h4> <div class="space-y-2 text-sm" id="disk-stats"> <div class="flex justify-between"> <span>总空间:</span> <span id="disk-total">-</span> </div> <div class="flex justify-between"> <span>已使用:</span> <span id="disk-used">-</span> </div> <div class="flex justify-between"> <span>可用空间:</span> <span id="disk-free">-</span> </div> </div> </div> </div> </div> </div> <script> class SystemMonitor { constructor() { this.isRunning = false; this.updateInterval = 5000; // 5秒更新一次 this.charts = {}; this.performanceData = { labels: [], cpu: [], memory: [], response: [] }; this.apiData = { labels: [], requests: [], errors: [] }; this.init(); } init() { this.setupEventListeners(); this.initCharts(); this.startMonitoring(); } setupEventListeners() { document.getElementById('refresh-btn').addEventListener('click', () => { this.refreshData(); }); document.getElementById('settings-btn').addEventListener('click', () => { this.showSettings(); }); // 页面可见性变化时暂停/恢复监控 document.addEventListener('visibilitychange', () => { if (document.hidden) { this.stopMonitoring(); } else { this.startMonitoring(); } }); } initCharts() { // 性能趋势图 const performanceCtx = document.getElementById('performance-chart').getContext('2d'); this.charts.performance = new Chart(performanceCtx, { type: 'line', data: { labels: this.performanceData.labels, datasets: [ { label: 'CPU 使用率 (%)', data: this.performanceData.cpu, borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4 }, { label: '内存使用率 (%)', data: this.performanceData.memory, borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', tension: 0.4 }, { label: '响应时间 (ms)', data: this.performanceData.response, borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)', tension: 0.4, yAxisID: 'y1' } ] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#fff' } } }, scales: { x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }, y: { type: 'linear', display: true, position: 'left', ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }, y1: { type: 'linear', display: true, position: 'right', ticks: { color: '#9ca3af' }, grid: { drawOnChartArea: false } } } } }); // API请求统计图 const apiCtx = document.getElementById('api-chart').getContext('2d'); this.charts.api = new Chart(apiCtx, { type: 'bar', data: { labels: this.apiData.labels, datasets: [ { label: '成功请求', data: this.apiData.requests, backgroundColor: 'rgba(16, 185, 129, 0.8)', borderColor: '#10b981', borderWidth: 1 }, { label: '错误请求', data: this.apiData.errors, backgroundColor: 'rgba(239, 68, 68, 0.8)', borderColor: '#ef4444', borderWidth: 1 } ] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#fff' } } }, scales: { x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }, y: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } } } } }); } async startMonitoring() { if (this.isRunning) return; this.isRunning = true; await this.updateData(); this.monitoringInterval = setInterval(async () => { if (this.isRunning) { await this.updateData(); } }, this.updateInterval); } stopMonitoring() { this.isRunning = false; if (this.monitoringInterval) { clearInterval(this.monitoringInterval); } } async updateData() { try { // 获取系统状态 const response = await fetch(API_ENDPOINTS.PERFORMANCE_MONITOR_STATUS); const data = await response.json(); if (data.success) { this.updateMetrics(data.data); this.updateCharts(); this.updateSystemStatus(data.data); } } catch (error) { console.error('更新数据失败:', error); this.showError('数据更新失败'); } } updateMetrics(data) { // 更新基本指标 const memory = data.memory; const cpu = Math.round(Math.random() * 100); // 模拟CPU数据 document.getElementById('cpu-usage').textContent = `${cpu}%`; document.getElementById('memory-usage').textContent = `${memory.current_usage_mb} MB`; document.getElementById('memory-percent').textContent = `${memory.usage_percentage}%`; // 更新连接数（模拟数据） const connections = Math.floor(Math.random() * 50) + 10; document.getElementById('active-connections').textContent = connections; // 更新响应时间（模拟数据） const responseTime = Math.floor(Math.random() * 200) + 50; document.getElementById('response-time').textContent = `${responseTime}ms`; // 更新图表数据 const now = new Date(); const timeLabel = now.toLocaleTimeString(); this.performanceData.labels.push(timeLabel); this.performanceData.cpu.push(cpu); this.performanceData.memory.push(memory.usage_percentage); this.performanceData.response.push(responseTime); // 保持最近20个数据点 if (this.performanceData.labels.length > 20) { this.performanceData.labels.shift(); this.performanceData.cpu.shift(); this.performanceData.memory.shift(); this.performanceData.response.shift(); } // 更新API数据（模拟） this.apiData.labels.push(timeLabel); this.apiData.requests.push(Math.floor(Math.random() * 100) + 50); this.apiData.errors.push(Math.floor(Math.random() * 10)); if (this.apiData.labels.length > 10) { this.apiData.labels.shift(); this.apiData.requests.shift(); this.apiData.errors.shift(); } } updateCharts() { this.charts.performance.update('none'); this.charts.api.update('none'); } updateSystemStatus(data) { // 更新数据库状态 this.updateServiceStatus('database', data.database); this.updateServiceStatus('websocket', data.websocket); this.updateServiceStatus('cache', data.cache); this.updateServiceStatus('filesystem', data.disk); // 更新详细统计 if (data.database && data.database.status === 'connected') { document.getElementById('db-connections').textContent = data.database.connections || '-'; document.getElementById('db-queries').textContent = data.database.queries || '-'; document.getElementById('db-size').textContent = (data.database.size || 0) + ' MB'; } // 更新缓存状态 if (data.cache) { document.getElementById('opcache-status').textContent = data.cache.opcache?.enabled ? '启用' : '禁用'; document.getElementById('redis-status').textContent = data.cache.redis?.enabled ? '运行中' : '停止'; document.getElementById('file-cache-status').textContent = data.cache.file_cache?.enabled ? '可用' : '不可用'; } // 更新磁盘统计 if (data.disk) { document.getElementById('disk-total').textContent = data.disk.total_space_gb + ' GB'; document.getElementById('disk-used').textContent = data.disk.used_space_gb + ' GB'; document.getElementById('disk-free').textContent = data.disk.free_space_gb + ' GB'; } // 更新安全警告 if (data.active_alerts && data.active_alerts.length > 0) { this.updateSecurityAlerts(data.active_alerts); } // 更新最近活动 if (data.recent_metrics) { this.updateRecentActivities(data.recent_metrics); } } updateServiceStatus(serviceName, serviceData) { const serviceContainer = document.getElementById('system-services'); const serviceRows = serviceContainer.querySelectorAll('div'); serviceRows.forEach(row => { const serviceLabelMap = { '数据库': 'database', 'WebSocket': 'websocket', '缓存': 'cache', '文件系统': 'filesystem' }; const label = row.querySelector('span').textContent; if (serviceLabelMap[label] === serviceName) { const statusContainer = row.querySelector('div:last-child'); const isHealthy = this.isServiceHealthy(serviceData); statusContainer.innerHTML = ` <div class="status-indicator ${isHealthy ? 'status-healthy' : 'status-critical'}"></div> <span class="text-sm">${isHealthy ? '正常' : '异常'}</span> `; } }); } isServiceHealthy(serviceData) { if (!serviceData) return false; if (serviceData.status) { return serviceData.status === 'healthy' || serviceData.status === 'connected' || serviceData.status === 'running'; } return true; } updateSecurityAlerts(alerts) { const container = document.getElementById('security-alerts'); if (alerts.length === 0) { container.innerHTML = '<div class="text-sm text-gray-400">暂无安全警告</div>'; return; } const alertsHtml = alerts.slice(0, 5).map(alert => ` <div class="alert-item flex items-center justify-between p-2 bg-red-500 bg-opacity-20 rounded border border-red-500 border-opacity-30"> <div> <div class="font-semibold text-sm">${alert.type}</div> <div class="text-xs text-gray-400">${new Date(alert.timestamp * 1000).toLocaleString()}</div> </div> <div class="status-indicator status-critical"></div> </div> `).join(''); container.innerHTML = alertsHtml; } updateRecentActivities(activities) { const container = document.getElementById('recent-activities'); if (!activities || activities.length === 0) { container.innerHTML = '<div class="text-sm text-gray-400">暂无最近活动</div>'; return; } const activitiesHtml = activities.slice(0, 5).map(activity => ` <div class="flex items-center justify-between p-2 bg-gray-500 bg-opacity-20 rounded"> <div> <div class="font-semibold text-sm">${activity.type}</div> <div class="text-xs text-gray-400">${new Date(activity.timestamp * 1000).toLocaleString()}</div> </div> <i class="fas fa-info-circle text-blue-400"></i> </div> `).join(''); container.innerHTML = activitiesHtml; } async refreshData() { const refreshBtn = document.getElementById('refresh-btn'); const originalText = refreshBtn.innerHTML; refreshBtn.innerHTML = '<i class="fas fa-sync-alt fa-spin mr-2"></i>刷新中...'; refreshBtn.disabled = true; await this.updateData(); setTimeout(() => { refreshBtn.innerHTML = originalText; refreshBtn.disabled = false; }, 1000); } showSettings() { // 显示设置对话框 alert('设置功能即将推出'); } showError(message) { // 显示错误通知 console.error(message); // 更新系统状态为异常 const statusIndicator = document.querySelector('.status-indicator'); const statusText = document.getElementById('system-status'); statusIndicator.className = 'status-indicator status-critical'; statusText.textContent = '系统异常'; } } // 初始化系统监控 document.addEventListener('DOMContentLoaded', () => { new SystemMonitor(); }); </script> </body> </html> 