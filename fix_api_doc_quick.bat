@echo off
chcp 65001 > nul

echo ===============================================
echo ??API???????????
echo ===============================================
echo.

REM ??????????
if not exist "public\admin\api\documentation\index.php" (
    echo ???????????
    pause
    exit /b 1
)

REM ????
set BACKUP_FILE=public\admin\api\documentation\index.php.bak.%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%%time:~6,2%
set BACKUP_FILE=%BACKUP_FILE: =0%
echo ??????: %BACKUP_FILE%
copy "public\admin\api\documentation\index.php" "%BACKUP_FILE%"

echo ??????...

REM ??PowerShell????
powershell -Command ^
"^
\ = Get-Content 'public\admin\api\documentation\index.php' -Raw; ^
\ = \ -replace 'AlingAi Pro 5.0 - API????????????', 'AlingAi Pro 6.0 - API??????'; ^
\ = \ -replace '????????????????PI???????????OpenAPI/Swagger????', '???????API?????OpenAPI/Swagger??'; ^
\ = \ -replace '??????????', '????'; ^
\ = \ -replace '?????????', '????'; ^
\ = \ -replace 'API????????????????', 'API?????'; ^
\ = \ -replace 'AlingAi Pro API?????? - ????????????????????????\?', 'AlingAi Pro API???? - ????????????'; ^
\ = \ -replace '\"version\"\s*=>\s*\"5\.0\.0\"', '\"version\" => \"6.0.0\"'; ^
\ = \ -replace '\"email\"\s*=>\s*\"[^@]+@[^\"]+\"', '\"email\" => \"api@gxggm.com\"'; ^
\ = \ -replace '\"description\"\s*=>\s*\"([^\"]*),', '\"description\" => \"\",'; ^
\ = \ -replace '?????????PI', '????API'; ^
\ = \ -replace '????', '??'; ^
\ = \ -replace '????????', '????'; ^
\ = \ -replace '??????', '??'; ^
\ = \ -replace '????????????????', '??????'; ^
\ = \ -replace '????????????', '????'; ^
\ = \ -replace '????????', '????'; ^
\ = \ -replace '????????????', '???????'; ^
\ = \ -replace '?????????????', '?????'; ^
\ = \ -replace '???????API????', '???API??'; ^
\ = \ -replace '????????', '????'; ^
\ = \ -replace '????????????', '????'; ^
\ = \ -replace '????????PTIONS??????CORS?????????????????????', '??OPTIONS???CORS?????????'; ^
\ = \ -replace '???????????????????????????', '???????????'; ^
\ = \ -replace '????API???????', '??API????'; ^
\ = \ -replace '????????API????', '????API??'; ^
\ = \ -replace '?????????????????API????', '???????API??'; ^
\ = \ -replace '?????????????', '??????'; ^
\ = \ -replace '?????????????????????????', '?????????'; ^
\ | Out-File 'public\admin\api\documentation\index.php' -Encoding UTF8; ^
"

echo ?????
echo.
echo ??????...

REM ??????
echo # API?????? > API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo ## ???? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo ????? public/admin/api/documentation/index.php ????????? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo 1. ?????????????????????????????? >> API_DOC_FIX_REPORT.md
echo 2. ??????????????????? >> API_DOC_FIX_REPORT.md
echo 3. ?????5.0.0???6.0.0 >> API_DOC_FIX_REPORT.md
echo 4. ??????@alingai.com???@gxggm.com >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo ## ???? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo ??PowerShell?????????? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo 1. ??????? >> API_DOC_FIX_REPORT.md
echo 2. ??????????????? >> API_DOC_FIX_REPORT.md
echo 3. ???????????? >> API_DOC_FIX_REPORT.md
echo 4. ??????????? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo ## ???? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo 1. ????????????????? >> API_DOC_FIX_REPORT.md
echo 2. ????????????? >> API_DOC_FIX_REPORT.md
echo 3. ?????????????????? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo ## ???? >> API_DOC_FIX_REPORT.md
echo. >> API_DOC_FIX_REPORT.md
echo %date% %time% >> API_DOC_FIX_REPORT.md

echo ??????API_DOC_FIX_REPORT.md
echo.
echo ??????????
echo.
pause
